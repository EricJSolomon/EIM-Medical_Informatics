USE [EricDB]
GO
/****** Object:  StoredProcedure [dbo].[sp_ALL_Auths_TAT_20200930]    Script Date: 9/30/2020 12:49:26 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- =============================================
-- Author:		Sheila Regan
-- Create date: 10/16/2015
-- Last Update: 09/27/2019
-- =============================================
ALTER PROCEDURE [dbo].[sp_ALL_Auths_TAT_20200930] AS

--===================================== ALL auths ==================================
--Isolate Medicaid, Marketplace cases within receipt date range 
if object_id('tempdb..#ar1') is not null drop table #ar1 -- get all relevant auth receipt attributes
select distinct thevalue,r.dbname, r.referralid, q.description, thegroup,r.authorizationid,x.product,x.planname,x.SSRS,x.NF_401, r.servicecode, rtrim(bp.description) BenefitPlan
into #ar1 from stage.dbo.referralattribute ra (nolock)
join stage.dbo.qattribute q on ra.dbname = q.dbname and q.attributeid = ra.attributeid 
join stage.dbo.referral r on r.referralid = ra.referralid and r.dbname = ra.dbname 
join stage.dbo.enrollkeys ek on ek.enrollid = r.enrollid and ek.dbname = r.dbname and ek.segtype = 'int' and ek.effdate<ek.termdate
join stage.dbo.benefitplan bp on bp.planid = ek.planid and bp.dbname = ek.dbname
join sheiladb.dbo.planx x on x.planid = bp.planid and x.programid = bp.programid
where q.description in ('Z - Auth Receipt Date - Approval','Z - Auth Receipt Date - Denial','Auth Receipt Date') and year(ra.createdate) >= year(getdate())-2
and ra.thevalue>'' and ra.thevalue<>'MM/DD/YYY' and ra.thevalue not like '%.%' and ra.thevalue not like '%:%' and ra.thevalue not like '%,%' 

delete from #ar1 where dbo.fn_isdate(thevalue) =0 --remove non-date valuesxc
delete from #ar1 where SSRS = 'DARR' and NF_401 = 'NA'
delete from #ar1 where SSRS = 'DARR' and NF_401 = 'Auth_TAT' and servicecode <> '401'

if object_id ('tempdb..#rc2') is not null drop table #rc2 select distinct benefitplan, product,planname,dbname,referralid,authorizationid, cast(thevalue as date) AuthReceiptDate 
into #rc2 from #ar1 (nolock) --convert attribute to usable date

if object_id ('tempdb..#rc1') is not null drop table #rc1 select distinct r.dbname, r.referralid,rtrim(x.description) BenefitPlan, x.product, x.planname, ssrs, x.nf_401
, cast(r.receiptdate as date) receipt_date, cast(r.referraldate as date) referral_date
,r.receiptdate,r.referraldate, AuthReceiptDate,r.createdate,r.utcreceiptdate
,r.servicecode,r.acuity,r.authorizationid,r.createid,r.authstatus
into #rc1 from stage.dbo.referral r (nolock)
join stage.dbo.enrollkeys ek on ek.enrollid = r.enrollid and ek.dbname = r.dbname and ek.segtype = 'int' and ek.effdate < ek.termdate
join stage.dbo.benefitplan bp on bp.planid = ek.planid and bp.dbname = ek.dbname
join sheiladb.dbo.planx x on x.planid = bp.planid and x.dbname = bp.dbname and x.programid = bp.programid
left join #rc2 b on r.referralid = b.referralid and r.dbname = b.dbname
where year(r.receiptdate) >= year(getdate()) -2 or (r.dbname in ('il','wi','fl','wa') and r.utcreceiptdate > '2019-10-04' and r.createid <> 'ePortal') 
or year(AuthReceiptDate) >= year(getdate())- 2 or year(r.createdate) >= year(getdate())-2
delete from #rc1 where SSRS = 'DARR' and NF_401 = 'NA'
delete from #rc1 where SSRS = 'DARR' and NF_401 = 'Auth_TAT' and servicecode <> '401'

if object_id ('tempdb..#rc') is not null drop table #rc --isolate date field to be used for inclusion criteria
select distinct *, case 
when dbname in ('IL','WI') and createdate >= '2019-11-03' and createdate <= '2020-03-07' and  createid <> 'ePortal' then dateadd(hh,-8,utcreceiptdate)
when dbname in ('IL','WI') and createdate > '2019-10-04' and createid <> 'ePortal' then dateadd(hh,-7,utcreceiptdate)
when dbname in ('FL','WA') and createdate >= '2020-02-08' and utcreceiptdate is not null then dateadd(hh,-7,utcreceiptdate)
when dbname in ('CA','MI') and createdate >='2020-05-09' and utcreceiptdate is not null then dateadd(hh,-7,utcreceiptdate)
when dbname in ('OH') and createdate >= '2020-06-13' and utcreceiptdate is not null then dateadd(hh,-7,utcreceiptdate)
when dbname in ('UT','UN') and createdate >= '2020-08-08' and utcreceiptdate is not null then dateadd(hh,-7,utcreceiptdate)
when receiptdate is not null and receipt_date not in ('1900-01-01','2078-12-31') and receipt_date = authreceiptdate then receiptdate
when authreceiptdate is not null then cast(authreceiptdate as datetime) 
when receiptdate is not null and receipt_date not in ('1900-01-01','2078-12-31') then receiptdate 
when referraldate is not null and referral_date not in ('1900-01-01','2078-12-31') then referraldate 
else createdate
end as ReceiptDate_tat into #rc from #rc1 (nolock)

if object_id('Sheiladb.dbo.HCS_DateInc') is not null drop table Sheiladb.dbo.HCS_DateInc 
select distinct planname, dbname, referralid,authorizationid,servicecode, acuity, authstatus, min(ReceiptDate_tat) ReceiptDate_tat, Product, SSRS, NF_401, BenefitPlan
into Sheiladb.dbo.HCS_DateInc --choose first available receipt
from #rc (nolock) group by planname, dbname, referralid,authorizationid,acuity, authstatus, servicecode, Product, SSRS, NF_401, BenefitPlan
--Get Med Dir
if object_id('tempdb..#md1') is not null drop table #md1
select distinct r.referralid, r.authorizationid,r.dbname,r.servicecode,r.authstatus authhstatus, aus.Status, aus.sequence,rtrim(e.firstname) + ' ' + rtrim(e.lastname) Med_Director
into #md1 from Sheiladb.dbo.HCS_DateInc x (nolock)
join stage.dbo.referral r on r.dbname = x.dbname and r.referralid = x.referralid 
join stage.dbo.authservice aus on aus.referralid = r.referralid and aus.dbname = r.dbname and aus.status = 'denied'
join stage.dbo.authdata a on a.referralid = r.referralid and a.dbname = r.dbname 
join stage.dbo.entity e on e.entid = a.meddirectorid and a.dbname = e.dbname and e.enttype = 'MEDDIR' 
where not (r.servicecode = '340' and aus.servcategory = 'rev' and aus.codeid = '           ')

if object_id('tempdb..#md') is not null drop table #md
select authorizationid, referralid, dbname, med_director, count(referralid) Inst, row_number()over(partition by referralid, dbname order by count(referralid) desc) RN
into #md from #md1 (nolock)
group by authorizationid,referralid, dbname, Med_Director
order by authorizationid, referralid, dbname
if object_id('SheilaDB.dbo.HCS_MedDir') is not null drop table SheilaDB.dbo.HCS_MedDir select * into SheilaDB.dbo.HCS_MedDir from #md where rn=1

--Get Denial Reason
if object_id('tempdb..#d1') is not null drop table #d1
select distinct r.authorizationid, a.referralid,a.dbname,r.servicecode,r.authstatus, a.Status, a.sequence
, Denial_Reason = case when a.status = 'DENIED' then ar.description else 'NA' end 
, Med_Director = case when a.status = 'DENIED' then isnull(rtrim(e.firstname) + ' ' + rtrim(e.lastname),'N') else 'NA' end 
into #d1 
from Sheiladb.dbo.HCS_DateInc x (nolock)
join stage.dbo.referral r on r.referralid = x.referralid and x.dbname = r.dbname
join stage.dbo.authservice a on a.dbname = x.dbname and a.referralid = x.referralid  
left join stage.dbo.authservicereason asr on asr.referralid = a.referralid and asr.sequence = a.sequence and asr.dbname = a.dbname 
left join stage.dbo.reasongroupdtl rgd on rgd.reasongroupdtlid = asr.reasongroupdtlid and rgd.dbname = a.dbname
left join stage.dbo.authreason ar on ar.reasoncode = rgd.reasoncode and ar.dbname = a.dbname
left join stage.dbo.entity e on e.entid = a.meddirectorid and a.dbname = e.dbname  and e.enttype = 'MEDDIR' 
where not (r.servicecode = '340' and a.servcategory = 'rev' and a.codeid = '           ') --and  a.authdstatus = 'denied'-- and acuity <> 'Emegergency'
if object_id('tempdb..#d2') is not null drop table #d2
select distinct a.referralid, a.dbname, Part_Denial = case when b.referralid is not null and c.referralid is not null then 'Y' else '' end
into #d2 from #d1 a (nolock)
left join (select distinct referralid, dbname from #d1 (nolock) where Status = 'DENIED') b on a.referralid = b.referralid and a.dbname = b.dbname 
left join (select distinct referralid, dbname from #d1 (nolock) where Status = 'APPROVED') c on a.referralid = c.referralid and a.dbname = c.dbname 
delete from #d1 where Denial_Reason is null and status = 'denied'

if object_id('tempdb..#d') is not null drop table #d
select distinct a.authorizationid, a.referralid, a.dbname,a.status, a.Denial_Reason,b.Part_Denial, count(a.referralid) Inst
, row_number()over(partition by a.referralid, a.dbname,a.status order by count(a.referralid) desc) RN
into #d from #d1 a join #d2 b on a.referralid = b.referralid and a.dbname = b.dbname where a.status = 'denied'
group by a.authorizationid, a.referralid, a.dbname,a.status, a.Denial_Reason,b.Part_Denial
order by a.referralid, a.dbname
if object_id('SheilaDB.dbo.HCS_DenRea') is not null drop table SheilaDB.dbo.HCS_DenRea
select * into SheilaDB.dbo.HCS_DenRea from #d (nolock) where rn=1

--Get Appeal ID
if object_id('tempdb..#HCS_AppealID1') is not null drop table #HCS_AppealID1
select distinct q.description, ra.thegroup,ra.thevalue, r.referralid, r.dbname, ra.effdate, ra.termdate
into #HCS_AppealID1 from stage.dbo.referralattribute ra (nolock)
join stage.dbo.qattribute q on q.attributeid = ra.attributeid and ra.dbname = q.dbname join Sheiladb.dbo.HCS_DateInc r on r.referralid = ra.referralid 
	and r.dbname = ra.dbname where description = 'Appeal ID' and thevalue <> ''

if object_id ('tempdb..#HCS_AppealID') is not null  drop table #HCS_AppealID 
Select Main.referralid,Main.dbname, case when main.thevalue = ' ' then ' ' else left(main.thevalue,len(main.thevalue)-1) end as thevalues
into #HCS_AppealID 
from (Select distinct t2.referralid,t2.dbname,(Select thevalue + '; ' AS [text()] 
From #HCS_AppealID1 t1 (nolock) Where t1.referralid = t2.referralid and t1.dbname = t2.dbname 
ORDER BY t1.referralid,t1.dbname For XML PATH ('')) [thevalue] From #HCS_AppealID1 t2 (nolock)) [Main]  
if object_id ('sheiladb.dbo.HCS_Appeals') is not null  drop table sheiladb.dbo.HCS_Appeals 
select distinct referralid, dbname, Appeal_ID = isnull(thevalues,''), refreshed = getdate() 
into sheiladb.dbo.HCS_Appeals from #HCS_AppealID (nolock)

--identify cases with MS/NY IP attribute groups
if object_id('tempdb..#authTAT_ConConDC') is not null drop table #authTAT_ConConDC
select distinct a.authorizationid, a.dbname,a.referralid,a.servicecode,a.acuity,a.authstatus, thegroup, description, thevalue, effdate, planname, ReceiptDate_tat
into #authTAT_ConConDC
from stage.dbo.referralattribute ra (nolock)
join stage.dbo.qattribute q on q.dbname = ra.dbname and q.attributeid = ra.attributeid
join Sheiladb.dbo.HCS_DateInc a on a.referralid = ra.referralid and a.dbname = ra.dbname
where thegroup in ('Concurrent/Continued Review','Continued Stay Approval','Continued Stay Denial','Discharge Review') and a.planname in ('MS','NY')

--remove unauthorized uses
--delete from #authTAT_ConConDC where planname <> 'NY' and thegroup = 'Concurrent/Continued Review'
delete from #authTAT_ConConDC where planname <> 'MS' and thegroup in ('Continued Stay Approval','Continued Stay Denial')
delete from #authTAT_ConConDC where thegroup in ('Continued Stay Approval','Continued Stay Denial') and
	servicecode not in 	('1038','1188','1196','140','150','160','180','190','278','320','340','350','370','380','401','404','IPLOA')          
--remove cases which also have approval denial groups
delete #authTAT_ConConDC from #authTAT_ConConDC a left join (select distinct ra.referralid, ra.dbname from stage.dbo.referralattribute ra (nolock)
						join stage.dbo.qattribute q on q.attributeid = ra.attributeid and q.dbname = ra.dbname
	where thegroup in ('approval','denial')) b on b.referralid = a.referralid and b.dbname = a.dbname 
where b.referralid is null  
--remove cases without valid values
if object_id('tempdb..#authTAT_ConConDCforCalc1') is not null drop table #authTAT_ConConDCforCalc1 
select *, case when thevalue in ('MM/DD/YYYY','                                                            ') then 'del'
when len(thevalue)=4 and description like '%Time%' then 'Time' when len(thevalue) in (8,9,10) and description like '%Date%' then 'Date' else 'del' end as Attr
, case when description like '%time%' then replace(rtrim(description),'time','') when description like '%date%' then replace(rtrim(description),'date','') end Attr_Name
into #authTAT_ConConDCforCalc1 from #authTAT_ConConDC (nolock)
delete from #authTAT_ConConDCforCalc1 where attr = 'del'
delete from #authTAT_ConConDCforCalc1 where attr = 'time' and (right(thevalue,2)>59 or left(thevalue,2)>23)
delete from #authTAT_ConConDCforCalc1 where attr = 'date' and SheilaDB.dbo.fn_IsDate(thevalue)=0
--remove cases without valid values
if object_id('tempdb..#authTAT_ConConDCforCalc2') is not null drop table #authTAT_ConConDCforCalc2 --select * from #authTAT_ConConDCforCalc1
select distinct x.authorizationid,x.dbname,x.referralid,x.servicecode,x.acuity,x.authstatus,x.thegroup,x.planname, x.ReceiptDate_tat
,a.Attr_Name,a.effdate,cast(a.thevalue as date) Date_Value
,case when b.thevalue is not null then cast(left(b.thevalue,2) + ':' + right(b.thevalue,2) as time) end as Time_Value
,cast(a.thevalue as datetime) + case when b.thevalue is not null then cast(left(b.thevalue,2) + ':' + right(b.thevalue,2) as datetime) end as DateTime_Value
,a.thevalue Attr_Date,b.thevalue Attr_Time--,row_no = ROW_NUMBER() OVER (PARTITION BY a.referralid,a.dbname,a.attr_name,a.thegroup ORDER BY a.effdate ASC)
into #authTAT_ConConDCforCalc2 
from #authTAT_ConConDCforCalc1 x (nolock)
left join #authTAT_ConConDCforCalc1 a on x.referralid = a.referralid and x.dbname = a.dbname and x.effdate = a.effdate 
	and x.thegroup = a.thegroup and a.attr = 'Date'
left join #authTAT_ConConDCforCalc1 b on a.referralid = b.referralid and a.dbname = b.dbname and a.effdate = b.effdate 
	and a.thegroup = b.thegroup and a.Attr_Name = b.Attr_Name and b.attr = 'Time'
where a.attr = 'Date' 
--queue duplicates for use assignment or deletion
if object_id('tempdb..#authTAT_ConConDCforCalc3') is not null drop table #authTAT_ConConDCforCalc3
select *,row_no = ROW_NUMBER() OVER (PARTITION BY referralid,dbname,attr_name,thegroup ORDER BY effdate ASC)
into #authTAT_ConConDCforCalc3 from #authTAT_ConConDCforCalc2 (nolock)

if object_id('tempdb..#authTAT_ConConDCforCalc4') is not null drop table #authTAT_ConConDCforCalc4
select distinct x.authorizationid,x.dbname,x.referralid,x.servicecode,x.acuity,x.thegroup,x.row_no,x.planname,x.ReceiptDate_tat
,a.Date_Value Receipt_Date,a.Time_Value Receipt_Time,a.DateTime_Value Receipt_DateTime,a.Attr_Date Receipt_Date_TheValue,a.Attr_Time Receipt_Time_TheValue
,b.Date_Value Decision_Date,b.Time_Value Decision_Time,b.DateTime_Value Decision_DateTime,b.Attr_Date Decision_Date_TheValue,b.Attr_Time Decision_Time_TheValue
,c.Date_Value Prov_Written_Notif_Date,c.Time_Value Prov_Written_Notif_Time,c.DateTime_Value Prov_Written_Notif_DateTime,c.Attr_Date Prov_Written_Notif_Date_TheValue,c.Attr_Time Prov_Written_Notif_Time_TheValue
,d.Date_Value Prov_Verbal_Notif_Date,d.Time_Value Prov_Verbal_Notif_Time,d.DateTime_Value Prov_Verbal_Notif_DateTime,d.Attr_Date Prov_Verbal_Notif_Date_TheValue,d.Attr_Time Prov_Verbal_Notif_Time_TheValue
,e.Date_Value Mbr_Written_Notif_Date,e.Time_Value Mbr_Written_Notif_Time,e.DateTime_Value Mbr_Written_Notif_DateTime,e.Attr_Date Mbr_Written_Notif_Date_TheValue,e.Attr_Time Mbr_Written_Notif_Time_TheValue
into #authTAT_ConConDCforCalc4 from #authTAT_ConConDCforCalc3 x (nolock)
left join #authTAT_ConConDCforCalc3 a on x.referralid = a.referralid and x.dbname = a.dbname and a.row_no = x.row_no--x.effdate = a.effdate 
	and a.thegroup = x.thegroup and a.Attr_Name in ('Receipt','Auth Receipt')
left join #authTAT_ConConDCforCalc3 b on b.referralid = x.referralid and b.dbname = x.dbname and x.row_no = b.row_no--b.effdate = x.effdate 
	and x.thegroup = b.thegroup and b.Attr_Name = 'Decision'
left join #authTAT_ConConDCforCalc3 c on c.referralid = x.referralid and c.dbname = x.dbname and x.row_no = c.row_no--b.effdate = x.effdate 
	and x.thegroup = c.thegroup and c.Attr_Name = 'Prov Written Notif'
left join #authTAT_ConConDCforCalc3 d on d.referralid = x.referralid and d.dbname = x.dbname and x.row_no = d.row_no--b.effdate = x.effdate 
	and x.thegroup = d.thegroup and d.Attr_Name = 'Prov Verbal Notif'
left join #authTAT_ConConDCforCalc3 e on e.referralid = x.referralid and e.dbname = x.dbname and x.row_no = e.row_no--b.effdate = x.effdate 
	and x.thegroup = e.thegroup and e.Attr_Name = 'Mbr Written Notif'

if object_id('sheiladb.dbo.authTAT_ConConDC') is not null drop table sheiladb.dbo.authTAT_ConConDC
select * into sheiladb.dbo.authTAT_ConConDC from #authTAT_ConConDCforCalc4 (nolock)

if object_id('dbo.AuthTAT_authdata') is not null drop table dbo.AuthTAT_authdata 
select * into dbo.AuthTAT_authdata from 
(select distinct CP=0,rc.dbname,rc.planname,lobname = rc.product ,r.memid,r.referralid,r.authorizationid,r.referraldate,r.effdate, r.termdate,rc.Receiptdate_tat
,lob = rc.BenefitPlan
,receiptdate = case when r.dbname in ('IL','WI') and r.createdate >= '2019-11-03' and r.createdate <= '2020-03-07' and r.createid <> 'ePortal' then dateadd(hh,-8,r.utcreceiptdate)
when r.dbname in ('IL','WI') and r.createdate > '2019-10-04' and r.createid <> 'ePortal' then dateadd(hh,-7,r.utcreceiptdate)
when r.dbname in ('FL','WA') and r.createdate >= '2020-02-08' and r.utcreceiptdate is not null then dateadd(hh,-7,r.utcreceiptdate)
when r.dbname in ('CA','MI') and r.createdate >='2020-05-09' and r.utcreceiptdate is not null then dateadd(hh,-7,r.utcreceiptdate)
when r.dbname in ('OH') and r.createdate >= '2020-06-13' and r.utcreceiptdate is not null then dateadd(hh,-7,r.utcreceiptdate)
when r.dbname in ('UT','UN') and r.createdate >= '2020-08-08' and r.utcreceiptdate is not null then dateadd(hh,-7,r.utcreceiptdate)
else r.receiptdate end
,ltrim(rtrim(sheiladb.dbo.fn_ProperCase(r.acuity))) acuity,r.servicecode, rtrim(ac.description) authcodedesc, authtype = '', authcategory = ''
, rpt = 'NA', ProcCat = 'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX' 
, ShortCat = 'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'
, Retro_Type = case when (r.receiptdate > r.termdate and r.receiptdate <> '2078-12-31') or rr.referralid is not null then 'Y' else ' ' end
, AImaging_Type = case when c.referralid is not null then 'Y' else ' ' end
, IP_Type = case when r.acuity = 'Emergency' then 'Y' else ' ' end
, PA_Type = case when r.acuity <> 'Emergency' and c.referralid is null then 'Y' when r.servicecode in ('400','402','403','4020') then 'Y' else ' ' end
, AImaging_Cat = c.ProcCat, IP_Cat = ipc.ProcCat, PA_Cat = pac.ProcCat
,r.authstatus authhstatus,aus.codeid,aus.servcategory,aus.status authdstatus, r.appeal,r.appealoutcome Appeal_Outcome,r.appealdate Appeal_date, ap.Appeal_ID
, Med_Director = case when dr.Part_Denial = 'Y' or r.authstatus = 'DENIED' then md.Med_Director else 'NA' end
, Denial_Reason = '                                                                                                    ',dr.Part_Denial,Pend_Lines = case when pl.referralid is not null then 'Y' else '' end
, Weekend = case when datepart(dw,ReceiptDate_tat) in ('1','7') then 'Y' else 'N' end
, Continued_Stay_Approval = 'N',Continued_Stay_Denial = 'N',Discharge_Review = 'N', Concurrent_Review = 'N'
, review_no = 1
, eviCore = case when ev.referralid is null then '' else 'Y' end, rc.SSRS, rc.NF_401
,r.userid,r.createid,'  'atrtyp,r.createdate ref_createdate,table_ref = getdate()
from Sheiladb.dbo.HCS_DateInc rc (nolock) 
join stage.dbo.referral r on r.referralid = rc.referralid and r.dbname = rc.dbname 
join stage.dbo.authservice aus on aus.referralid = r.referralid and aus.dbname = r.dbname and aus.status not in ('CLOSED','VOID')
join stage.dbo.authcode ac on ac.codeid = r.servicecode and ac.dbname = r.dbname
left join (select distinct referralid, dbname from stage.dbo.authservice (nolock) where status = 'PEND') pl on pl.dbname = r.dbname and pl.referralid = r.referralid
left join SheilaDB.dbo.HCS_MedDir md on md.referralid = r.referralid and md.dbname = r.dbname  
left join SheilaDB.dbo.HCS_DenRea dr on dr.referralid = r.referralid and dr.dbname = r.dbname
left join sheiladb.dbo.HCS_Appeals ap on ap.referralid = r.referralid and ap.dbname = r.dbname
left join sheiladb.dbo.Auth_Code_v2 ipc on ipc.codeid = r.servicecode and (ipc.dbname = r.dbname or ipc.dbname = 'ID' and r.dbname in ('MS','ID','NY','UN'))
	and ipc.big_report = 'TAT' and ipc.rpt = 'IP' --IP Category
left join sheiladb.dbo.Auth_Code_v2 pac on pac.codeid = r.servicecode and (pac.dbname = r.dbname or pac.dbname = 'ID' and r.dbname in ('MS','ID','NY','UN'))
	and pac.big_report = 'TAT' and pac.rpt in ('PA','ML') --PA Category
left join (select distinct referralid,ra.dbname from stage.dbo.referralattribute ra (nolock) join stage.dbo.qattribute q on q.attributeid=ra.attributeid and q.dbname=ra.dbname and q.description = 'retro review')
		rr on rr.referralid = r.referralid and r.dbname = rr.dbname
left join (select distinct referralid, ra.dbname from stage.dbo.referralattribute ra (nolock) join stage.dbo.qattribute q on q.attributeid = ra.attributeid and q.dbname = ra.dbname 
			where thevalue = 'eviCore' and description = 'Auth Source') ev on ev.dbname = r.dbname and ev.referralid = r.referralid
left join (
			select row_number()over (partition by referralid, dbname order by sequence asc) rw, * from 
				(
				select distinct rc.referralid, rc.authorizationid, rc.dbname,rc.product,rc.planname, category ProcCat,shortcat, aus.sequence, aus.codeid
				from stage.dbo.referral a (nolock) 
				join stage.dbo.authservice aus on aus.referralid = a.referralid and aus.dbname = a.dbname
				join sheiladb.dbo.ai_serv_all c on aus.codeid = c.codeid 
				join Sheiladb.dbo.HCS_DateInc rc on rc.dbname = a.dbname and rc.referralid = a.referralid
				where rc.product in ('Marketplace','Medicaid','Medicaid EP')  and rc.servicecode in ('210','250') 
				and not (rc.planname = 'PR' or (rc.dbname='FL' and rc.product='Medicaid' and a.receiptdate <'2018-12-01'))
				union 
				select distinct rc.referralid, rc.authorizationid, rc.dbname,rc.product,rc.planname, category ProcCat,shortcat, aus.sequence, aus.codeid
				from stage.dbo.authservice aus (nolock) join stage.dbo.referral r on r.referralid = aus.referralid and r.dbname = aus.dbname
				join sheiladb.dbo.ai_serv_all c on c.subcatid = aus.subcatid and c.svccategory = 'Auth - AI' 
				join Sheiladb.dbo.HCS_DateInc rc on rc.dbname = aus.dbname and rc.referralid = aus.referralid
				where aus.codeid = '' and r.servicecode in ('210','250') and rc.product  in ('Marketplace','Medicaid','Medicaid EP') 
				and not (rc.planname = 'PR' or (rc.dbname='FL' and rc.Product='Medicaid' and r.receiptdate <'2018-12-01'))
				union 
				select distinct rc.referralid, rc.authorizationid, rc.dbname,rc.product,rc.planname, category ProcCat,shortcat, aus.sequence ,aus.codeid
				from stage.dbo.authservice aus (nolock) join stage.dbo.referral r on r.referralid = aus.referralid and r.dbname = aus.dbname
				join sheiladb.dbo.ai_serv_all c on c.subcatid = aus.subcatid and c.svcgroupid = aus.svcgroupid and c.svccategory = 'Auth' 
				join Sheiladb.dbo.HCS_DateInc rc on rc.dbname = aus.dbname and rc.referralid = aus.referralid
				where aus.codeid = '' and r.servicecode in ('210','250') and rc.product  in ('MarketPlace','Medicaid') and not (rc.planname = 'PR' or (rc.dbname='FL' and rc.Product='Medicaid' and r.receiptdate <'2018-12-01'))) x)
				c on c.referralid = r.referralid and c.dbname = r.dbname and c.rw = '1'
where len(r.memid)>0 
	and case when r.authstatus in ('CLOSED','VOID') then 0 			 
			 when r.createid like '%load%' and r.createid not in ('IDAutoLoad','IDAutoLoad_MP') then 0
			 when r.authorizationid like '%APL' or r.authorizationid like '%AL' or r.authorizationid like '%RE'	then 0				
			 when (select ltrim(rtrim(userid)) from stage.dbo.QUser (nolock) where (lastname like '%load%' or loginid like '%load%') and userid=r.userid) = ltrim(rtrim(r.userid)) then 0				 
			 when r.servicecode in ('*100','170','200','240','290','330','360','1015','1016','1025','1026','1027','1028','1029','1030','1034','1035','1036','1037','1041'
			 ,'1042','1051','1052','1053','1054','1057','1058','1094','1095','1096','1127','1128','1132','1133','1136','1144','1145','1192','1193','1209','1210','PN','Referrals') then 0		
			 else 1 end=1)z 

insert into dbo.AuthTAT_authdata
select distinct a.CP,a.dbname,a.planname,a.lobname,a.memid,a.referralid,a.authorizationid,a.referraldate,a.effdate,a.termdate
,Receiptdate_tat = case when c.receipt_date is not null then cast(c.receipt_date as datetime) else a.receiptdate_tat end
,a.lob,a.receiptdate
,acuity = case when a.planname='ms' and a.servicecode in ('340','370','380','1038','1188') then 'Emergency' else a.acuity end 
,a.servicecode,a.authcodedesc,a.authtype,a.authcategory
,rpt = case when a.planname='ms' and (Continued_Stay_Approval='y' or Continued_Stay_Denial='Y' or Discharge_Review='Y') 
	and a.servicecode in ('340','370','380','1038','1188') then 'IP' else 'NA' end
,a.ProcCat,a.ShortCat,a.Retro_Type,a.AImaging_Type,a.IP_Type,a.PA_Type,a.AImaging_Cat,a.IP_Cat,a.PA_Cat
,authhstatus = case when thegroup = 'Continued Stay Denial' then 'DENIED' when thegroup = 'Continued Stay Approval' then 'APPROVED' else authhstatus end
,a.codeid,a.servcategory,a.authdstatus,a.appeal,a.Appeal_Outcome,a.Appeal_date,a.Appeal_ID,a.Med_Director,a.Denial_Reason,a.Part_Denial,a.Pend_Lines,a.Weekend
,Continued_Stay_Approval = case when thegroup = 'Continued Stay Approval' then 'Y' else 'N' end
,Continued_Stay_Denial = case when thegroup = 'Continued Stay Denial' then 'Y' else 'N' end
,Discharge_Review = case when thegroup = 'Discharge Review' then 'Y' else 'N' end
,Concurrent_Review = case when thegroup = 'Concurrent/Continued Review' then 'Y' else 'N' end
, review_no = c.row_no
, eviCore, SSRS, NF_401
,a.userid,a.createid,a.atrtyp,a.ref_createdate,a.table_ref
from sheiladb.dbo.authTAT_ConConDC c (nolock)
join sheiladb.dbo.AuthTAT_authdata a on c.dbname = a.dbname and c.referralid = a.referralid order by a.authorizationid

update sheiladb.dbo.AuthTAT_authdata 
set rpt = case when Retro_Type = 'Y' then 'RR' when AImaging_Type = 'Y' and acuity = 'Emergency' then 'PA'
when servicecode in ('400','401','402','403','404','4011','4020','CDPAS') then 'ML' 
when dbname <> 'PR' and servicecode = '232' then 'ML' 
when acuity = 'Emergency' then 'IP'
when AImaging_Type = 'Y' then 'AI' 
when PA_Type = 'Y' then 'PA' when IP_Type = 'Y' then 'IP'
else 'NA' end

update sheiladb.dbo.AuthTAT_authdata set rpt = 'RR' where receiptdate in ('2078-12-31','1900-01-01') and receiptdate > termdate and authhstatus in ('APPROVED','DENIED')
update sheiladb.dbo.AuthTAT_authdata set atrtyp = 'RR' where rpt = 'RR' or (receiptdate in ('2078-12-31','1900-01-01') and receiptdate > termdate and authhstatus in ('APPROVED','DENIED'))

update sheiladb.dbo.AuthTAT_authdata
set ProcCat = case
when rpt = 'RR' and (PA_Cat is not null or AImaging_Cat is not null or IP_Cat is not null) then isnull(PA_Cat,isnull(AImaging_Cat,IP_Cat))
when rpt = 'RR' then 'Other'
when rpt = 'ML' and PA_Cat is not null then PA_Cat
when rpt = 'AI' and AImaging_Cat is not null then rtrim(AImaging_Cat)
when rpt = 'IP' and IP_Cat is not null then rtrim(IP_Cat)
when rpt = 'PA' and PA_Cat is not null then rtrim(PA_Cat)
when PA_Cat is not null then PA_Cat
else 'Other' end

update sheiladb.dbo.AuthTAT_authdata set CP=1 
where (rpt = 'AI' or (rpt = 'PA' and proccat = 'transplant')) and planname in ('ID','IL','MI','NM','OH','SC','TX','WA','WI') and ReceiptDate_tat > '2018-08-31'

;with clm as--exclude 'Medical Claims Review' attributes
(select distinct dbname,planname,memid,referralid,authorizationid from dbo.AuthTAT_authdata (nolock)) 
,clm2 as   
(select distinct a.* from SheilaDB.dbo.authtat_authdata a (nolock) 
join stage.dbo.referralattribute b on a.referralid=b.referralid and b.thevalue>'' and b.dbname = a.dbname
join stage.dbo.qattribute c on b.dbname=c.dbname and b.attributeid=c.attributeid 
	where b.createdate>='2017-01-01' and c.description in ('A&D Appeal', 'BabyNet Services','CIRT/ Successful? Yes/No','Claim Workflow','DentaQuest Services'
	,'GENESEE - CIRT SUCCESSFUL?  Yes/No','Medicaid Reconsideration','Medicaid Re-Evaluation','Medical Claims Review'
	,'OAKLAND - OCIRT SUCCESSFUL? Yes/No'	,'Pharmacy Team','Provider Appeal'	))
delete dbo.AuthTAT_authdata from dbo.AuthTAT_authdata a join clm2 b on a.dbname=b.dbname and a.planname=b.planname and a.referralid=b.referralid 

;with coc as
(select distinct dbname,planname,memid,referralid,authorizationid from dbo.AuthTAT_authdata (nolock)) 
,coc2 as 
(select distinct au.* 
from coc au (nolock) inner join stage.dbo.referralmemo rm on au.dbname = rm.dbname and au.referralid=rm.referralid
inner join stage.dbo.memo mm on mm.dbname=rm.dbname and mm.memoid=rm.memoid and mm.source in ('refr','referral','member') and mm.effdate>='1/1/2017' and convert(varchar(10),mm.description) in ('COC','COC PCP'))
delete dbo.AuthTAT_authdata from dbo.AuthTAT_authdata a inner join coc2 b on a.dbname=b.dbname and a.planname=b.planname and a.referralid=b.referralid 
delete from dbo.authtat_authdata where lobname in ('MMP Medicaid','MMP Medicare') and proccat <> 'NF Custodial'
if object_id('tempdb..#TAT_Denials') is not null drop table #TAT_Denials
select o.dbname, o.referralid, o.authorizationid,o.authhstatus, Partial = case when authhstatus <> 'Denied' then 'Y' else '' end
, aus.sequence,aus.status, Denial_Reason=ar.description
,Med_Director=rtrim(e.firstname)+' '+rtrim(e.lastname),count(o.referralid) inst, MD_Review = case when aus.meddirectorid = '' then 0 else 1 end
into #TAT_Denials from dbo.AuthTAT_authdata o (nolock)
join stage.dbo.authservice aus on aus.referralid = o.referralid and aus.dbname = o.dbname and aus.status = 'denied'
left join stage.dbo.authservicereason asr on asr.referralid = o.referralid and asr.dbname = o.dbname 
left join stage.dbo.reasongroupdtl rgd on rgd.reasongroupdtlid = asr.reasongroupdtlid and rgd.dbname = o.dbname 
left join stage.dbo.authreason ar on ar.reasoncode = rgd.reasoncode and ar.dbname = o.dbname
left join stage.dbo.entity e on e.entid = aus.meddirectorid and o.dbname = e.dbname and e.enttype = 'MEDDIR' 
group by o.dbname, o.referralid, o.authorizationid,o.authhstatus, aus.sequence,aus.status,ar.description,e.firstname,e.lastname, aus.meddirectorid

if object_id('sheiladb.dbo.TAT_Denials') is not null drop table sheiladb.dbo.TAT_Denials
select distinct a.dbname, a.referralid, a.authorizationid
,MD_Review = case when a.authhstatus <> 'DENIED' and a.Partial ='' then 'NA' 
when e.referralid is null then 'Y' when b.referralid is not null then 'N' else 'NA' end
,Denial_Reason = case when a.authhstatus <> 'DENIED' and a.Partial ='' then 'NA'
when c.Denial_Reason is not null then c.Denial_Reason when d.Denial_Reason is not null then d.Denial_Reason else 'N' end
into sheiladb.dbo.TAT_Denials 
from #TAT_Denials a (nolock)
left join (select distinct dbname,referralid from #TAT_Denials where md_review = 0 and status = 'denied' and Denial_Reason like '%Denied Medical Necessity Criteria Not Met%') 
		b on b.referralid = a.referralid and b.dbname = a.dbname --MD review missing from med nec denied line
left join (select referralid, dbname,Denial_Reason,Med_Director, rn = row_number() over(partition by referralid, dbname, Denial_Reason order by sequence) 
		from #TAT_Denials where Denial_Reason like '%Denied Medical Necessity Criteria Not Met%')
		c on a.referralid = c.referralid and a.dbname = c.dbname and c.rn = '1' --Med nec
left join (select referralid, dbname,Denial_Reason,Med_Director, rn = row_number() over(partition by referralid, dbname, Denial_Reason order by inst) 
		from #TAT_Denials where Denial_Reason not like '%Denied Medical Necessity Criteria Not Met%')
		d on a.referralid = d.referralid and a.dbname = d.dbname and d.rn = '1'--Not med nec
left join (select distinct dbname,referralid from #TAT_Denials where md_review = 0 and status = 'denied') 
		e on e.referralid = a.referralid and e.dbname = a.dbname --MD review missing from any denied line

update dbo.AuthTAT_authdata 
set Denial_Reason = case when (dr.Part_Denial = 'y' or t1.authhstatus = 'DENIED') and t2.denial_reason is null then 'N' 
when dr.Part_Denial = 'y' or t1.authhstatus = 'DENIED' then t2.denial_reason else 'NA' end
from dbo.AuthTAT_authdata t1
left join SheilaDB.dbo.TAT_Denials t2 on t2.referralid = t1.referralid and t1.dbname = t2.dbname 
left join SheilaDB.dbo.HCS_DenRea dr on dr.referralid = t1.referralid and dr.dbname = t1.dbname

--==================================== unique auth ==================================
if object_id('dbo.AuthTAT_uniq_auth') is not null drop table dbo.AuthTAT_uniq_auth --assign acuity
select distinct rpt,dbname,planname,lob,lobname,memid,referralid,authorizationid,referraldate,receiptdate,receiptdate_tat,termdate,servicecode,acuity,CP, effdate auth_eff, termdate auth_term
,case when acuity='Elective' then 'Standard' else acuity end acuity_tat,authtype,authcategory,ProcCat,ShortCat,authcodedesc,authhstatus,userid,createid,atrtyp
,w_acuity = ''--case when (rpt = 'PA' and acuity in ('Emergency','Routine','')) or (planname <> 'FL' and rpt = 'AI' and acuity in ('Emergency','Routine','')) then 'Y' else '' end 
,Pend_Lines,Part_Denial,Denial_Reason,Appeal,Appeal_ID, Appeal_Outcome, Appeal_Date,Med_Director 
,Weekend,Continued_Stay_Approval,Continued_Stay_Denial,Discharge_Review,review_no,eviCore,Concurrent_Review
into dbo.AuthTAT_uniq_auth 	  from dbo.AuthTAT_authdata a (nolock)

--============================= capture referralattribute =================================
--receipt/decision attributes --drop table #attr,#attr2  --drop table #attr2 
------/* Text Attributes ------/*------
if object_id('tempdb..#attr') is not null drop table #attr select distinct rpt,dbname,planname,memid,referralid,authorizationid,Receiptdate_tat,Appeal, Appeal_Outcome, Appeal_Date,Med_Director,CP
,Continued_Stay_Approval,Continued_Stay_Denial,Discharge_Review,review_no,Concurrent_Review
into #attr from dbo.AuthTAT_uniq_auth (nolock)

if object_id('tempdb..#attr2') is not null drop table #attr2 
select distinct row_number() over(partition by a.dbname,a.planname,a.memid,a.referralid, c.description, b.thegroup order by a.dbname,a.planname,a.memid,a.referralid,b.thevalue,b.thegroup)row, 
c.description  att_desc,b.thegroup,a.*,b.thevalue,b.effdate,b.termdate
into #attr2 from #attr a (nolock)
inner join stage.dbo.referralattribute (nolock) b on  a.referralid=b.referralid collate database_default and a.dbname=b.dbname collate database_default
inner join stage.dbo.qattribute (nolock) c on b.dbname=c.dbname collate database_default and b.attributeid=c.attributeid collate database_default 
	and b.thegroup in ('No Group','Approval','Denial','DELAY IN SERVICE','ADDITIONAL INFORMATION')
where b.thevalue>''
and (description like '%Post IP Admit%' 
or description like '%Extension%' or description like '%# of Extension Days%' 
or description like '%Additional info days%' or description like '%Additional Info Time%' 
or description like '%Delay Decision Date%' or description like '%Delay Decision Time%'
or description like '%Auth Receipt Date%' or description like '%Auth Receipt Time%' 
or description like '%Decision Date%' or description like '%Decision Time%' 
or description like '%Retro Review%' 
or description like '%Info 1 Received%' or description like '%Info 1 Requested%' or description like '%Info 2 Received%' or description like '%Info 2 Requested%'
or description like '%Mbr Notif Date%' or description like '%Mbr Notif Time%'
or description like '%Mbr Verbal Notif Date%' or description like '%Mbr Verbal Notif Time%' 
or description like '%Mbr Written Notif Date%' or description like '%Mbr Written Notif Time%'
or description like '%Prov Notif Date%' or description like '%Prov Notif Time%'
or description like '%Prov Fax Notif Date%' or description like '%Prov Fax Notif Time%'
or description like '%Prov Verbal/Fax Notif Date%' or description like '%Prov Verbal/Fax Notif Time%'
or description like '%Prov Verbal Notif Date%' or description like '%Prov Verbal Notif Time%'	
or description like '%Prov Written Notif Date%' or description like '%Prov Written Notif Time%'
or description like '%Letter Approval%' or description like '%LETTER DATE - APPROVAL%'
or description like '%Denial Letter Sent%' or description like '%Letter Date - Denial%' or description like '%Letter Date – Denial%'
or description like '%Letter Date-Denial%' or description like '%Letter Denial%' or description like '%LETTER TIME – DENIAL%'
or description like '%Letter Date-Extension%' or description like '%LETTER DATE - EXTENSION%' or description like '%Letter Extension%'
or description like '%Written Notification Sent%' or description like '%Notification Date%')
update #attr2 set att_desc =
case when att_desc like '%Post IP Admit%' then 'Post IP Admit' when att_desc like '%Retro Review%' then 'Retro Review'
when att_desc like '%Extension%' and att_desc not like '%# of Extension Days%' then 'Extension' when att_desc like '%# of Extension Days%' then '# of Extension Days'
when att_desc like '%Additional info days%' then 'Additional info days' when att_desc like '%Additional Info Time%' then 'Additional Info Time'
when att_desc like '%Auth Receipt Date%' then 'Auth Receipt Date' when att_desc like '%Auth Receipt Time%' then 'Auth Receipt Time'
when att_desc like '%Decision Date%' then 'Decision Date' when att_desc like '%Decision Time%' then 'Decision Time'
when att_desc like '%Delay Decision Date%' then 'Delay Decision Date' when att_desc like '%Delay Decision Time%' then 'Delay Decision Time'
when att_desc like '%Info 2 Received%' then 'Info 2 Received' when att_desc like '%Info 2 Requested%' then 'Info 2 Requested'
when att_desc like '%Info 1 Received%' then 'Info 1 Received' when att_desc like '%Info 1 Requested%' then 'Info 1 Requested'
when att_desc like '%Mbr Written Notif Date%' then 'Mbr Written Notif Date' when att_desc like '%Mbr Written Notif Time%' then 'Mbr Written Notif Time'
when att_desc like '%Prov Written Notif Date%' then 'Prov Written Notif Date' when att_desc like '%Prov Written Notif Time%' then 'Prov Written Notif Time'
when att_desc like '%Mbr Notif Date%' or att_desc like '%Mbr Verbal Notif Date%' then 'Mbr Notif Date' 
when att_desc like '%Mbr Notif Time%' or att_desc like '%Mbr Verbal Notif Time%' then 'Mbr Notif Time'
when att_desc like '%Prov Notif Date%' or att_desc like '%Prov Fax Notif Date%' or att_desc like '%Prov Verbal/Fax Notif Date%' or att_desc like '%Prov Verbal Notif Date%' then 'Prov Notif Date' 
when att_desc like '%Prov Notif Time%' or att_desc like '%Prov Verbal Notif Time%' or att_desc like '%Prov Fax Notif Time%' or att_desc like '%Prov Verbal/Fax Notif Time%' then 'Prov Notif Time' 
when att_desc like '%Letter Approval%' or att_desc like '%LETTER DATE - APPROVAL%' then 'Letter_Approval_Date'
when att_desc like '%Denial Letter Sent%' or att_desc like '%Letter Date - Denial%' or att_desc like '%Letter Date – Denial%' or att_desc like '%Letter Date-Denial%' 
	or att_desc like '%Letter Denial%'  then 'Letter_Denial_Date'
when att_desc like '%LETTER TIME – DENIAL%' then 'Letter_Denial_Time'
when att_desc like '%Letter Date-Extension%' or att_desc like '%LETTER DATE - EXTENSION%' or att_desc like '%Letter Extension%' then 'Letter_Extension_Date'
When att_desc like '%Written Notification Sent%' or att_desc like '%Notification Date%' then 'Notification_Date'
else att_desc end
delete from #attr2 where att_desc in ('Extension','Additional info days','Auth Receipt Date','Decision Date','Retro Review','Mbr Written Notif Date','Prov Written Notif Date'
	,'Info 2 Received','Info 2 Requested','Info 1 Received','Info 1 Requested','Mbr Notif Date','Prov Notif Date'
	,'Letter_Approval_Date','Letter_Denial_Date','Letter_Extension_Date','Notification_Date') 
		and (dbo.fn_IsDate(thevalue)=0 or thevalue like ':' or thevalue = 'MM/DD/YYYY' or thevalue ='')
delete from #attr2 where att_desc in ('Additional Info Time','Auth Receipt Time','Decision Time','Mbr Written Notif Time','Prov Written Notif Time','Mbr Notif Time','Prov Notif Time','Letter_Denial_Time') 
		and (len(thevalue)<>4 or thevalue like '%:%' or thevalue like '%.%' or thevalue like '%,%' or thevalue ='' or thevalue like '%/%')
delete from #attr2 where att_desc in ('Additional Info Time','Auth Receipt Time','Decision Time','Mbr Written Notif Time','Prov Written Notif Time','Mbr Notif Time','Prov Notif Time','Letter_Denial_Time') 
		and not (left(TheValue,2) between 0 and 23 and right(thevalue,2) between 0 and 59)

--assign attribute  
if object_id('dbo.AuthTAT_attr') is not null drop table dbo.AuthTAT_attr
select row_number() over(partition by dbname,planname,memid,referralid,authorizationid 
							order by dbname,planname,memid,referralid,authorizationid,row)row
,dbname,planname,memid,referralid,authorizationid, Receiptdate_tat
,case when att_desc='Auth Receipt Date' and thegroup = 'No Group' then rtrim(thevalue) end NG_Receipt_Date
,case when att_desc='Auth Receipt Time' and thegroup = 'No Group' then rtrim(thevalue) end NG_Receipt_Time
,case when att_desc='Decision Date' and thegroup = 'No Group' then rtrim(thevalue) end NG_Decision_Date
,case when att_desc='Decision Time' and thegroup = 'No Group' then rtrim(thevalue) end NG_Decision_Time
,case when att_desc='Auth Receipt Date' and thegroup = 'Approval' then rtrim(thevalue) end Approval_Receipt_Date
,case when att_desc='Auth Receipt Time' and thegroup = 'Approval' then rtrim(thevalue) end Approval_Receipt_Time
,case when att_desc='Decision Date' and thegroup = 'Approval' then rtrim(thevalue) end Approval_Decision_Date
,case when att_desc='Decision Time' and thegroup = 'Approval' then rtrim(thevalue) end Approval_Decision_Time
,case when att_desc='Auth Receipt Date' and thegroup = 'Denial' then rtrim(thevalue) end Denial_Receipt_Date
,case when att_desc='Auth Receipt Time' and thegroup = 'Denial' then rtrim(thevalue) end Denial_Receipt_Time
,case when att_desc='Decision Date' and thegroup = 'Denial' then rtrim(thevalue) end Denial_Decision_Date
,case when att_desc='Decision Time' and thegroup = 'Denial' then rtrim(thevalue) end Denial_Decision_Time
,case when att_desc='Extension' then rtrim(thevalue) end Extension_Date
,case when att_desc='# of Extension Days' and thegroup in ('No Group', 'Approval', 'Denial') then rtrim(thevalue) end Extension
,case when att_desc='# of Extension Days' and thegroup in ('Delay in Service') then rtrim(thevalue) end Extension_Delay
,case when att_desc='Retro Review' then rtrim(thevalue) end Retro_Review
,case when att_desc='Additional info days' then rtrim(thevalue) end Info_Days
,case when att_desc='Additional info time' then rtrim(thevalue) end Info_Time
,case when att_desc='Delay Decision Date' and thevalue is not null then'Y' else '' end Delay_Dec
,case when att_desc='Info 1 Requested' then rtrim(thevalue) end Info_RQ1
,case when att_desc='Info 2 Requested' then rtrim(thevalue) end Info_RQ2
,case when att_desc='Info 1 Received' then rtrim(thevalue) end Info_RC1
,case when att_desc='Info 2 Received' then rtrim(thevalue) end Info_RC2
,Mbr_Notif_Date = case when att_desc = 'Mbr Notif Date' then rtrim(thevalue) end
,Mbr_Notif_Time = case when att_desc = 'Mbr Notif Time' then rtrim(thevalue) end
,Prov_Notif_Date = case when att_desc = 'Prov Notif Date' then rtrim(thevalue) end 
,Prov_Notif_Time = case when att_desc = 'Prov Notif Time' then rtrim(thevalue) end 
,Mbr_Writ_Notif_Date = case when att_desc = 'Mbr Written Notif Date' then rtrim(thevalue) end
,Mbr_Writ_Notif_Time = case when att_desc = 'Mbr Written Notif Time' then rtrim(thevalue) end
,Prov_Writ_Notif_Date = case when att_desc = 'Prov Written Notif Date' then rtrim(thevalue) end
,Prov_Writ_Notif_Time = case when att_desc = 'Prov Written Notif Time' then rtrim(thevalue) end
,Ext_Mbr_Writ_Notif_Date = case when att_desc = 'Mbr Written Notif Date' and thegroup = 'Delay in Service' then rtrim(thevalue) end
,Ext_Mbr_Writ_Notif_Time = case when att_desc = 'Mbr Written Notif Time' and thegroup = 'Delay in Service' then rtrim(thevalue) end
,Ext_Prov_Writ_Notif_Date = case when att_desc = 'Prov Written Notif Date' and thegroup = 'Delay in Service' then rtrim(thevalue) end
,Ext_Prov_Writ_Notif_Time = case when att_desc = 'Prov Written Notif Time' and thegroup = 'Delay in Service' then rtrim(thevalue) end
,Letter_Approval_Date = case when att_desc = 'Letter_Approval_Date' then rtrim(thevalue) end
,Letter_Denial_Date = case when att_desc = 'Letter_Denial_Date' then rtrim(thevalue) end
,Letter_Denial_Time = case when att_desc = 'Letter_Denial_Time' then rtrim(thevalue) end
,Letter_Extension_Date = case when att_desc = 'Letter_Extension_Date' then rtrim(thevalue) end
,Notification_Date = case when att_desc = 'Notification_Date' then rtrim(thevalue) end
into dbo.AuthTAT_attr from #attr2 (nolock)
--concatenate attribute date & time 
if object_id('dbo.AuthTAT_attr_datetime') is not null drop table dbo.AuthTAT_attr_datetime 
select distinct a.dbname,a.planname,a.memid,a.referralid,a.authorizationid
,NG_Receipt_Date,NG_Receipt_Time,NG_Receipt_DateTime = cast(NG_receipt_date as datetime)+cast(NG_receipt_time as datetime)
,NG_Decision_Date,NG_Decision_Time,NG_Decision_DateTime = cast(NG_Decision_date as datetime)+cast(NG_Decision_time as datetime)
,Approval_Receipt_Date,Approval_Receipt_Time,Approval_Receipt_DateTime = cast(Approval_Receipt_Date as datetime)+cast(Approval_Receipt_Time as datetime)
,Approval_Decision_Date,Approval_Decision_Time,Approval_Decision_DateTime = cast(Approval_Decision_Date as datetime)+cast(Approval_Decision_Time as datetime)
,Denial_Receipt_Date,Denial_Receipt_Time,Denial_Receipt_DateTime = cast(Denial_Receipt_Date as datetime)+cast(Denial_Receipt_Time as datetime)
,Denial_Decision_Date,Denial_Decision_Time,Denial_Decision_DateTime = cast(Denial_Decision_Date as datetime)+cast(Denial_Decision_Time as datetime)
,Info_Days,Info_Time, Info_Datetime = cast(info_days as datetime)+cast(info_time as datetime) 
,Retro_Review, Extension,Extension_Date,Delay_Dec
, Info_RQ1, Info_RQ2, Info_RC1, Info_RC2
,Mbr_Notif_Date,Mbr_Notif_Time,Mbr_Notif_DateTime = cast(Mbr_Notif_Date as datetime)+cast(Mbr_Notif_Time as datetime) 
,Prov_Notif_Date,Prov_Notif_Time,Prov_Notif_DateTime = cast(Prov_Notif_Date as datetime)+cast(Prov_Notif_Time as datetime) 
,Mbr_Writ_Notif_Date,Mbr_Writ_Notif_Time,Mbr_Writ_Notif_DateTime = cast(Mbr_Writ_Notif_Date as datetime)+cast(Mbr_Writ_Notif_Time as datetime) 
,Prov_Writ_Notif_Date,Prov_Writ_Notif_Time,Prov_Writ_Notif_DateTime = cast(Prov_Writ_Notif_Date as datetime)+cast(Prov_Writ_Notif_Time as datetime) 
,Ext_Mbr_Writ_Notif_Date,Ext_Mbr_Writ_Notif_Time,Ext_Mbr_Writ_Notif_DateTime = cast(Ext_Mbr_Writ_Notif_Date as datetime)+cast(Ext_Mbr_Writ_Notif_Time as datetime) 
,Ext_Prov_Writ_Notif_Date,Ext_Prov_Writ_Notif_Time,Ext_Prov_Writ_Notif_DateTime = cast(Ext_Prov_Writ_Notif_Date as datetime)+cast(Ext_Prov_Writ_Notif_Time as datetime) 
,Letter_Approval_Date,Letter_Extension_Date,Notification_Date
,Letter_Denial_Date,Letter_Denial_Time, Letter_Denial_DateTime = cast(Letter_Denial_Date as datetime)+cast(Letter_Denial_Time as datetime)
into dbo.AuthTAT_attr_datetime 
from #attr2 a (nolock)
left join (select dbname,planname,memid,referralid,authorizationid,Delay_Dec
, max(cast(NG_Receipt_Date as date)) NG_Receipt_Date, max(cast(left(NG_Receipt_Time,2)+':'+right(NG_Receipt_Time,2) as time)) NG_Receipt_Time
, max(cast(NG_Decision_Date as date)) NG_Decision_Date, max(cast(left(NG_Decision_Time,2)+':'+right(NG_Decision_Time,2) as time)) NG_Decision_Time
, max(cast(Approval_Receipt_Date as date)) Approval_Receipt_Date, max(cast(left(Approval_Receipt_Time,2)+':'+right(Approval_Receipt_Time,2) as time)) Approval_Receipt_Time
, max(cast(Approval_Decision_Date as date)) Approval_Decision_Date, max(cast(left(Approval_Decision_Time,2)+':'+right(Approval_Decision_Time,2) as time)) Approval_Decision_Time
, max(cast(Denial_Receipt_Date as date)) Denial_Receipt_Date, max(cast(left(Denial_Receipt_Time,2)+':'+right(Denial_Receipt_Time,2) as time)) Denial_Receipt_Time
, max(cast(Denial_Decision_Date as date)) Denial_Decision_Date, max(cast(left(Denial_Decision_Time,2)+':'+right(Denial_Decision_Time,2) as time)) Denial_Decision_Time
, max(cast(Retro_Review as date)) Retro_Review, max(extension) extension, max(cast(Extension_Date as date)) Extension_Date
, max(cast(Info_Days as date)) Info_Days, max(cast(left(Info_Time,2)+':'+right(Info_Time,2) as time)) Info_Time
, max(cast(Info_RQ1 as date)) Info_RQ1, max(cast(Info_RQ2 as date)) Info_RQ2, max(cast(Info_RC1 as date)) Info_RC1, max(cast(Info_RC2 as date)) Info_RC2
, max(cast(Mbr_Notif_Date as date)) Mbr_Notif_Date, max(cast(left(Mbr_Notif_Time,2)+':'+right(Mbr_Notif_Time,2) as time)) Mbr_Notif_Time
, max(cast(Prov_Notif_Date as date)) Prov_Notif_Date, max(cast(left(Prov_Notif_Time,2)+':'+right(Prov_Notif_Time,2) as time)) Prov_Notif_Time
, max(cast(Mbr_Writ_Notif_Date as date)) Mbr_Writ_Notif_Date, max(cast(left(Mbr_Writ_Notif_Time,2)+':'+right(Mbr_Writ_Notif_Time,2) as time)) Mbr_Writ_Notif_Time
, max(cast(Prov_Writ_Notif_Date as date)) Prov_Writ_Notif_Date, max(cast(left(Prov_Writ_Notif_Time,2)+':'+right(Prov_Writ_Notif_Time,2) as time)) Prov_Writ_Notif_Time
, max(cast(Ext_Mbr_Writ_Notif_Date as date)) Ext_Mbr_Writ_Notif_Date, max(cast(left(Ext_Mbr_Writ_Notif_Time,2)+':'+right(Ext_Mbr_Writ_Notif_Time,2) as time)) Ext_Mbr_Writ_Notif_Time
, max(cast(Ext_Prov_Writ_Notif_Date as date)) Ext_Prov_Writ_Notif_Date, max(cast(left(Ext_Prov_Writ_Notif_Time,2)+':'+right(Ext_Prov_Writ_Notif_Time,2) as time)) Ext_Prov_Writ_Notif_Time
, max(cast(Letter_Approval_Date as date)) Letter_Approval_Date,max(cast(Notification_Date as date)) Notification_Date
, max(cast(Letter_Denial_Date as date)) Letter_Denial_Date, max(cast(left(Letter_Denial_Time,2)+':'+right(Letter_Denial_Time,2) as time)) Letter_Denial_Time
, max(cast(Letter_Extension_Date as date)) Letter_Extension_Date
	from dbo.AuthTAT_attr (nolock) 	group by dbname,planname,memid,referralid,authorizationid,Delay_Dec) b 
	on a.dbname=b.dbname and a.referralid=b.referralid 

--merge detail info 
if object_id('tempdb..#AuthTAT_attr_rcpdec') is not null drop table #AuthTAT_attr_rcpdec 
select distinct a.*,b.NG_Receipt_Date,b.NG_Receipt_Time,b.NG_Receipt_DateTime,b.NG_Decision_Date,b.NG_Decision_Time,b.NG_Decision_DateTime
,b.Approval_Receipt_Date,b.Approval_Receipt_Time,b.Approval_Receipt_DateTime,b.Approval_Decision_Date,b.Approval_Decision_Time,b.Approval_Decision_DateTime
,b.Denial_Receipt_Date,b.Denial_Receipt_Time,b.Denial_Receipt_DateTime,b.Denial_Decision_Date,b.Denial_Decision_Time,b.Denial_Decision_DateTime
,b.Info_Days,b.Info_Time,b.Info_Datetime,b.Retro_Review,b.Extension,b.Extension_Date,b.Delay_Dec,b.Info_RQ1,b.Info_RQ2,b.Info_RC1,b.Info_RC2
,b.Mbr_Notif_Date,b.Mbr_Notif_Time,b.Mbr_Notif_DateTime,b.Prov_Notif_Date,b.Prov_Notif_Time,b.Prov_Notif_DateTime
,b.Mbr_Writ_Notif_Date,b.Mbr_Writ_Notif_Time,b.Mbr_Writ_Notif_DateTime,b.Prov_Writ_Notif_Date,b.Prov_Writ_Notif_Time,b.Prov_Writ_Notif_DateTime
,b.Ext_Mbr_Writ_Notif_Date,b.Ext_Mbr_Writ_Notif_Time,b.Ext_Mbr_Writ_Notif_DateTime,b.Ext_Prov_Writ_Notif_Date,b.Ext_Prov_Writ_Notif_Time,b.Ext_Prov_Writ_Notif_DateTime
,b.Letter_Approval_Date,b.Letter_Extension_Date,b.Notification_Date,b.Letter_Denial_Date,b.Letter_Denial_Time,b.Letter_Denial_DateTime
into #AuthTAT_attr_rcpdec from dbo.AuthTAT_uniq_auth a (nolock)
left join dbo.AuthTAT_attr_datetime b on a.dbname=b.dbname and a.referralid=b.referralid 

--- Calc TAT --- 
if object_id('Sheiladb.dbo.AuthTAT_attr_rcpdec') is not null drop table Sheiladb.dbo.AuthTAT_attr_rcpdec 
select distinct *
--Receipt Date
, case when (planname in ('WI','IL') and receiptdate between '2019-10-04' and '2020-05-01') 
	or (planname in ('WA','FL') and receiptdate between '2020-03-01' and '2020-05-01')
			or (planname='IL' and servicecode in ('232','400')) then cast(receiptdate as date) 
when (planname in ('CA') and rpt <>'IP') or CP=1 or (proccat = 'sick newborn' and ReceiptDate_tat between '2019-03-01' and '2019-05-13')
	or (planname in ('PR') and rpt <>'IP' and receiptdate_tat >= '2019-07-23')
	then isnull(Denial_Receipt_Date,Approval_Receipt_Date) 
when planname in ('NY','UT','FL','ID') and authorizationid not like 'm%' and rpt <>'IP' and receiptdate_tat <= '2018-08-31'
	then isnull(isnull(Denial_Receipt_Date,Approval_Receipt_Date),NG_Receipt_Date) 
when planname in ('WI','IL')	then isnull(isnull(Denial_Receipt_Date,Approval_Receipt_Date),NG_Receipt_Date) 
else isnull(isnull(Denial_Receipt_Date,Approval_Receipt_Date),NG_Receipt_Date)  end as Receipt_Date
, case when (planname in ('WI','IL') and receiptdate between '2019-10-04' and '2020-05-01') 
	or (planname in ('WA','FL') and receiptdate between '2020-03-01' and '2020-05-01')
			or (planname='IL' and servicecode in ('232','400')) then cast(receiptdate as time)
when (planname in ('CA') and rpt <>'IP') or CP=1 or (proccat = 'sick newborn' and ReceiptDate_tat between '2019-03-01' and '2019-05-13')
	or (planname in ('PR') and rpt <>'IP' and receiptdate_tat >= '2019-07-23')
	then isnull(Denial_Receipt_Time,Approval_Receipt_Time) 
when planname in ('NY','UT','FL','ID') and authorizationid not like 'm%' and rpt <>'IP' and receiptdate_tat <= '2018-08-31'
	then isnull(isnull(Denial_Receipt_Time,Approval_Receipt_Time),NG_Receipt_Time) 
when planname in ('WI','IL') then isnull(isnull(Denial_Receipt_Time,Approval_Receipt_Time),NG_Receipt_Time) 
else isnull(isnull(Denial_Receipt_Time,Approval_Receipt_Time),NG_Receipt_Time) end as Receipt_Time
, case 
when (planname in ('WI','IL') and receiptdate between '2019-10-04' and '2020-05-01') 
	or (planname in ('WA','FL') and receiptdate between '2020-03-01' and '2020-05-01')
			or (planname = 'IL' and servicecode in ('232','400')) then cast(receiptdate as datetime) 
when (planname in ('CA') and rpt <>'IP') or CP=1 or (proccat='sick newborn' and ReceiptDate_tat between '2019-03-01' and '2019-05-13')
	or (planname in ('PR') and rpt <>'IP' and receiptdate_tat >= '2019-07-23')
	then isnull(Denial_Receipt_DateTime,Approval_Receipt_DateTime)  
when planname in ('NY','UT','FL','ID') and authorizationid not like 'm%' and receiptdate_tat <= '2018-08-31' and rpt <>'IP' 
	then isnull(isnull(Denial_Receipt_DateTime,Approval_Receipt_DateTime),NG_Receipt_DateTime) 
when planname in ('WI','IL') then isnull(isnull(Denial_Receipt_DateTime,Approval_Receipt_DateTime),NG_Receipt_DateTime) 
else isnull(isnull(Denial_Receipt_DateTime,Approval_Receipt_DateTime),NG_Receipt_DateTime) end as Receipt_DateTime
--Decision Date
,case when (planname in ('CA') and rpt <>'IP') or planname in ('MS','NY','ID') or CP=1 or (planname in ('PR') and receiptdate_tat >= '2019-07-23' and rpt <>'IP')
	or (planname not in ('NY','MS') and proccat='sick newborn' and ReceiptDate_tat between '2019-03-01' and '2019-05-13')
	or (planname in ('UT','FL') and authorizationid not like 'm%' and rpt <>'IP' and receiptdate_tat > '2018-08-31')
	then isnull(Denial_Decision_Date,Approval_Decision_Date)
when planname in ('UT','FL') and rpt <>'IP' and receiptdate_tat <= '2018-08-31' and authorizationid not like 'm%' 
	then isnull(isnull(Denial_Decision_Date,Approval_Decision_Date),NG_Decision_Date)  
when planname in ('IL','WI') then isnull(isnull(Denial_Decision_Date,Approval_Decision_Date),NG_Decision_Date)  
else isnull(isnull(Denial_Decision_Date,Approval_Decision_Date),NG_Decision_Date) end as Decision_Date
,case when (planname in ('CA') and rpt <>'IP') or planname in ('MS','NY','ID') or CP=1 or (planname in ('PR') and receiptdate_tat >= '2019-07-23' and rpt <>'IP')
	or (planname not in ('NY','MS') and proccat='sick newborn' and ReceiptDate_tat between '2019-03-01' and '2019-05-13')
	or (planname in ('UT','FL') and authorizationid not like 'm%' and rpt <>'IP' and receiptdate_tat > '2018-08-31')
	then isnull(Denial_Decision_Time,Approval_Decision_Time)
when planname in ('UT','FL') and rpt <>'IP' and receiptdate_tat <= '2018-08-31' and authorizationid not like 'm%' 
	then isnull(isnull(Denial_Decision_Time,Approval_Decision_Time),NG_Decision_Time)  
when planname in ('IL','WI')  then isnull(isnull(Denial_Decision_Time,Approval_Decision_Time),NG_Decision_Time)  
else isnull(isnull(Denial_Decision_Time,Approval_Decision_Time),NG_Decision_Time)   end as Decision_Time
,case when (planname in ('CA') and rpt <>'IP') or planname in ('MS','NY','ID') or CP=1 or (planname in ('PR') and receiptdate_tat >= '2019-07-23' and rpt <>'IP')
	or (planname not in ('NY','MS') and proccat='sick newborn' and ReceiptDate_tat between '2019-03-01' and '2019-05-13')
	or (planname in ('UT','FL') and authorizationid not like 'm%' and rpt <>'IP' and receiptdate_tat > '2018-08-31')
	then isnull(Denial_Decision_DateTime,Approval_Decision_DateTime)
when planname in ('UT','FL') and rpt <>'IP' and receiptdate_tat <= '2018-08-31' and authorizationid not like 'm%' 
	then isnull(isnull(Denial_Decision_DateTime,Approval_Decision_DateTime),NG_Decision_DateTime)  
when planname in ('IL','WI') then isnull(isnull(Denial_Decision_DateTime,Approval_Decision_DateTime),NG_Decision_DateTime)  
else isnull(isnull(Denial_Decision_DateTime,Approval_Decision_DateTime),NG_Decision_DateTime) end as Decision_DateTime
,Letter_Date = isnull(Letter_Approval_Date,isnull(Letter_Denial_Date,isnull(Notification_date,NULL)))
into Sheiladb.dbo.AuthTAT_attr_rcpdec from #AuthTAT_attr_rcpdec (nolock)
where Continued_Stay_Approval ='N' and Continued_Stay_Denial ='N' and Discharge_Review ='N' and Concurrent_Review='N'

insert into dbo.AuthTAT_attr_rcpdec 
select distinct rc.rpt,rc.dbname,rc.planname,rc.lob,rc.lobname,rc.memid,rc.referralid,rc.authorizationid,rc.referraldate,rc.receiptdate,rc.receiptdate_tat,rc.termdate,rc.servicecode
,rc.acuity,rc.CP,rc.auth_eff,rc.auth_term,rc.acuity_tat,rc.authtype,rc.authcategory,rc.ProcCat,rc.ShortCat,rc.authcodedesc,rc.authhstatus,rc.userid,rc.createid,rc.atrtyp,rc.w_acuity
,rc.Pend_Lines,rc.Part_Denial,rc.Denial_Reason,rc.Appeal,rc.Appeal_ID,rc.Appeal_Outcome,rc.Appeal_Date,rc.Med_Director,rc.Weekend,rc.Continued_Stay_Approval
,rc.Continued_Stay_Denial,rc.Discharge_Review,rc.review_no,rc.eviCore,rc.Concurrent_Review
,NULL NG_Receipt_Date,NULL NG_Receipt_Time,NULL NG_Receipt_DateTime,NULL NG_Decision_Date,NULL NG_Decision_Time,NULL NG_Decision_DateTime
,NULL Approval_Receipt_Date,NULL Approval_Receipt_Time,NULL Approval_Receipt_DateTime
,NULL Approval_Decision_Date,NULL Approval_Decision_Time,NULL Approval_Decision_DateTime
,NULL Denial_Receipt_Date,NULL Denial_Receipt_Time,NULL Denial_Receipt_DateTime
,NULL Denial_Decision_Date,NULL Denial_Decision_Time,NULL Denial_Decision_DateTime
,NULL Info_Days,NULL Info_Time,NULL Info_Datetime,NULL Retro_Review,NULL Extension,NULL Extension_Date,NULL Delay_Dec,NULL Info_RQ1,NULL Info_RQ2,NULL Info_RC1,NULL Info_RC2
,NULL Mbr_Notif_Date,NULL Mbr_Notif_Time,NULL Mbr_Notif_DateTime,cc.Prov_Verbal_Notif_Date,cc.Prov_Verbal_Notif_Time,cc.Prov_Verbal_Notif_DateTime
,cc.Mbr_Written_Notif_Date,cc.Mbr_Written_Notif_Time,cc.Mbr_Written_Notif_DateTime,cc.Prov_Written_Notif_Date,cc.Prov_Written_Notif_Time,cc.Prov_Written_Notif_DateTime
,NULL Ext_Mbr_Writ_Notif_Date,NULL Ext_Mbr_Writ_Notif_Time,NULL Ext_Mbr_Writ_Notif_DateTime,NULL Ext_Prov_Writ_Notif_Date,NULL Ext_Prov_Writ_Notif_Time,NULL Ext_Prov_Writ_Notif_DateTime
,NULL Letter_Approval_Date,NULL Letter_Extension_Date,NULL Notification_Date,NULL Letter_Denial_Date,NULL Letter_Denial_Time,NULL Letter_Denial_DateTime
,cc.Receipt_Date,cc.Receipt_Time,cc.Receipt_DateTime,cc.Decision_Date,cc.Decision_Time,cc.Decision_DateTime, NULL Letter_Date
from #AuthTAT_attr_rcpdec rc (nolock)
join dbo.authTAT_ConConDC cc on rc.dbname = cc.dbname and rc.referralid = cc.referralid and cast(rc.receiptdate_tat as date) = cast(cc.receipt_date as date)
where rc.Continued_Stay_Approval ='Y' or rc.Continued_Stay_Denial ='Y' or rc.Discharge_Review ='Y' or rc.Concurrent_Review='Y'

if object_id('dbo.AuthTAT_timeframe') is not null drop table dbo.AuthTAT_timeframe 
select *--calendar days
,datediff(dd,Receipt_Date,Decision_Date) tat_dd
,cast(datediff(minute,Receipt_DateTime,Decision_DateTime)/60.0 as money) tat_hh
,datediff(dd,Receipt_Date,Letter_Date) ltr_dd
,cast(datediff(minute,Receipt_DateTime,isnull(letter_denial_datetime,cast(Letter_Date as datetime)))/60.0 as money) ltr_hh
,MS_Info_1_Received_TAT = datediff(dd,Info_RQ1,Info_RC1) 
,MS_Info_2_Received_TAT = datediff(dd,Info_RQ2,Info_RC2) 
,Mbr_Notif_TAT_Days = datediff(dd,Receipt_Date,Mbr_Notif_Date) 
,Mbr_Notif_TAT_Hours = cast(datediff(minute,Receipt_DateTime,Mbr_Notif_DateTime)/60.0 as money)
,Prov_Notif_TAT_Days = datediff(dd,Receipt_Date,Prov_Notif_Date)
,Prov_Notif_TAT_Hours = cast(datediff(minute,Receipt_DateTime,Prov_Notif_DateTime)/60.0 as money)
,Mbr_Writ_Notif_TAT_Days = datediff(dd,Receipt_Date,Mbr_Writ_Notif_Date)
,Mbr_Writ_Notif_TAT_Hours = cast(datediff(minute,Receipt_DateTime,Mbr_Writ_Notif_DateTime)/60.0 as money)
,Prov_Writ_Notif_TAT_Days = datediff(dd,Receipt_Date,Prov_Writ_Notif_Date)
,Prov_Writ_Notif_TAT_Hours = cast(datediff(minute,Receipt_DateTime,Prov_Writ_Notif_DateTime)/60.0 as money)
,Ext_Mbr_Writ_Notif_TAT_Days = datediff(dd,Receipt_Date,Ext_Mbr_Writ_Notif_Date)
,Ext_Mbr_Writ_Notif_TAT_Hours = cast(datediff(minute,Receipt_DateTime,Ext_Mbr_Writ_Notif_DateTime)/60.0 as money)
,Ext_Prov_Writ_Notif_TAT_Days = datediff(dd,Receipt_Date,Ext_Prov_Writ_Notif_Date)
,Ext_Prov_Writ_Notif_TAT_Hours = cast(datediff(minute,Receipt_DateTime,Ext_Prov_Writ_Notif_DateTime)/60.0 as money)
,case when len(extension)<=3 then extension else null end ext_dd
,case when len(extension)<=3 then extension*24 else null end ext_hh,case when len(extension)<=3 then 'Y' when Delay_Dec is not null then delay_dec else '' end ext 
,case when Extension_Date <> '' then datediff(dd,Receipt_datetime,Extension_Date) else null end ext_notif_dd 
,case when Info_Days <= Decision_Date then datediff(dd,Receipt_date,Info_Days) else null end info_dd 
,case when Info_Datetime <= Decision_DateTime then datediff(minute,Receipt_datetime,Info_Datetime)/60.0 else null end info_hh 
,case when dbname='WA' and Info_Days is not null and Info_Days <= Decision_Date then 'Y' else '' end info
,'N           ' compliant_fin, 'NA' tat_day, 'NA' tat_hour, 'NA' Timely_Letter
, 'NA' Timely_Mbr_Notif, 'NA' Timely_Prov_Notif, 'NA' Timely_Mbr_Writ_Notif, 'NA' Timely_Prov_Writ_Notif, 'NA' Timely_Ext_Mbr_Writ_Notif, 'NA' Timely_Ext_Prov_Writ_Notif
into dbo.AuthTAT_timeframe		from dbo.AuthTAT_attr_rcpdec (nolock)
where rpt in ('AI','PA','IP','ML') and w_acuity='' and atrtyp<>'RR'  --exclude wrong acuity
	and case when rpt in ('AI','PA','ML') and planname in ('CA') and acuity_tat='Standard' and not (len(extension)<=3 and extension is not null) then 0
			 when rpt in ('AI','PA','ML') and planname='TX' and acuity_tat = 'Standard' then 0
			 when planname = 'NY' and not (rpt in ('AI','PA','ML') and len(extension)<=3 and extension is not null) and not (lobname = 'Marketplace') and not rpt = 'RR' then 0
			 when planname = 'MS' and acuity_tat = 'Standard' and lobname <>'Marketplace' then 0
			 when planname = 'NY' and Concurrent_Review='Y' then 0
			 else 1 end=1 		 
UNION--business days 
select *
,case when Receipt_Datetime<=Decision_Datetime then (select count(*) from sheiladb.dbo.date_reference where calendar_date between Receipt_Datetime and Decision_Datetime and is_workday=1)
	  when Receipt_Datetime>Decision_Datetime then (select count(*)*(-1) from sheiladb.dbo.date_reference where calendar_date between Decision_Datetime and Receipt_Datetime and is_workday=1)
	  else null end tat_dd	
,cast(datediff(minute,Receipt_DateTime,Decision_DateTime)/60.0 as money) 	  tat_hh
,case when Receipt_Datetime<=isnull(letter_denial_datetime,cast(Letter_Date as datetime))
		then (select count(*) from sheiladb.dbo.date_reference 
		where calendar_date between Receipt_Datetime and isnull(letter_denial_datetime,cast(Letter_Date as datetime)) and is_workday=1)
	  when Receipt_Datetime>isnull(letter_denial_datetime,cast(Letter_Date as datetime))
		then (select count(*)*(-1) from sheiladb.dbo.date_reference 
		where calendar_date between Decision_Datetime and isnull(letter_denial_datetime,cast(Letter_Date as datetime)) and is_workday=1)
	  else null end ltr_dd	
,cast(datediff(minute,Receipt_DateTime,isnull(letter_denial_datetime,cast(Letter_Date as datetime)))/60.0 as money) 	  ltr_hh
,MS_Info_1_Received_TAT = datediff(dd,Info_RQ1,Info_RC1) 
,MS_Info_2_Received_TAT = datediff(dd,Info_RQ2,Info_RC2) 
,Mbr_Notif_TAT_Days = case when Receipt_Datetime<=Mbr_Notif_Datetime then (select count(*) from sheiladb.dbo.date_reference where calendar_date between Receipt_Datetime and Mbr_Notif_Datetime and is_workday=1)
	  when Receipt_Datetime>Mbr_Notif_Datetime then (select count(*)*(-1) from sheiladb.dbo.date_reference where calendar_date between Mbr_Notif_Datetime and Receipt_Datetime and is_workday=1) 	  else null end 
,Mbr_Notif_TAT_Hours = cast(datediff(minute,Receipt_DateTime,Mbr_Notif_DateTime)/60.0 as money)
,Prov_Notif_TAT_Days = case when Receipt_Datetime<=Prov_Notif_Datetime then (select count(*) from sheiladb.dbo.date_reference where calendar_date between Receipt_Datetime and Prov_Notif_Datetime and is_workday=1)
	  when Receipt_Datetime>Prov_Notif_Datetime then (select count(*)*(-1) from sheiladb.dbo.date_reference where calendar_date between Prov_Notif_Datetime and Receipt_Datetime and is_workday=1) 	  else null end 
,Prov_Notif_TAT_Hours = cast(datediff(minute,Receipt_DateTime,Prov_Notif_DateTime)/60.0 as money)
,Mbr_Writ_Notif_TAT_Days = case when Receipt_Datetime<=Mbr_Writ_Notif_Datetime then (select count(*) from sheiladb.dbo.date_reference where calendar_date between Receipt_Datetime and Mbr_Writ_Notif_Datetime and is_workday=1)
	  when Receipt_Datetime>Mbr_Writ_Notif_Datetime then (select count(*)*(-1) from sheiladb.dbo.date_reference where calendar_date between Mbr_Writ_Notif_Datetime and Receipt_Datetime and is_workday=1) 	  else null end 
,Mbr_Writ_Notif_TAT_Hours = cast(datediff(minute,Receipt_DateTime,Mbr_Writ_Notif_DateTime)/60.0 as money)
,Prov_Writ_Notif_TAT_Days = case when Receipt_Datetime<=Prov_Writ_Notif_Datetime then (select count(*) from sheiladb.dbo.date_reference where calendar_date between Receipt_Datetime and Prov_Writ_Notif_Datetime and is_workday=1)
	  when Receipt_Datetime>Prov_Writ_Notif_Datetime then (select count(*)*(-1) from sheiladb.dbo.date_reference where calendar_date between Prov_Writ_Notif_Datetime and Receipt_Datetime and is_workday=1) 	  else null end 
,Prov_Writ_Notif_TAT_Hours = cast(datediff(minute,Receipt_DateTime,Prov_Writ_Notif_DateTime)/60.0 as money)
,Ext_Mbr_Writ_Notif_TAT_Days = case when Receipt_Datetime<=Ext_Mbr_Writ_Notif_Datetime then (select count(*) from sheiladb.dbo.date_reference where calendar_date between Receipt_Datetime and Ext_Mbr_Writ_Notif_Datetime and is_workday=1)
	  when Receipt_Datetime>Ext_Mbr_Writ_Notif_Datetime then (select count(*)*(-1) from sheiladb.dbo.date_reference where calendar_date between Ext_Mbr_Writ_Notif_Datetime and Receipt_Datetime and is_workday=1) 	  else null end 
,Ext_Mbr_Writ_Notif_TAT_Hours = cast(datediff(minute,Receipt_DateTime,Ext_Mbr_Writ_Notif_DateTime)/60.0 as money)
,Ext_Prov_Writ_Notif_TAT_Days = case when Receipt_Datetime<=Ext_Prov_Writ_Notif_Datetime then (select count(*) from sheiladb.dbo.date_reference where calendar_date between Receipt_Datetime and Ext_Prov_Writ_Notif_Datetime and is_workday=1)
	  when Receipt_Datetime>Ext_Prov_Writ_Notif_Datetime then (select count(*)*(-1) from sheiladb.dbo.date_reference where calendar_date between Ext_Prov_Writ_Notif_Datetime and Receipt_Datetime and is_workday=1) else null end 
,Ext_Prov_Writ_Notif_TAT_Hours = cast(datediff(minute,Receipt_DateTime,Ext_Prov_Writ_Notif_DateTime)/60.0 as money)
,case when len(extension)<=3 then extension else null end ext_dd ,case when len(extension)<=3 then extension*24 else null end ext_hh 
,case when len(extension)<=3 then 'Y' when Delay_Dec is not null then delay_dec else '' end ext
,case when Extension_Date <> '' then datediff(dd,Receipt_datetime,Extension_Date) else null end ext_notif_dd 
,case when Info_Days <= Decision_Date then datediff(dd,Receipt_date,Info_Days) else null end info_dd 
,case when Info_Datetime <= Decision_DateTime then datediff(minute,Receipt_datetime,Info_Datetime)/60.0 else null end info_hh 
,info='','N          ' compliant_fin, 'NA' tat_day, 'NA' tat_hour, 'NA' Timely_Letter
, 'NA' Timely_Mbr_Notif, 'NA' Timely_Prov_Notif, 'NA' Timely_Mbr_Writ_Notif, 'NA' Timely_Prov_Writ_Notif, 'NA' Timely_Ext_Mbr_Writ_Notif, 'NA' Timely_Ext_Prov_Writ_Notif
from dbo.AuthTAT_attr_rcpdec (nolock)
where (rpt in ('AI','PA','ML') and planname in ('CA') and acuity_tat='Standard' and not (len(extension)<=3 and extension is not null))
		or (rpt in ('AI','PA','ML') and planname='TX' and acuity_tat = 'Standard')
		or (planname = 'NY' and not (rpt in ('AI','PA','ML') and len(extension)<=3 and extension is not null) and not (lobname = 'Marketplace') and not rpt = 'RR')
		or (planname = 'NY' and Concurrent_Review='Y')
union
select *
,tat_dd = case when datepart(dw,receipt_date) in ('1','2','3','4') 
	then case when Receipt_Datetime<=Decision_Datetime then (select count(*) from sheiladb.dbo.date_reference where calendar_date between Receipt_Datetime and Decision_Datetime and is_workday=1)
	  when Receipt_Datetime>Decision_Datetime then (select count(*)*(-1) from sheiladb.dbo.date_reference where calendar_date between Decision_Datetime and Receipt_Datetime and is_workday=1)
	  else null end when datepart(dw,receipt_date) in ('5','6','7') then datediff(dd,Receipt_Date,Decision_Date) end
,tat_hh = null--cast(datediff(minute,Receipt_DateTime,Decision_DateTime)/60.0 as money) 
,ltr_dd = case when datepart(dw,receipt_date) in ('1','2','3','4') 
	then case when Receipt_Datetime<=isnull(letter_denial_datetime,cast(Letter_Date as datetime)) then (select count(*) from sheiladb.dbo.date_reference 
	where calendar_date between Receipt_Datetime and isnull(letter_denial_datetime,cast(Letter_Date as datetime)) and is_workday=1)
	  when Receipt_Datetime>isnull(letter_denial_datetime,cast(Letter_Date as datetime)) then (select count(*)*(-1) from sheiladb.dbo.date_reference 
	  where calendar_date between isnull(letter_denial_datetime,cast(Letter_Date as datetime)) and Receipt_Datetime and is_workday=1)
	  else null end when datepart(dw,receipt_date) in ('5','6','7') then datediff(dd,Receipt_Date,Letter_Date) end
,ltr_hh = null--cast(datediff(minute,Receipt_DateTime,isnull(letter_denial_datetime,cast(Letter_Date as datetime)))/60.0 as money) 
,MS_Info_1_Received_TAT = datediff(dd,Info_RQ1,Info_RC1) 
,MS_Info_2_Received_TAT = datediff(dd,Info_RQ2,Info_RC2) 
,Mbr_Notif_TAT_Days =  case when datepart(dw,receipt_date) in ('1','2','3','4') 
	then case when Receipt_Datetime<=Mbr_Notif_Date then (select count(*) from sheiladb.dbo.date_reference where calendar_date between Receipt_Datetime and Mbr_Notif_Date and is_workday=1)
	  when Receipt_Datetime>Mbr_Notif_Date then (select count(*)*(-1) from sheiladb.dbo.date_reference where calendar_date between Mbr_Notif_Date and Receipt_Datetime and is_workday=1)
	  else null end when datepart(dw,receipt_date) in ('5','6','7') then datediff(dd,Receipt_Date,Mbr_Notif_Date) end
,Mbr_Notif_TAT_Hours = null--cast(datediff(minute,Receipt_DateTime,Mbr_Notif_DateTime)/60.0 as money)
,Prov_Notif_TAT_Days = case when datepart(dw,receipt_date) in ('1','2','3','4') 
	then case when Receipt_Datetime<=Prov_Notif_Date then (select count(*) from sheiladb.dbo.date_reference where calendar_date between Receipt_Datetime and Prov_Notif_Date and is_workday=1)
	  when Receipt_Datetime>Prov_Notif_Date then (select count(*)*(-1) from sheiladb.dbo.date_reference where calendar_date between Prov_Notif_Date and Receipt_Datetime and is_workday=1)
	  else null end when datepart(dw,receipt_date) in ('5','6','7') then datediff(dd,Receipt_Date,Prov_Notif_Date) end
,Prov_Notif_TAT_Hours = null--cast(datediff(minute,Receipt_DateTime,Prov_Notif_DateTime)/60.0 as money)
,Mbr_Writ_Notif_TAT_Days = case when datepart(dw,receipt_date) in ('1','2','3','4') 
	then case when Receipt_Datetime<=Mbr_Writ_Notif_Date then (select count(*) from sheiladb.dbo.date_reference where calendar_date between Receipt_Datetime and Mbr_Writ_Notif_Date and is_workday=1)
	  when Receipt_Datetime>Mbr_Writ_Notif_Date then (select count(*)*(-1) from sheiladb.dbo.date_reference where calendar_date between Mbr_Writ_Notif_Date and Receipt_Datetime and is_workday=1)
	  else null end when datepart(dw,receipt_date) in ('5','6','7') then datediff(dd,Receipt_Date,Mbr_Writ_Notif_Date) end
,Mbr_Writ_Notif_TAT_Hours = null--cast(datediff(minute,Receipt_DateTime,Mbr_Writ_Notif_DateTime)/60.0 as money)
,Prov_Writ_Notif_TAT_Days =  case when datepart(dw,receipt_date) in ('1','2','3','4') 
	then case when Receipt_Datetime<=Prov_Writ_Notif_Date then (select count(*) from sheiladb.dbo.date_reference where calendar_date between Receipt_Datetime and Prov_Writ_Notif_Date and is_workday=1)
	  when Receipt_Datetime>Prov_Writ_Notif_Date then (select count(*)*(-1) from sheiladb.dbo.date_reference where calendar_date between Prov_Writ_Notif_Date and Receipt_Datetime and is_workday=1)
	  else null end when datepart(dw,receipt_date) in ('5','6','7') then datediff(dd,Receipt_Date,Prov_Writ_Notif_Date) end
,Prov_Writ_Notif_TAT_Hours = null--cast(datediff(minute,Receipt_DateTime,Prov_Writ_Notif_DateTime)/60.0 as money)
,Ext_Mbr_Writ_Notif_TAT_Days = case when datepart(dw,receipt_date) in ('1','2','3','4') 
	then case when Receipt_Datetime<=Ext_Mbr_Writ_Notif_Date then (select count(*) from sheiladb.dbo.date_reference where calendar_date between Receipt_Datetime and Ext_Mbr_Writ_Notif_Date and is_workday=1)
	  when Receipt_Datetime>Ext_Mbr_Writ_Notif_Date then (select count(*)*(-1) from sheiladb.dbo.date_reference where calendar_date between Ext_Mbr_Writ_Notif_Date and Receipt_Datetime and is_workday=1)
	  else null end when datepart(dw,receipt_date) in ('5','6','7') then datediff(dd,Receipt_Date,Ext_Mbr_Writ_Notif_Date) end
,Ext_Mbr_Writ_Notif_TAT_Hours = null--cast(datediff(minute,Receipt_DateTime,Ext_Mbr_Writ_Notif_Date)/60.0 as money)
,Ext_Prov_Writ_Notif_TAT_Days = case when datepart(dw,receipt_date) in ('1','2','3','4') 
	then case when Receipt_Datetime<=Ext_Prov_Writ_Notif_Date then (select count(*) from sheiladb.dbo.date_reference where calendar_date between Receipt_Datetime and Ext_Prov_Writ_Notif_Date and is_workday=1)
	  when Receipt_Datetime>Ext_Prov_Writ_Notif_Date then (select count(*)*(-1) from sheiladb.dbo.date_reference where calendar_date between Ext_Prov_Writ_Notif_Date and Receipt_Datetime and is_workday=1)
	  else null end when datepart(dw,receipt_date) in ('5','6','7') then datediff(dd,Receipt_Date,Ext_Prov_Writ_Notif_Date) end
,Ext_Prov_Writ_Notif_TAT_Hours = null--cast(datediff(minute,Receipt_DateTime,Ext_Prov_Writ_Notif_DateTime)/60.0 as money)
,ext_dd =  case when len(extension)<=3 then extension else null end
,ext_hh =  case when len(extension)<=3 then extension*24 else null end 
,ext = case when len(extension)<=3 then 'Y' when Delay_Dec is not null then delay_dec else '' end
,ext_notif_dd = case when Extension_Date <> '' then datediff(dd,Receipt_datetime,Extension_Date) else null end 
,info_dd = case when Info_Days <= Decision_Date then datediff(dd,Receipt_date,Info_Days) else null end 
,info_hh = case when Info_Datetime <= Decision_DateTime then datediff(minute,Receipt_datetime,Info_Datetime)/60.0 else null end
,info = case when dbname='WA' and Info_Days is not null and Info_Days <= Decision_Date then 'Y' else '' end 
,'N           ' compliant_fin, 'NA' tat_day, 'NA' tat_hour, 'NA' Timely_Letter
, 'NA' Timely_Mbr_Notif, 'NA' Timely_Prov_Notif, 'NA' Timely_Mbr_Writ_Notif, 'NA' Timely_Prov_Writ_Notif, 'NA' Timely_Ext_Mbr_Writ_Notif, 'NA' Timely_Ext_Prov_Writ_Notif
from dbo.AuthTAT_attr_rcpdec c (nolock) where planname = 'MS' and acuity_tat = 'Standard' and lobname <>'Marketplace'

update dbo.AuthTAT_timeframe set tat_hh = CONVERT(DECIMAL(10,2),tat_hh)
,ltr_hh = CONVERT(DECIMAL(10,2),info_hh)
,info_hh = CONVERT(DECIMAL(10,2),info_hh)
,ext_hh = convert(decimal(10,2),ext_hh)
,Ext_Mbr_Writ_Notif_TAT_Hours = convert(decimal(10,2),Ext_Mbr_Writ_Notif_TAT_Hours)
,Ext_Prov_Writ_Notif_TAT_Hours = convert(decimal(10,2),Ext_Prov_Writ_Notif_TAT_Hours)
,Mbr_Notif_TAT_Hours = convert(decimal(10,2),Mbr_Notif_TAT_Hours)
,Mbr_Writ_Notif_TAT_Hours = convert(decimal(10,2),Mbr_Writ_Notif_TAT_Hours)
,Prov_Notif_TAT_Hours = convert(decimal(10,2),Prov_Notif_TAT_Hours)
,Prov_Writ_Notif_TAT_Hours = convert(decimal(10,2),Prov_Writ_Notif_TAT_Hours)

--============================================== calc compliant ======================================================
update dbo.AuthTAT_timeframe 
set compliant_fin=
 case
--MKTPL
--STD
	when planname in ('MS') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and tat_dd>=0 and tat_dd<=14 then 'Y'
	when planname in ('MS') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and (tat_dd<0 or tat_dd>14) then 'N'
	when planname in ('MI','SC','WI','FL') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and tat_dd>=0 and tat_dd<=15 then 'Y'
	when planname in ('MI','SC','WI','FL') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and (tat_dd<0 or tat_dd>15) then 'N'
	when planname in ('NM') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and tat_dd>=0 and tat_dd<=15 then 'Y'
	when planname in ('NM') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and (tat_dd<0 or tat_dd>15) then 'N'
	when planname in ('TX') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and tat_dd>=0 and tat_dd<=3 then 'Y'
	when planname in ('TX') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and (tat_dd<0 or tat_dd>3) then 'N'
--URG
	when planname in ('FL','MS') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and tat_hh>=0 and tat_hh<=72 then 'Y'
	when planname in ('FL','MS') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and (tat_hh<0 or tat_hh>72) then 'N'
	when planname in ('NM') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and tat_hh>=0 and tat_hh<=24 then 'Y'
	when planname in ('NM') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and (tat_hh<0 or tat_hh>24) then 'N'
	when planname in ('WI') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and tat_hh>=0 and tat_hh<=72 then 'Y'
	when planname in ('WI') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and (tat_hh<0 or tat_hh>72) then 'N'
--IP
	when rpt='IP' and lobname='MarketPlace' and ReceiptDate_tat > '2019-12-31' and Extension_Date is not null and ext_notif_dd in ('0','1') and tat_hh between 0 and 72 then 'Y'
	when rpt='IP' and lobname='MarketPlace' and ReceiptDate_tat > '2019-12-31' and (Extension_Date is null or ext_notif_dd not in ('0','1')) and tat_hh between 0 and 24 then 'Y'
--Medicaid
--MS
	when planname = 'MS' and rpt in ('AI','PA','ML') and acuity_tat <>'Standard' and tat_hh between 0 and 24 then 'Y'
	when planname = 'MS' and acuity_tat = 'Standard' and datepart(dw,receipt_date) in ('1','2','3','4') and tat_dd < 3 then 'Y'
	when planname = 'MS' and acuity_tat = 'Standard' and datepart(dw,receipt_date) in ('5','6','7') and tat_dd < 4 then 'Y'
--NY Concurrent & IP
	when planname = 'NY' and Concurrent_Review='Y' and lobname<>'Marketplace' and rpt = 'IP' and tat_dd>=0 and tat_dd<=1 then 'Y'
	when planname = 'NY' and Concurrent_Review='N' and lobname<>'Marketplace' and rpt = 'IP' and tat_dd>=0 and tat_dd<=3 then 'Y'
--WA   
	when rpt in ('AI','PA','ML','EV') and planname='WA' and info='Y' and (info_hh <= 0 or info_dd <= 0) then ''
	when rpt in ('AI','PA','ML','EV') and planname='WA' and acuity_tat='Urgent' and info='Y' and ext<>'Y' and info_hh >= 0 and info_hh <= 24 and tat_hh >= 0 and tat_hh <= 120 then 'Y'
	when rpt in ('AI','PA','ML','EV') and planname='WA' and acuity_tat='Urgent' and info='Y' and ext='Y' and info_hh >= 0 and info_hh <= 24 and tat_dd >= 0 and tat_dd <= 19 then 'Y'
	when rpt in ('AI','PA','ML','EV') and planname='WA' and acuity_tat='Urgent' and ext<>'Y' and tat_hh between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML','EV') and planname='WA' and acuity_tat='Urgent' and ext='Y' and ((tat_dd is not null and tat_dd+ext_dd <= ext_dd+14) or (tat_dd is null and ext_dd <= 14)) then 'Y'	  	  
	when rpt in ('AI','PA','ML','EV') and planname='WA' and acuity_tat='Standard' and info='Y' and ext='' and info_dd >= 0 and info_dd <= 5 and tat_dd >= 0 and tat_dd <= 28 then 'Y' 
	when rpt in ('AI','PA','ML','EV') and planname='WA' and acuity_tat='Standard' and info='Y' and ext='Y' and info_dd >= 0 and info_dd <= 5 and tat_dd <=28  then 'Y' 
	when rpt in ('AI','PA','ML','EV') and planname='WA' and acuity_tat='Standard' and ext='' and tat_dd >= 0 and tat_dd <= 5 then 'Y' 
	when rpt in ('AI','PA','ML','EV') and planname='WA' and acuity_tat='Standard' and ext='Y' and ((tat_dd is not null and tat_dd+ext_dd <= ext_dd+14) or (tat_dd is null and ext_dd <= 14)) then 'Y'	  
--Standard 
	when rpt in ('AI','PA','ML','EV') and planname in ('MI','NM','SC','WI') and lobname <> 'Marketplace' and acuity_tat='Standard' and ext<>'Y' and tat_dd between 0 and 14 then 'Y' 
	when rpt in ('AI','PA','ML','EV') and planname in ('UT','ID') and acuity_tat='Standard' and ext<>'Y' and tat_dd between 0 and 14 then 'Y' 
	when rpt in ('AI','PA','ML','EV') and planname='OH' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and tat_dd >= 0 and tat_dd <= 10 then 'Y'
	when rpt in ('AI','PA','ML','EV') and planname='OH' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and (tat_dd < 0 or tat_dd > 10) then 'N'
	when rpt in ('AI','PA','ML','EV') and planname='OH' and acuity_tat='Standard' and lobname<>'MarketPlace' and ext<>'Y' and tat_dd between 0 and 14 then 'Y'  
	when rpt in ('AI','PA','ML','EV') and planname='OH' and acuity_tat='Standard' and lobname='MarketPlace' and ext<>'Y' and tat_hh between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML','EV') and planname='FL' and acuity_tat='Standard' and ext<>'Y' and tat_dd between 0 and 7 then 'Y'
	when rpt in ('AI','PA','ML','EV') and planname='PR' and acuity_tat='Standard' and ext<>'Y' and tat_hh between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML','EV') and planname='CA' and acuity_tat='Standard' and ext<>'Y' and tat_dd between 0 and 5 then 'Y'  
  	when rpt in ('AI','PA','ML','EV') and planname='IL' and acuity_tat='Standard' and ext<>'Y' and tat_dd between 0 and 4 then 'Y'  
	when rpt in ('AI','PA','ML','EV') and planname='IL' and acuity_tat='Standard' and ext<>'Y' and tat_dd between 0 and 10 then 'Y'  
	when rpt in ('AI','PA','ML','EV') and planname='TX' and acuity_tat='Standard' and tat_dd between 0 and 3 then 'Y' 
	when rpt in ('AI','PA','ML','EV') and planname='NY' and acuity_tat='Standard' and Concurrent_Review='N' and ext<>'Y' and tat_dd between 0 and 3 then 'Y'
--Urgent 
	when rpt in ('AI','PA','ML') and planname in ('NM') and lobname <> 'MarketPlace' and acuity_tat='Urgent' and ext<>'Y' and tat_hh between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname in ('MI','UT','CA','SC','ID') and acuity_tat='Urgent' and ext<>'Y' and tat_hh between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Urgent' and ext<>'Y' and tat_hh between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and tat_dd between 0 and 2 and receipt_date >= '2018-12-01' then 'Y'  
	when rpt in ('PA','ML') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and tat_dd between 0 and 3 and receipt_date < '2018-12-01' then 'Y'  
	when rpt in ('AI') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and tat_hh between 0 and 48 and receipt_date < '2018-12-01' then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Urgent' and ext<>'Y' and tat_hh between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='TX' and acuity_tat='Urgent' and ext<>'Y' and tat_hh between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='WI' and lobname <>'Marketplace' and acuity_tat='Urgent' and ext<>'Y' and tat_dd between 0 and 3 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='PR' and acuity_tat='Urgent' and ext<>'Y' and tat_hh between 0 and 24 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='NY' and acuity_tat='Urgent' and ext<>'Y' and tat_dd between 0 and 1 then 'Y'
--Standard & Urgent Extension 
	when rpt in ('AI','PA','ML') and planname ='OH' and acuity_tat='Urgent' and ext='Y' and tat_dd is not null and tat_dd <= 16 then 'Y'
	when rpt in ('AI','PA','ML') and planname ='OH' and acuity_tat='Standard' and ext='Y' and tat_dd is not null and tat_dd <= 24 then 'Y'
	when rpt in ('AI','PA','ML') and planname ='MI' and ext='Y' and tat_dd is not null and tat_dd <= 17 then 'Y'
	when rpt in ('AI','PA','ML') and planname in ('CA','NM','PR','SC','UT','WI','ID') and ext='Y' and ((tat_dd is not null and tat_dd+ext_dd <= ext_dd+14) or (tat_dd is null and ext_dd <= 14)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and tat_dd<=8 then 'Y'
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and ((tat_dd is not null and tat_dd+ext_dd <= ext_dd+10) or (tat_dd is null and ext_dd <= 10)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='TX' and ext='Y' and ((tat_dd is not null and tat_dd+ext_dd <= ext_dd+3) or (tat_dd is null and ext_dd <= 3)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='NY' and ext<>'Y' and Concurrent_Review='N' and tat_dd between 0 and 14 then 'Y'
	when rpt in ('PA','ML') and planname='FL' and acuity_tat='Urgent' and ext='Y' and tat_dd between 0 and 5 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI') and planname='FL' and acuity_tat='Urgent' and ext='Y' and tat_dd between 0 and 4 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext='Y' and tat_dd between 0 and 14 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext='Y' and tat_dd between 0 and 11 and receipt_date >= '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Urgent' and ext='Y' and tat_dd between 0 and 3 and receipt_date >= '2018-12-01' then 'Y'
	--IP 
	when rpt='IP' and lobname <>'MarketPlace' and planname = 'MI' and tat_hh between 0 and 72 then 'Y'	
	when rpt='IP' and lobname <>'MarketPlace' and planname = 'PR' and datepart(dw,receiptdate_tat) in ('2','3','4','5','6') and tat_hh between 0 and 24 then 'Y'	
	when rpt='IP' and lobname <>'MarketPlace' and planname = 'PR' and datepart(dw,receiptdate_tat) in ('1','7') and tat_hh between 0 and 72 then 'Y'	
	when rpt='IP' and lobname = 'Medicaid' and planname = 'NY' and Concurrent_Review ='N' and tat_dd between 0 and 3 then 'Y'
	when rpt='IP' and lobname <>'MarketPlace' and (planname in ('OH','SC') or (planname = 'FL' and ReceiptDate_tat <= '2018-07-13') or lobname='Medicaid EP') and ext='' and tat_hh between 0 and 24 then 'Y'	
	when rpt='IP' and lobname <>'MarketPlace' and (planname in ('OH','SC') or (planname = 'FL' and ReceiptDate_tat <= '2018-07-13') or lobname='Medicaid EP') and ext='Y' and tat_hh between 0 and 72 then 'Y'	
	when rpt='IP' and lobname <>'MarketPlace' and (planname in ('CA') or (planname in ('UT','FL') and Receiptdate_tat > '2018-07-13' and authorizationid not like 'm%'))
	and Extension_Date is not null and ext_notif_dd in ('0','1') and tat_dd between 0 and 3 then 'Y'	--5/11/2018: add extension attribute tat logic to meet ncqa requirements
	when rpt='IP' and lobname <>'MarketPlace' and (planname in ('CA') or (planname in ('UT','FL') and Receiptdate_tat > '2018-07-13' and authorizationid not like 'm%')) and (Extension_Date is null or ext_notif_dd > 2 or ext_notif_dd < 0) and tat_dd between 0 and 1 then 'Y'	
	when rpt='IP' and lobname <>'MarketPlace' and planname in ('CA','UT','WA','WI','NM','IL','TX','ID') and ext='' and tat_dd between 0 and 1 then 'Y'	
	when rpt='IP' and lobname <>'MarketPlace' and planname in ('CA','UT','WA','WI','NM','IL','TX','ID') and ext='Y' and tat_dd between 0 and 3 then 'Y'
  	when rpt='IP' and lobname <>'Marketplace' and planname='MS' and tat_dd between 0 and 1 then 'Y'	
  	else compliant_fin end 

update dbo.AuthTAT_timeframe
set Timely_Letter=
 case
 --MS temporary
	when planname = 'MS' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and ltr_dd>=0 and ltr_dd<=14 then 'Y'
	when planname = 'MS' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and (ltr_dd<0 or ltr_dd>14) then 'N'
	when planname = 'FL' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and ltr_dd>=0 and ltr_dd<=15 then 'Y'
	when planname = 'FL' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and (ltr_dd<0 or ltr_dd>15) then 'N'
	when planname in ('FL','MS') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and Receiptdate_tat >= '2020-01-01' and ltr_hh>=0 and ltr_hh<=72 then 'Y'
	when planname in ('FL','MS') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and Receiptdate_tat >= '2020-01-01' and (ltr_hh<0 or ltr_hh>72) then 'N'
 	when rpt in ('AI','PA','ML') and planname ='MS' and acuity_tat <>'Standard' and ltr_hh between 0 and 24 then 'Y'
	when planname = 'MS' and acuity_tat = 'Standard' and datepart(dw,receipt_date) in ('1','2','3','4') and ltr_dd < 3 then 'Y'
	when planname = 'MS' and acuity_tat = 'Standard' and datepart(dw,receipt_date) in ('5','6','7') and ltr_dd < 4 then 'Y'
--WA   
--6/28/2018: WA change urgent TAT allowance from 72h to 120h if addtl info req w/in 24h 
	when rpt in ('AI','PA','ML') and planname='WA' and info='Y' and (info_hh <= 0 or info_dd <= 0) then ''
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and info='Y' and ext<>'Y' and info_hh >= 0 and info_hh <= 24 and ltr_hh >= 0 and ltr_hh <= 120 then 'Y'
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and info='Y' and ext='Y' and info_hh >= 0 and info_hh <= 24 and ltr_dd >= 0 and ltr_dd <= 19 then 'Y'
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and ext<>'Y' and ltr_hh between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and ext='Y' and ((ltr_dd is not null and ltr_dd+ext_dd <= ext_dd+14) or (ltr_dd is null and ext_dd <= 14)) then 'Y'	  	  
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and info='Y' and ext='' and info_dd >= 0 and info_dd <= 5 and ltr_dd >= 0 and ltr_dd <= 28 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and info='Y' and ext='Y' and info_dd >= 0 and info_dd <= 5 and ltr_dd <=28  then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and ext='' and ltr_dd >= 0 and ltr_dd <= 5 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and ext='Y' and ((ltr_dd is not null and ltr_dd+ext_dd <= ext_dd+14) or (ltr_dd is null and ext_dd <= 14)) then 'Y'	  
--Standard 
	when rpt in ('AI','PA','ML') and planname in ('MI','NM','SC','UT','WI','ID') and acuity_tat='Standard' and ext<>'Y' and ltr_dd between 0 and 14 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and ltr_dd >= 0 and ltr_dd <= 10 then 'Y'
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and (ltr_dd < 0 or ltr_dd > 10) then 'N'
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and lobname<>'MarketPlace' and ext<>'Y' and ltr_dd between 0 and 14 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and lobname='MarketPlace' and ext<>'Y' and ltr_hh between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext<>'Y' and ltr_dd between 0 and 7 then 'Y'
	when rpt in ('AI','PA','ML') and planname='PR' and acuity_tat='Standard' and ext<>'Y' and ltr_hh between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='CA' and acuity_tat='Standard' and ext<>'Y' and ltr_dd between 0 and 5 then 'Y'  
  	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and ltr_dd between 0 and 4 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Standard' and Receiptdate_tat <= '2018-01-01' and ext<>'Y' and ltr_dd between 0 and 10 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='TX' and acuity_tat='Standard' and ext<>'Y' and ltr_dd between 0 and 3 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='NY' and acuity_tat='Standard' and ext<>'Y' and ltr_dd between 0 and 3 then 'Y'
--Urgent 
	when rpt in ('AI','PA','ML') and (planname in ('MI','UT','CA','NM','SC','ID') or (planname='OH'and Receiptdate_tat<'2018-01-01')) and acuity_tat='Urgent' and ext<>'Y' and ltr_hh between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Urgent' and ext<>'Y' and ltr_hh between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and ltr_dd between 0 and 2 and receipt_date >= '2018-12-01' then 'Y'  
	when rpt in ('PA','ML') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and ltr_dd between 0 and 3 and receipt_date < '2018-12-01' then 'Y'  
	when rpt in ('AI') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and ltr_hh between 0 and 48 and receipt_date < '2018-12-01' then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Urgent' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and ltr_hh between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Urgent' and Receiptdate_tat <= '2018-01-01' and ext<>'Y' and ltr_hh between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='TX' and acuity_tat='Urgent' and Receiptdate_tat>= '2019-01-01' and ext<>'Y' and ltr_hh between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='WI' and acuity_tat='Urgent' and Receiptdate_tat>= '2019-01-01' and ext<>'Y' and ltr_dd between 0 and 3 then 'Y'  
	when rpt in ('AI','PA','ML') and planname in ('TX','WI') and acuity_tat='Urgent' and Receiptdate_tat< '2019-01-01' and ext<>'Y' and ltr_dd between 0 and 3 then 'Y'  
	when rpt in ('AI','PA') and planname='PR' and acuity_tat='Urgent' and ext<>'Y' and ltr_hh between 0 and 24 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='NY' and acuity_tat='Urgent' and ext<>'Y' and ltr_dd between 0 and 1 then 'Y'
--Standard & Urgent Extension 
	when rpt in ('AI','PA','ML') and planname ='OH' and acuity_tat='Urgent' and ext='Y' and ltr_dd is not null and ltr_dd <= 16 then 'Y'
	when rpt in ('AI','PA','ML') and planname ='OH' and acuity_tat='Standard' and ext='Y' and ltr_dd is not null and ltr_dd <= 24 then 'Y'
	when rpt in ('AI','PA','ML') and planname ='MI' and ext='Y' and ltr_dd is not null and ltr_dd <= 17 then 'Y'
	when rpt in ('AI','PA','ML') and planname in ('CA','NM','PR','SC','UT','WI','ID') and ext='Y' and ((ltr_dd is not null and ltr_dd+ext_dd <= ext_dd+14) or (ltr_dd is null and ext_dd <= 14)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and Receiptdate_tat >= '2018-01-01' and ltr_dd<=8 then 'Y'
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and Receiptdate_tat <= '2018-01-01' and ltr_dd<=14 then 'Y'
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and ((ltr_dd is not null and ltr_dd+ext_dd <= ext_dd+10) or (ltr_dd is null and ext_dd <= 10)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='TX' and ext='Y' and ((ltr_dd is not null and ltr_dd+ext_dd <= ext_dd+3) or (ltr_dd is null and ext_dd <= 3)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='NY' and ext<>'Y' and ltr_dd between 0 and 14 then 'Y'
	when rpt in ('PA','ML') and planname='FL' and acuity_tat='Urgent' and ext='Y' and ltr_dd between 0 and 5 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI') and planname='FL' and acuity_tat='Urgent' and ext='Y' and ltr_dd between 0 and 4 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext='Y' and ltr_dd between 0 and 14 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext='Y' and ltr_dd between 0 and 11 and receipt_date >= '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Urgent' and ext='Y' and ltr_dd between 0 and 3 and receipt_date >= '2018-12-01' then 'Y'
	--IP 
	when rpt='IP' and lobname='MarketPlace' and ReceiptDate_tat > '2019-12-31' and Extension_Date is not null and ext_notif_dd in ('0','1') and ltr_hh between 0 and 72 then 'Y'
	when rpt='IP' and lobname='MarketPlace' and ReceiptDate_tat > '2019-12-31' and (Extension_Date is null or ext_notif_dd not in ('0','1')) and ltr_hh between 0 and 24 then 'Y'
	when rpt='IP' and planname = 'MI' and ltr_hh between 0 and 72 then 'Y'	
	when rpt='IP' and planname = 'PR' and datepart(dw,receiptdate_tat) in ('2','3','4','5','6') and ltr_hh between 0 and 24 then 'Y'	
	when rpt='IP' and planname = 'PR' and datepart(dw,receiptdate_tat) in ('1','7') and ltr_hh between 0 and 72 then 'Y'	
	when rpt='IP' and (planname in ('NY','OH','SC') or (planname = 'FL' and ReceiptDate_tat <= '2018-07-13')) and ext='' and ltr_hh between 0 and 24 then 'Y'	
	when rpt='IP' and (planname in ('NY','OH','SC') or (planname = 'FL' and ReceiptDate_tat <= '2018-07-13')) and ext='Y' and ltr_hh between 0 and 72 then 'Y'	
	when rpt='IP' and (planname in ('CA') or (planname in ('UT','FL') and Receiptdate_tat > '2018-07-13' and authorizationid not like 'm%')) and Extension_Date is not null and ext_notif_dd in ('0','1') and ltr_dd between 0 and 3 then 'Y'	--5/11/2018: add extension attribute tat logic to meet ncqa requirements
	when rpt='IP' and (planname in ('CA') or (planname in ('UT','FL') and Receiptdate_tat > '2018-07-13' and authorizationid not like 'm%')) and (Extension_Date is null or ext_notif_dd > 2 or ext_notif_dd < 0) and ltr_dd between 0 and 1 then 'Y'	
	when rpt='IP' and planname in ('CA','UT','WA','WI','NM','IL','TX','ID') and ext='' and ltr_dd between 0 and 1 then 'Y'	
	when rpt='IP' and planname in ('CA','UT','WA','WI','NM','IL','TX','ID') and ext='Y' and ltr_dd between 0 and 3 then 'Y'
	when rpt='IP' and planname='MS' and ltr_dd between 0 and 1 then 'Y'	
  	else timely_letter end

--Mbr Prov Notif Timeliness
update dbo.AuthTAT_timeframe
set Timely_Mbr_Notif =  case
 --MS temporary
 	when planname = 'MS' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and Mbr_Notif_TAT_Days>=0 and Mbr_Notif_TAT_Days<=14 then 'Y'
	when planname = 'MS' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and (Mbr_Notif_TAT_Days<0 or Mbr_Notif_TAT_Days>14) then 'N'
	when planname = 'FL' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and Mbr_Notif_TAT_Days>=0 and Mbr_Notif_TAT_Days<=15 then 'Y'
	when planname = 'FL' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and (Mbr_Notif_TAT_Days<0 or Mbr_Notif_TAT_Days>15) then 'N'
	when planname in ('FL','MS') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and Receiptdate_tat >= '2020-01-01' and Mbr_Notif_TAT_Hours>=0 and Mbr_Notif_TAT_Hours<=72 then 'Y'
	when planname in ('FL','MS') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and Receiptdate_tat >= '2020-01-01' and (Mbr_Notif_TAT_Hours<0 or Mbr_Notif_TAT_Hours>72) then 'N'
 	when rpt in ('AI','PA','ML','EV') and planname ='MS' and acuity_tat <>'Standard' and Mbr_Notif_TAT_Hours between 0 and 24 then 'Y'
	when planname = 'MS' and acuity_tat = 'Standard' and datepart(dw,receipt_date) in ('1','2','3','4') and Mbr_Notif_TAT_Days < 3 then 'Y'
	when planname = 'MS' and acuity_tat = 'Standard' and datepart(dw,receipt_date) in ('5','6','7') and Mbr_Notif_TAT_Days < 4 then 'Y'
--WA   
--6/28/2018: WA change urgent TAT allowance from 72h to 120h if addtl info req w/in 24h 
	when rpt in ('AI','PA','ML') and planname='WA' and info='Y' and (info_hh <= 0 or info_dd <= 0) then ''
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and info='Y' and ext<>'Y' and info_hh >= 0 and info_hh <= 24 and Mbr_Notif_TAT_Hours >= 0 and Mbr_Notif_TAT_Hours <= 120 then 'Y'
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and info='Y' and ext='Y' and info_hh >= 0 and info_hh <= 24 and Mbr_Notif_TAT_Days >= 0 and Mbr_Notif_TAT_Days <= 19 then 'Y'
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and ext<>'Y' and Mbr_Notif_TAT_Hours between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and ext='Y' and ((Mbr_Notif_TAT_Days is not null and Mbr_Notif_TAT_Days+ext_dd <= ext_dd+14) or (Mbr_Notif_TAT_Days is null and ext_dd <= 14)) then 'Y'	  	  
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and info='Y' and ext='' and info_dd >= 0 and info_dd <= 5 and Mbr_Notif_TAT_Days >= 0 and Mbr_Notif_TAT_Days <= 28 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and info='Y' and ext='Y' and info_dd >= 0 and info_dd <= 5 and Mbr_Notif_TAT_Days <=28  then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and ext='' and Mbr_Notif_TAT_Days >= 0 and Mbr_Notif_TAT_Days <= 5 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and ext='Y' and ((Mbr_Notif_TAT_Days is not null and Mbr_Notif_TAT_Days+ext_dd <= ext_dd+14) or (Mbr_Notif_TAT_Days is null and ext_dd <= 14)) then 'Y'	  
--Standard 
	when rpt in ('AI','PA','ML') and planname in ('MI','NM','SC','UT','WI','ID') and acuity_tat='Standard' and ext<>'Y' and Mbr_Notif_TAT_Days between 0 and 14 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and Mbr_Notif_TAT_Days >= 0 and Mbr_Notif_TAT_Days <= 10 then 'Y'
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and (Mbr_Notif_TAT_Days < 0 or Mbr_Notif_TAT_Days > 10) then 'N'
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and lobname<>'MarketPlace' and ext<>'Y' and Mbr_Notif_TAT_Days between 0 and 14 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and lobname='MarketPlace' and ext<>'Y' and Mbr_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext<>'Y' and Mbr_Notif_TAT_Days between 0 and 7 then 'Y'
	when rpt in ('AI','PA','ML') and planname='PR' and acuity_tat='Standard' and ext<>'Y' and Mbr_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='CA' and acuity_tat='Standard' and ext<>'Y' and Mbr_Notif_TAT_Days between 0 and 5 then 'Y'  
  	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and Mbr_Notif_TAT_Days between 0 and 4 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Standard' and Receiptdate_tat <= '2018-01-01' and ext<>'Y' and Mbr_Notif_TAT_Days between 0 and 10 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='TX' and acuity_tat='Standard' and ext<>'Y' and Mbr_Notif_TAT_Days between 0 and 3 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='NY' and acuity_tat='Standard' and ext<>'Y' and Mbr_Notif_TAT_Days between 0 and 3 then 'Y'
--Urgent 
	when rpt in ('AI','PA','ML') and (planname in ('MI','UT','CA','NM','SC','ID') or (planname='OH'and Receiptdate_tat<'2018-01-01')) and acuity_tat='Urgent' and ext<>'Y' and Mbr_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Urgent' and ext<>'Y' and Mbr_Notif_TAT_Hours between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and Mbr_Notif_TAT_Days between 0 and 2 and receipt_date >= '2018-12-01' then 'Y'  
	when rpt in ('PA','ML') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and Mbr_Notif_TAT_Days between 0 and 3 and receipt_date < '2018-12-01' then 'Y'  
	when rpt in ('AI') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and Mbr_Notif_TAT_Hours between 0 and 48 and receipt_date < '2018-12-01' then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Urgent' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and Mbr_Notif_TAT_Hours between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Urgent' and Receiptdate_tat <= '2018-01-01' and ext<>'Y' and Mbr_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='TX' and acuity_tat='Urgent' and Receiptdate_tat>= '2019-01-01' and ext<>'Y' and Mbr_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='WI' and acuity_tat='Urgent' and Receiptdate_tat>= '2019-01-01' and ext<>'Y' and Mbr_Notif_TAT_Days between 0 and 3 then 'Y'  
	when rpt in ('AI','PA','ML') and planname in ('TX','WI') and acuity_tat='Urgent' and Receiptdate_tat< '2019-01-01' and ext<>'Y' and Mbr_Notif_TAT_Days between 0 and 3 then 'Y'  
	when rpt in ('AI','PA') and planname='PR' and acuity_tat='Urgent' and ext<>'Y' and Mbr_Notif_TAT_Hours between 0 and 24 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='NY' and acuity_tat='Urgent' and ext<>'Y' and Mbr_Notif_TAT_Days between 0 and 1 then 'Y'
--Standard & Urgent Extension 
	when rpt in ('AI','PA','ML') and planname ='OH' and acuity_tat='Urgent' and ext='Y' and Mbr_Notif_TAT_Days is not null and Mbr_Notif_TAT_Days <= 16 then 'Y'
	when rpt in ('AI','PA','ML') and planname ='OH' and acuity_tat='Standard' and ext='Y' and Mbr_Notif_TAT_Days is not null and Mbr_Notif_TAT_Days <= 24 then 'Y'
	when rpt in ('AI','PA','ML') and planname ='MI' and ext='Y' and Mbr_Notif_TAT_Days is not null and Mbr_Notif_TAT_Days <= 17 then 'Y'
	when rpt in ('AI','PA','ML') and planname in ('CA','NM','PR','SC','UT','WI','ID') and ext='Y' and ((Mbr_Notif_TAT_Days is not null and Mbr_Notif_TAT_Days+ext_dd <= ext_dd+14) or (Mbr_Notif_TAT_Days is null and ext_dd <= 14)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and Receiptdate_tat >= '2018-01-01' and Mbr_Notif_TAT_Days<=8 then 'Y'
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and Receiptdate_tat <= '2018-01-01' and Mbr_Notif_TAT_Days<=14 then 'Y'
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and ((Mbr_Notif_TAT_Days is not null and Mbr_Notif_TAT_Days+ext_dd <= ext_dd+10) or (Mbr_Notif_TAT_Days is null and ext_dd <= 10)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='TX' and ext='Y' and ((Mbr_Notif_TAT_Days is not null and Mbr_Notif_TAT_Days+ext_dd <= ext_dd+3) or (Mbr_Notif_TAT_Days is null and ext_dd <= 3)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='NY' and ext<>'Y' and Mbr_Notif_TAT_Days between 0 and 14 then 'Y'
	when rpt in ('PA','ML') and planname='FL' and acuity_tat='Urgent' and ext='Y' and Mbr_Notif_TAT_Days between 0 and 5 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI') and planname='FL' and acuity_tat='Urgent' and ext='Y' and Mbr_Notif_TAT_Days between 0 and 4 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext='Y' and Mbr_Notif_TAT_Days between 0 and 14 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext='Y' and Mbr_Notif_TAT_Days between 0 and 11 and receipt_date >= '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Urgent' and ext='Y' and Mbr_Notif_TAT_Days between 0 and 3 and receipt_date >= '2018-12-01' then 'Y'
	--IP 
	when rpt='IP' and lobname='MarketPlace' and ReceiptDate_tat > '2019-12-31' and Extension_Date is not null and ext_notif_dd in ('0','1') and Mbr_Notif_TAT_Hours between 0 and 72 then 'Y'
	when rpt='IP' and lobname='MarketPlace' and ReceiptDate_tat > '2019-12-31' and (Extension_Date is null or ext_notif_dd not in ('0','1')) and Mbr_Notif_TAT_Hours between 0 and 24 then 'Y'
	when rpt='IP' and planname = 'MI' and Mbr_Notif_TAT_Hours between 0 and 72 then 'Y'	
	when rpt='IP' and planname = 'PR' and datepart(dw,receiptdate_tat) in ('2','3','4','5','6') and Mbr_Notif_TAT_Hours between 0 and 24 then 'Y'	
	when rpt='IP' and planname = 'PR' and datepart(dw,receiptdate_tat) in ('1','7') and Mbr_Notif_TAT_Hours between 0 and 72 then 'Y'	
	when rpt='IP' and (planname in ('NY','OH','SC') or (planname = 'FL' and ReceiptDate_tat <= '2018-07-13')) and ext='' and Mbr_Notif_TAT_Hours between 0 and 24 then 'Y'	
	when rpt='IP' and (planname in ('NY','OH','SC') or (planname = 'FL' and ReceiptDate_tat <= '2018-07-13')) and ext='Y' and Mbr_Notif_TAT_Hours between 0 and 72 then 'Y'	
	when rpt='IP' and (planname in ('CA') or (planname in ('UT','FL') and Receiptdate_tat > '2018-07-13' and authorizationid not like 'm%')) and Extension_Date is not null and ext_notif_dd in ('0','1') and Mbr_Notif_TAT_Days between 0 and 3 then 'Y'	--5/11/2018: add extension attribute tat logic to meet ncqa requirements
	when rpt='IP' and (planname in ('CA') or (planname in ('UT','FL') and Receiptdate_tat > '2018-07-13' and authorizationid not like 'm%')) and (Extension_Date is null or ext_notif_dd > 2 or ext_notif_dd < 0) and Mbr_Notif_TAT_Days between 0 and 1 then 'Y'	
	when rpt='IP' and planname in ('CA','UT','WA','WI','NM','IL','TX','ID') and ext='' and Mbr_Notif_TAT_Days between 0 and 1 then 'Y'	
	when rpt='IP' and planname in ('CA','UT','WA','WI','NM','IL','TX','ID') and ext='Y' and Mbr_Notif_TAT_Days between 0 and 3 then 'Y'
	when rpt='IP' and planname='MS' and Mbr_Notif_TAT_Days between 0 and 1 then 'Y'	
	when Mbr_Notif_TAT_Days is not null or Mbr_Notif_TAT_Hours is not null then 'N'
else Timely_Mbr_Notif end

, Timely_Prov_Notif = case
 --MS temporary
  	when planname = 'MS' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and Prov_Notif_TAT_Days>=0 and Prov_Notif_TAT_Days<=14 then 'Y'
	when planname = 'MS' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and (Prov_Notif_TAT_Days<0 or Prov_Notif_TAT_Days>14) then 'N'
	when planname = 'FL' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and Prov_Notif_TAT_Days>=0 and Prov_Notif_TAT_Days<=15 then 'Y'
	when planname = 'FL' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and (Prov_Notif_TAT_Days<0 or Prov_Notif_TAT_Days>15) then 'N'
	when planname in ('FL','MS') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and Receiptdate_tat >= '2020-01-01' and Prov_Notif_TAT_Hours>=0 and Prov_Notif_TAT_Hours<=72 then 'Y'
	when planname in ('FL','MS') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and Receiptdate_tat >= '2020-01-01' and (Prov_Notif_TAT_Hours<0 or Prov_Notif_TAT_Hours>72) then 'N'
 	when rpt in ('AI','PA','ML') and planname ='MS' and acuity_tat <>'Standard' and Prov_Notif_TAT_Hours between 0 and 24 then 'Y'
	when planname = 'MS' and acuity_tat = 'Standard' and datepart(dw,receipt_date) in ('1','2','3','4') and Prov_Notif_TAT_Days < 3 then 'Y'
	when planname = 'MS' and acuity_tat = 'Standard' and datepart(dw,receipt_date) in ('5','6','7') and Prov_Notif_TAT_Days < 4 then 'Y'
--WA   
--6/28/2018: WA change urgent TAT allowance from 72h to 120h if addtl info req w/in 24h 
	when rpt in ('AI','PA','ML') and planname='WA' and info='Y' and (info_hh <= 0 or info_dd <= 0) then ''
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and info='Y' and ext<>'Y' and info_hh >= 0 and info_hh <= 24 and Prov_Notif_TAT_Hours >= 0 and Prov_Notif_TAT_Hours <= 120 then 'Y'
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and info='Y' and ext='Y' and info_hh >= 0 and info_hh <= 24 and Prov_Notif_TAT_Days >= 0 and Prov_Notif_TAT_Days <= 19 then 'Y'
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and ext<>'Y' and Prov_Notif_TAT_Hours between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and ext='Y' and ((Prov_Notif_TAT_Days is not null and Prov_Notif_TAT_Days+ext_dd <= ext_dd+14) or (Prov_Notif_TAT_Days is null and ext_dd <= 14)) then 'Y'	  	  
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and info='Y' and ext='' and info_dd >= 0 and info_dd <= 5 and Prov_Notif_TAT_Days >= 0 and Prov_Notif_TAT_Days <= 28 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and info='Y' and ext='Y' and info_dd >= 0 and info_dd <= 5 and Prov_Notif_TAT_Days <=28  then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and ext='' and Prov_Notif_TAT_Days >= 0 and Prov_Notif_TAT_Days <= 5 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and ext='Y' and ((Prov_Notif_TAT_Days is not null and Prov_Notif_TAT_Days+ext_dd <= ext_dd+14) or (Prov_Notif_TAT_Days is null and ext_dd <= 14)) then 'Y'	  
--Standard 
	when rpt in ('AI','PA','ML') and planname in ('MI','NM','SC','UT','WI','ID') and acuity_tat='Standard' and ext<>'Y' and Prov_Notif_TAT_Days between 0 and 14 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and Prov_Notif_TAT_Days >= 0 and Prov_Notif_TAT_Days <= 10 then 'Y'
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and (Prov_Notif_TAT_Days < 0 or Prov_Notif_TAT_Days > 10) then 'N'
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and lobname<>'MarketPlace' and ext<>'Y' and Prov_Notif_TAT_Days between 0 and 14 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and lobname='MarketPlace' and ext<>'Y' and Prov_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext<>'Y' and Prov_Notif_TAT_Days between 0 and 7 then 'Y'
	when rpt in ('AI','PA','ML') and planname='PR' and acuity_tat='Standard' and ext<>'Y' and Prov_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='CA' and acuity_tat='Standard' and ext<>'Y' and Prov_Notif_TAT_Days between 0 and 5 then 'Y'  
  	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and Prov_Notif_TAT_Days between 0 and 4 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Standard' and Receiptdate_tat <= '2018-01-01' and ext<>'Y' and Prov_Notif_TAT_Days between 0 and 10 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='TX' and acuity_tat='Standard' and ext<>'Y' and Prov_Notif_TAT_Days between 0 and 3 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='NY' and acuity_tat='Standard' and ext<>'Y' and Prov_Notif_TAT_Days between 0 and 3 then 'Y'
--Urgent 
	when rpt in ('AI','PA','ML') and (planname in ('MI','UT','CA','NM','SC','ID') or (planname='OH'and Receiptdate_tat<'2018-01-01')) and acuity_tat='Urgent' and ext<>'Y' and Prov_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Urgent' and ext<>'Y' and Prov_Notif_TAT_Hours between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and Prov_Notif_TAT_Days between 0 and 2 and receipt_date >= '2018-12-01' then 'Y'  
	when rpt in ('PA','ML') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and Prov_Notif_TAT_Days between 0 and 3 and receipt_date < '2018-12-01' then 'Y'  
	when rpt in ('AI') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and Prov_Notif_TAT_Hours between 0 and 48 and receipt_date < '2018-12-01' then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Urgent' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and Prov_Notif_TAT_Hours between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Urgent' and Receiptdate_tat <= '2018-01-01' and ext<>'Y' and Prov_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='TX' and acuity_tat='Urgent' and Receiptdate_tat>= '2019-01-01' and ext<>'Y' and Prov_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='WI' and acuity_tat='Urgent' and Receiptdate_tat>= '2019-01-01' and ext<>'Y' and Prov_Notif_TAT_Days between 0 and 3 then 'Y'  
	when rpt in ('AI','PA','ML') and planname in ('TX','WI') and acuity_tat='Urgent' and Receiptdate_tat< '2019-01-01' and ext<>'Y' and Prov_Notif_TAT_Days between 0 and 3 then 'Y'  
	when rpt in ('AI','PA') and planname='PR' and acuity_tat='Urgent' and ext<>'Y' and Prov_Notif_TAT_Hours between 0 and 24 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='NY' and acuity_tat='Urgent' and ext<>'Y' and Prov_Notif_TAT_Days between 0 and 1 then 'Y'
--Standard & Urgent Extension 
	when rpt in ('AI','PA','ML') and planname ='OH' and acuity_tat='Urgent' and ext='Y' and Prov_Notif_TAT_Days is not null and Prov_Notif_TAT_Days <= 16 then 'Y'
	when rpt in ('AI','PA','ML') and planname ='OH' and acuity_tat='Standard' and ext='Y' and Prov_Notif_TAT_Days is not null and Prov_Notif_TAT_Days <= 24 then 'Y'
	when rpt in ('AI','PA','ML') and planname ='MI' and ext='Y' and Prov_Notif_TAT_Days is not null and Prov_Notif_TAT_Days <= 17 then 'Y'
	when rpt in ('AI','PA','ML') and planname in ('CA','NM','PR','SC','UT','WI','ID') and ext='Y' and ((Prov_Notif_TAT_Days is not null and Prov_Notif_TAT_Days+ext_dd <= ext_dd+14) or (Prov_Notif_TAT_Days is null and ext_dd <= 14)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and Receiptdate_tat >= '2018-01-01' and Prov_Notif_TAT_Days<=8 then 'Y'
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and Receiptdate_tat <= '2018-01-01' and Prov_Notif_TAT_Days<=14 then 'Y'
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and ((Prov_Notif_TAT_Days is not null and Prov_Notif_TAT_Days+ext_dd <= ext_dd+10) or (Prov_Notif_TAT_Days is null and ext_dd <= 10)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='TX' and ext='Y' and ((Prov_Notif_TAT_Days is not null and Prov_Notif_TAT_Days+ext_dd <= ext_dd+3) or (Prov_Notif_TAT_Days is null and ext_dd <= 3)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='NY' and ext<>'Y' and Prov_Notif_TAT_Days between 0 and 14 then 'Y'
	when rpt in ('PA','ML') and planname='FL' and acuity_tat='Urgent' and ext='Y' and Prov_Notif_TAT_Days between 0 and 5 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI') and planname='FL' and acuity_tat='Urgent' and ext='Y' and Prov_Notif_TAT_Days between 0 and 4 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext='Y' and Prov_Notif_TAT_Days between 0 and 14 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext='Y' and Prov_Notif_TAT_Days between 0 and 11 and receipt_date >= '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Urgent' and ext='Y' and Prov_Notif_TAT_Days between 0 and 3 and receipt_date >= '2018-12-01' then 'Y'
	--IP 
	when rpt='IP' and lobname='MarketPlace' and ReceiptDate_tat > '2019-12-31' and Extension_Date is not null and ext_notif_dd in ('0','1') and Prov_Notif_TAT_Hours between 0 and 72 then 'Y'
	when rpt='IP' and lobname='MarketPlace' and ReceiptDate_tat > '2019-12-31' and (Extension_Date is null or ext_notif_dd not in ('0','1')) and Prov_Notif_TAT_Hours between 0 and 24 then 'Y'
	when rpt='IP' and planname = 'MI' and Prov_Notif_TAT_Hours between 0 and 72 then 'Y'	
	when rpt='IP' and planname = 'PR' and datepart(dw,receiptdate_tat) in ('2','3','4','5','6') and Prov_Notif_TAT_Hours between 0 and 24 then 'Y'	
	when rpt='IP' and planname = 'PR' and datepart(dw,receiptdate_tat) in ('1','7') and Prov_Notif_TAT_Hours between 0 and 72 then 'Y'	
	when rpt='IP' and (planname in ('NY','OH','SC') or (planname = 'FL' and ReceiptDate_tat <= '2018-07-13')) and ext='' and Prov_Notif_TAT_Hours between 0 and 24 then 'Y'	
	when rpt='IP' and (planname in ('NY','OH','SC') or (planname = 'FL' and ReceiptDate_tat <= '2018-07-13')) and ext='Y' and Prov_Notif_TAT_Hours between 0 and 72 then 'Y'	
	when rpt='IP' and (planname in ('CA') or (planname in ('UT','FL') and Receiptdate_tat > '2018-07-13' and authorizationid not like 'm%')) and Extension_Date is not null and ext_notif_dd in ('0','1') and Prov_Notif_TAT_Days between 0 and 3 then 'Y'	--5/11/2018: add extension attribute tat logic to meet ncqa requirements
	when rpt='IP' and (planname in ('CA') or (planname in ('UT','FL') and Receiptdate_tat > '2018-07-13' and authorizationid not like 'm%')) and (Extension_Date is null or ext_notif_dd > 2 or ext_notif_dd < 0) and Prov_Notif_TAT_Days between 0 and 1 then 'Y'	
	when rpt='IP' and planname in ('CA','UT','WA','WI','NM','IL','TX','ID') and ext='' and Prov_Notif_TAT_Days between 0 and 1 then 'Y'	
	when rpt='IP' and planname in ('CA','UT','WA','WI','NM','IL','TX','ID') and ext='Y' and Prov_Notif_TAT_Days between 0 and 3 then 'Y'
	when rpt='IP' and planname='MS' and Prov_Notif_TAT_Days between 0 and 1 then 'Y'	
	when Prov_Notif_TAT_Days is not null or Prov_Notif_TAT_Hours is not null then 'N'
  	else Timely_Prov_Notif end

, Timely_Mbr_Writ_Notif =  case
 --MS & FL Marketplace
   	when planname = 'MS' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and Mbr_Writ_Notif_TAT_Days>=0 and Mbr_Writ_Notif_TAT_Days<=14 then 'Y'
	when planname = 'MS' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and (Mbr_Writ_Notif_TAT_Days<0 or Mbr_Writ_Notif_TAT_Days>14) then 'N'
	when planname = 'FL' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and Mbr_Writ_Notif_TAT_Days>=0 and Mbr_Writ_Notif_TAT_Days<=15 then 'Y'
	when planname = 'FL' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and (Mbr_Writ_Notif_TAT_Days<0 or Mbr_Writ_Notif_TAT_Days>15) then 'N'
	when planname in ('FL','MS') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and Receiptdate_tat >= '2020-01-01' and Mbr_Writ_Notif_TAT_Hours>=0 and Mbr_Writ_Notif_TAT_Hours<=72 then 'Y'
	when planname in ('FL','MS') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and Receiptdate_tat >= '2020-01-01' and (Mbr_Writ_Notif_TAT_Hours<0 or Mbr_Writ_Notif_TAT_Hours>72) then 'N'
 	when rpt in ('AI','PA','ML') and planname ='MS' and acuity_tat <>'Standard' and Mbr_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'
	when planname = 'MS' and acuity_tat = 'Standard' and datepart(dw,receipt_date) in ('1','2','3','4') and Mbr_Writ_Notif_TAT_Days < 3 then 'Y'
	when planname = 'MS' and acuity_tat = 'Standard' and datepart(dw,receipt_date) in ('5','6','7') and Mbr_Writ_Notif_TAT_Days < 4 then 'Y'
--WA   
--6/28/2018: WA change urgent TAT allowance from 72h to 120h if addtl info req w/in 24h 
	when rpt in ('AI','PA','ML') and planname='WA' and info='Y' and (info_hh <= 0 or info_dd <= 0) then ''
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and info='Y' and ext<>'Y' and info_hh >= 0 and info_hh <= 24 and Mbr_Writ_Notif_TAT_Hours >= 0 and Mbr_Writ_Notif_TAT_Hours <= 120 then 'Y'
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and info='Y' and ext='Y' and info_hh >= 0 and info_hh <= 24 and Mbr_Writ_Notif_TAT_Days >= 0 and Mbr_Writ_Notif_TAT_Days <= 19 then 'Y'
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and ext<>'Y' and Mbr_Writ_Notif_TAT_Hours between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and ext='Y' and ((Mbr_Writ_Notif_TAT_Days is not null and Mbr_Writ_Notif_TAT_Days+ext_dd <= ext_dd+14) or (Mbr_Writ_Notif_TAT_Days is null and ext_dd <= 14)) then 'Y'	  	  
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and info='Y' and ext='' and info_dd >= 0 and info_dd <= 5 and Mbr_Writ_Notif_TAT_Days >= 0 and Mbr_Writ_Notif_TAT_Days <= 28 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and info='Y' and ext='Y' and info_dd >= 0 and info_dd <= 5 and Mbr_Writ_Notif_TAT_Days <=28  then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and ext='' and Mbr_Writ_Notif_TAT_Days >= 0 and Mbr_Writ_Notif_TAT_Days <= 5 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and ext='Y' and ((Mbr_Writ_Notif_TAT_Days is not null and Mbr_Writ_Notif_TAT_Days+ext_dd <= ext_dd+14) or (Mbr_Writ_Notif_TAT_Days is null and ext_dd <= 14)) then 'Y'	  
--Standard 
	when rpt in ('AI','PA','ML') and planname in ('MI','NM','SC','UT','WI','ID') and acuity_tat='Standard' and ext<>'Y' and Mbr_Writ_Notif_TAT_Days between 0 and 14 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and Mbr_Writ_Notif_TAT_Days >= 0 and Mbr_Writ_Notif_TAT_Days <= 10 then 'Y'
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and (Mbr_Writ_Notif_TAT_Days < 0 or Mbr_Writ_Notif_TAT_Days > 10) then 'N'
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and lobname<>'MarketPlace' and ext<>'Y' and Mbr_Writ_Notif_TAT_Days between 0 and 14 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and lobname='MarketPlace' and ext<>'Y' and Mbr_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext<>'Y' and Mbr_Writ_Notif_TAT_Days between 0 and 7 then 'Y'
	when rpt in ('AI','PA','ML') and planname='PR' and acuity_tat='Standard' and ext<>'Y' and Mbr_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='CA' and acuity_tat='Standard' and ext<>'Y' and Mbr_Writ_Notif_TAT_Days between 0 and 5 then 'Y'  
  	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and Mbr_Writ_Notif_TAT_Days between 0 and 4 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Standard' and Receiptdate_tat <= '2018-01-01' and ext<>'Y' and Mbr_Writ_Notif_TAT_Days between 0 and 10 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='TX' and acuity_tat='Standard' and ext<>'Y' and Mbr_Writ_Notif_TAT_Days between 0 and 3 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='NY' and acuity_tat='Standard' and ext<>'Y' and Mbr_Writ_Notif_TAT_Days between 0 and 3 then 'Y'
--Urgent 
	when rpt in ('AI','PA','ML') and (planname in ('MI','UT','CA','NM','SC','ID') or (planname='OH'and Receiptdate_tat<'2018-01-01')) and acuity_tat='Urgent' and ext<>'Y' and Mbr_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Urgent' and ext<>'Y' and Mbr_Writ_Notif_TAT_Hours between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and Mbr_Writ_Notif_TAT_Days between 0 and 2 and receipt_date >= '2018-12-01' then 'Y'  
	when rpt in ('PA','ML') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and Mbr_Writ_Notif_TAT_Days between 0 and 3 and receipt_date < '2018-12-01' then 'Y'  
	when rpt in ('AI') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and Mbr_Writ_Notif_TAT_Hours between 0 and 48 and receipt_date < '2018-12-01' then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Urgent' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and Mbr_Writ_Notif_TAT_Hours between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Urgent' and Receiptdate_tat <= '2018-01-01' and ext<>'Y' and Mbr_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='TX' and acuity_tat='Urgent' and Receiptdate_tat>= '2019-01-01' and ext<>'Y' and Mbr_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='WI' and acuity_tat='Urgent' and Receiptdate_tat>= '2019-01-01' and ext<>'Y' and Mbr_Writ_Notif_TAT_Days between 0 and 3 then 'Y'  
	when rpt in ('AI','PA','ML') and planname in ('TX','WI') and acuity_tat='Urgent' and Receiptdate_tat< '2019-01-01' and ext<>'Y' and Mbr_Writ_Notif_TAT_Days between 0 and 3 then 'Y'  
	when rpt in ('AI','PA') and planname='PR' and acuity_tat='Urgent' and ext<>'Y' and Mbr_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='NY' and acuity_tat='Urgent' and ext<>'Y' and Mbr_Writ_Notif_TAT_Days between 0 and 1 then 'Y'
--Standard & Urgent Extension 
	when rpt in ('AI','PA','ML') and planname ='OH' and acuity_tat='Urgent' and ext='Y' and Mbr_Writ_Notif_TAT_Days is not null and Mbr_Writ_Notif_TAT_Days <= 16 then 'Y'
	when rpt in ('AI','PA','ML') and planname ='OH' and acuity_tat='Standard' and ext='Y' and Mbr_Writ_Notif_TAT_Days is not null and Mbr_Writ_Notif_TAT_Days <= 24 then 'Y'
	when rpt in ('AI','PA','ML') and planname ='MI' and ext='Y' and Mbr_Writ_Notif_TAT_Days is not null and Mbr_Writ_Notif_TAT_Days <= 17 then 'Y'
	when rpt in ('AI','PA','ML') and planname in ('CA','NM','PR','SC','UT','WI','ID') and ext='Y' and ((Mbr_Writ_Notif_TAT_Days is not null and Mbr_Writ_Notif_TAT_Days+ext_dd <= ext_dd+14) or (Mbr_Writ_Notif_TAT_Days is null and ext_dd <= 14)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and Receiptdate_tat >= '2018-01-01' and Mbr_Writ_Notif_TAT_Days<=8 then 'Y'
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and Receiptdate_tat <= '2018-01-01' and Mbr_Writ_Notif_TAT_Days<=14 then 'Y'
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and ((Mbr_Writ_Notif_TAT_Days is not null and Mbr_Writ_Notif_TAT_Days+ext_dd <= ext_dd+10) or (Mbr_Writ_Notif_TAT_Days is null and ext_dd <= 10)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='TX' and ext='Y' and ((Mbr_Writ_Notif_TAT_Days is not null and Mbr_Writ_Notif_TAT_Days+ext_dd <= ext_dd+3) or (Mbr_Writ_Notif_TAT_Days is null and ext_dd <= 3)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='NY' and ext<>'Y' and Mbr_Writ_Notif_TAT_Days between 0 and 14 then 'Y'
	when rpt in ('PA','ML') and planname='FL' and acuity_tat='Urgent' and ext='Y' and Mbr_Writ_Notif_TAT_Days between 0 and 5 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI') and planname='FL' and acuity_tat='Urgent' and ext='Y' and Mbr_Writ_Notif_TAT_Days between 0 and 4 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext='Y' and Mbr_Writ_Notif_TAT_Days between 0 and 14 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext='Y' and Mbr_Writ_Notif_TAT_Days between 0 and 11 and receipt_date >= '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Urgent' and ext='Y' and Mbr_Writ_Notif_TAT_Days between 0 and 3 and receipt_date >= '2018-12-01' then 'Y'
	--IP 
	when rpt='IP' and lobname='MarketPlace' and ReceiptDate_tat > '2019-12-31' and Extension_Date is not null and ext_notif_dd in ('0','1') and Mbr_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'
	when rpt='IP' and lobname='MarketPlace' and ReceiptDate_tat > '2019-12-31' and (Extension_Date is null or ext_notif_dd not in ('0','1')) and Mbr_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'
	when rpt='IP' and planname = 'MI' and Mbr_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'	
	when rpt='IP' and planname = 'PR' and datepart(dw,receiptdate_tat) in ('2','3','4','5','6') and Mbr_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'	
	when rpt='IP' and planname = 'PR' and datepart(dw,receiptdate_tat) in ('1','7') and Mbr_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'	
	when rpt='IP' and (planname in ('NY','OH','SC') or (planname = 'FL' and ReceiptDate_tat <= '2018-07-13')) and ext='' and Mbr_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'	
	when rpt='IP' and (planname in ('NY','OH','SC') or (planname = 'FL' and ReceiptDate_tat <= '2018-07-13')) and ext='Y' and Mbr_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'	
	when rpt='IP' and (planname in ('CA') or (planname in ('UT','FL') and Receiptdate_tat > '2018-07-13' and authorizationid not like 'm%')) and Extension_Date is not null and ext_notif_dd in ('0','1') and Mbr_Writ_Notif_TAT_Days between 0 and 3 then 'Y'	--5/11/2018: add extension attribute tat logic to meet ncqa requirements
	when rpt='IP' and (planname in ('CA') or (planname in ('UT','FL') and Receiptdate_tat > '2018-07-13' and authorizationid not like 'm%')) and (Extension_Date is null or ext_notif_dd > 2 or ext_notif_dd < 0) and Mbr_Writ_Notif_TAT_Days between 0 and 1 then 'Y'	
	when rpt='IP' and planname in ('CA','UT','WA','WI','NM','IL','TX','ID') and ext='' and Mbr_Writ_Notif_TAT_Days between 0 and 1 then 'Y'	
	when rpt='IP' and planname in ('CA','UT','WA','WI','NM','IL','TX','ID') and ext='Y' and Mbr_Writ_Notif_TAT_Days between 0 and 3 then 'Y'
	when rpt='IP' and planname='MS' and Mbr_Writ_Notif_TAT_Days between 0 and 1 then 'Y'	
	when Mbr_Writ_Notif_TAT_Days is not null or Mbr_Writ_Notif_TAT_Hours is not null then 'N'
  	else Timely_Mbr_Writ_Notif end 
, Timely_Prov_Writ_Notif = case
 --MS 
   	when planname = 'MS' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and Prov_Writ_Notif_TAT_Days>=0 and Prov_Writ_Notif_TAT_Days<=14 then 'Y'
	when planname = 'MS' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and (Prov_Writ_Notif_TAT_Days<0 or Prov_Writ_Notif_TAT_Days>14) then 'N'
	when planname = 'FL' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and Prov_Writ_Notif_TAT_Days>=0 and Prov_Writ_Notif_TAT_Days<=15 then 'Y'
	when planname = 'FL' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and (Prov_Writ_Notif_TAT_Days<0 or Prov_Writ_Notif_TAT_Days>15) then 'N'
	when planname in ('FL','MS') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and Receiptdate_tat >= '2020-01-01' and Prov_Writ_Notif_TAT_Hours>=0 and Prov_Writ_Notif_TAT_Hours<=72 then 'Y'
	when planname in ('FL','MS') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and Receiptdate_tat >= '2020-01-01' and (Prov_Writ_Notif_TAT_Hours<0 or Prov_Writ_Notif_TAT_Hours>72) then 'N'
 	when rpt in ('AI','PA','ML') and planname ='MS' and acuity_tat <>'Standard' and Prov_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'
	when planname = 'MS' and acuity_tat = 'Standard' and datepart(dw,receipt_date) in ('1','2','3','4') and Prov_Writ_Notif_TAT_Days < 3 then 'Y'
	when planname = 'MS' and acuity_tat = 'Standard' and datepart(dw,receipt_date) in ('5','6','7') and Prov_Writ_Notif_TAT_Days < 4 then 'Y'
--WA   
--6/28/2018: WA change urgent TAT allowance from 72h to 120h if addtl info req w/in 24h 
	when rpt in ('AI','PA','ML') and planname='WA' and info='Y' and (info_hh <= 0 or info_dd <= 0) then ''
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and info='Y' and ext<>'Y' and info_hh >= 0 and info_hh <= 24 and Prov_Writ_Notif_TAT_Hours >= 0 and Prov_Writ_Notif_TAT_Hours <= 120 then 'Y'
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and info='Y' and ext='Y' and info_hh >= 0 and info_hh <= 24 and Prov_Writ_Notif_TAT_Days >= 0 and Prov_Writ_Notif_TAT_Days <= 19 then 'Y'
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and ext<>'Y' and Prov_Writ_Notif_TAT_Hours between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and ext='Y' and ((Prov_Writ_Notif_TAT_Days is not null and Prov_Writ_Notif_TAT_Days+ext_dd <= ext_dd+14) or (Prov_Writ_Notif_TAT_Days is null and ext_dd <= 14)) then 'Y'	  	  
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and info='Y' and ext='' and info_dd >= 0 and info_dd <= 5 and Prov_Writ_Notif_TAT_Days >= 0 and Prov_Writ_Notif_TAT_Days <= 28 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and info='Y' and ext='Y' and info_dd >= 0 and info_dd <= 5 and Prov_Writ_Notif_TAT_Days <=28  then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and ext='' and Prov_Writ_Notif_TAT_Days >= 0 and Prov_Writ_Notif_TAT_Days <= 5 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and ext='Y' and ((Prov_Writ_Notif_TAT_Days is not null and Prov_Writ_Notif_TAT_Days+ext_dd <= ext_dd+14) or (Prov_Writ_Notif_TAT_Days is null and ext_dd <= 14)) then 'Y'	  
--Standard 
	when rpt in ('AI','PA','ML') and planname in ('MI','NM','SC','UT','WI','ID') and acuity_tat='Standard' and ext<>'Y' and Prov_Writ_Notif_TAT_Days between 0 and 14 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and Prov_Writ_Notif_TAT_Days >= 0 and Prov_Writ_Notif_TAT_Days <= 10 then 'Y'
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and (Prov_Writ_Notif_TAT_Days < 0 or Prov_Writ_Notif_TAT_Days > 10) then 'N'
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and lobname<>'MarketPlace' and ext<>'Y' and Prov_Writ_Notif_TAT_Days between 0 and 14 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and lobname='MarketPlace' and ext<>'Y' and Prov_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext<>'Y' and Prov_Writ_Notif_TAT_Days between 0 and 7 then 'Y'
	when rpt in ('AI','PA','ML') and planname='PR' and acuity_tat='Standard' and ext<>'Y' and Prov_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='CA' and acuity_tat='Standard' and ext<>'Y' and Prov_Writ_Notif_TAT_Days between 0 and 5 then 'Y'  
  	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and Prov_Writ_Notif_TAT_Days between 0 and 4 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Standard' and Receiptdate_tat <= '2018-01-01' and ext<>'Y' and Prov_Writ_Notif_TAT_Days between 0 and 10 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='TX' and acuity_tat='Standard' and ext<>'Y' and Prov_Writ_Notif_TAT_Days between 0 and 3 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='NY' and acuity_tat='Standard' and ext<>'Y' and Prov_Writ_Notif_TAT_Days between 0 and 3 then 'Y'
--Urgent 
	when rpt in ('AI','PA','ML') and (planname in ('MI','UT','CA','NM','SC','ID') or (planname='OH'and Receiptdate_tat<'2018-01-01')) and acuity_tat='Urgent' and ext<>'Y' and Prov_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Urgent' and ext<>'Y' and Prov_Writ_Notif_TAT_Hours between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and Prov_Writ_Notif_TAT_Days between 0 and 2 and receipt_date >= '2018-12-01' then 'Y'  
	when rpt in ('PA','ML') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and Prov_Writ_Notif_TAT_Days between 0 and 3 and receipt_date < '2018-12-01' then 'Y'  
	when rpt in ('AI') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and Prov_Writ_Notif_TAT_Hours between 0 and 48 and receipt_date < '2018-12-01' then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Urgent' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and Prov_Writ_Notif_TAT_Hours between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Urgent' and Receiptdate_tat <= '2018-01-01' and ext<>'Y' and Prov_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='TX' and acuity_tat='Urgent' and Receiptdate_tat>= '2019-01-01' and ext<>'Y' and Prov_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='WI' and acuity_tat='Urgent' and Receiptdate_tat>= '2019-01-01' and ext<>'Y' and Prov_Writ_Notif_TAT_Days between 0 and 3 then 'Y'  
	when rpt in ('AI','PA','ML') and planname in ('TX','WI') and acuity_tat='Urgent' and Receiptdate_tat< '2019-01-01' and ext<>'Y' and Prov_Writ_Notif_TAT_Days between 0 and 3 then 'Y'  
	when rpt in ('AI','PA') and planname='PR' and acuity_tat='Urgent' and ext<>'Y' and Prov_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='NY' and acuity_tat='Urgent' and ext<>'Y' and Prov_Writ_Notif_TAT_Days between 0 and 1 then 'Y'
--Standard & Urgent Extension 
	when rpt in ('AI','PA','ML') and planname ='OH' and acuity_tat='Urgent' and ext='Y' and Prov_Writ_Notif_TAT_Days is not null and Prov_Writ_Notif_TAT_Days <= 16 then 'Y'
	when rpt in ('AI','PA','ML') and planname ='OH' and acuity_tat='Standard' and ext='Y' and Prov_Writ_Notif_TAT_Days is not null and Prov_Writ_Notif_TAT_Days <= 24 then 'Y'
	when rpt in ('AI','PA','ML') and planname ='MI' and ext='Y' and Prov_Writ_Notif_TAT_Days is not null and Prov_Writ_Notif_TAT_Days <= 17 then 'Y'
	when rpt in ('AI','PA','ML') and planname in ('CA','NM','PR','SC','UT','WI','ID') and ext='Y' and ((Prov_Writ_Notif_TAT_Days is not null and Prov_Writ_Notif_TAT_Days+ext_dd <= ext_dd+14) or (Prov_Writ_Notif_TAT_Days is null and ext_dd <= 14)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and Receiptdate_tat >= '2018-01-01' and Prov_Writ_Notif_TAT_Days<=8 then 'Y'
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and Receiptdate_tat <= '2018-01-01' and Prov_Writ_Notif_TAT_Days<=14 then 'Y'
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and ((Prov_Writ_Notif_TAT_Days is not null and Prov_Writ_Notif_TAT_Days+ext_dd <= ext_dd+10) or (Prov_Writ_Notif_TAT_Days is null and ext_dd <= 10)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='TX' and ext='Y' and ((Prov_Writ_Notif_TAT_Days is not null and Prov_Writ_Notif_TAT_Days+ext_dd <= ext_dd+3) or (Prov_Writ_Notif_TAT_Days is null and ext_dd <= 3)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='NY' and ext<>'Y' and Prov_Writ_Notif_TAT_Days between 0 and 14 then 'Y'
	when rpt in ('PA','ML') and planname='FL' and acuity_tat='Urgent' and ext='Y' and Prov_Writ_Notif_TAT_Days between 0 and 5 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI') and planname='FL' and acuity_tat='Urgent' and ext='Y' and Prov_Writ_Notif_TAT_Days between 0 and 4 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext='Y' and Prov_Writ_Notif_TAT_Days between 0 and 14 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext='Y' and Prov_Writ_Notif_TAT_Days between 0 and 11 and receipt_date >= '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Urgent' and ext='Y' and Prov_Writ_Notif_TAT_Days between 0 and 3 and receipt_date >= '2018-12-01' then 'Y'
	--IP 
	when rpt='IP' and lobname='MarketPlace' and ReceiptDate_tat > '2019-12-31' and Extension_Date is not null and ext_notif_dd in ('0','1') and Prov_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'
	when rpt='IP' and lobname='MarketPlace' and ReceiptDate_tat > '2019-12-31' and (Extension_Date is null or ext_notif_dd not in ('0','1')) and Prov_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'
	when rpt='IP' and planname = 'MI' and Prov_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'	
	when rpt='IP' and planname = 'PR' and datepart(dw,receiptdate_tat) in ('2','3','4','5','6') and Prov_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'	
	when rpt='IP' and planname = 'PR' and datepart(dw,receiptdate_tat) in ('1','7') and Prov_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'	
	when rpt='IP' and (planname in ('NY','OH','SC') or (planname = 'FL' and ReceiptDate_tat <= '2018-07-13')) and ext='' and Prov_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'	
	when rpt='IP' and (planname in ('NY','OH','SC') or (planname = 'FL' and ReceiptDate_tat <= '2018-07-13')) and ext='Y' and Prov_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'	
	when rpt='IP' and (planname in ('CA') or (planname in ('UT','FL') and Receiptdate_tat > '2018-07-13' and authorizationid not like 'm%')) and Extension_Date is not null and ext_notif_dd in ('0','1') and Prov_Writ_Notif_TAT_Days between 0 and 3 then 'Y'	--5/11/2018: add extension attribute tat logic to meet ncqa requirements
	when rpt='IP' and (planname in ('CA') or (planname in ('UT','FL') and Receiptdate_tat > '2018-07-13' and authorizationid not like 'm%')) and (Extension_Date is null or ext_notif_dd > 2 or ext_notif_dd < 0) and Prov_Writ_Notif_TAT_Days between 0 and 1 then 'Y'	
	when rpt='IP' and planname in ('CA','UT','WA','WI','NM','IL','TX','ID') and ext='' and Prov_Writ_Notif_TAT_Days between 0 and 1 then 'Y'	
	when rpt='IP' and planname in ('CA','UT','WA','WI','NM','IL','TX','ID') and ext='Y' and Prov_Writ_Notif_TAT_Days between 0 and 3 then 'Y'
	when rpt='IP' and planname='MS' and Prov_Writ_Notif_TAT_Days between 0 and 1 then 'Y'	
	when Prov_Writ_Notif_TAT_Days is not null or Prov_Writ_Notif_TAT_Days is not null then 'N'
  	else Timely_Prov_Writ_Notif end
, Timely_Ext_Mbr_Writ_Notif =  case
 --MS temporary
   	when planname = 'MS' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and Ext_Mbr_Writ_Notif_TAT_Days>=0 and Ext_Mbr_Writ_Notif_TAT_Days<=14 then 'Y'
	when planname = 'MS' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and (Ext_Mbr_Writ_Notif_TAT_Days<0 or Ext_Mbr_Writ_Notif_TAT_Days>14) then 'N'
	when planname = 'FL' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and Ext_Mbr_Writ_Notif_TAT_Days>=0 and Ext_Mbr_Writ_Notif_TAT_Days<=15 then 'Y'
	when planname = 'FL' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and (Ext_Mbr_Writ_Notif_TAT_Days<0 or Ext_Mbr_Writ_Notif_TAT_Days>15) then 'N'
	when planname in ('FL','MS') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and Receiptdate_tat >= '2020-01-01' and Ext_Mbr_Writ_Notif_TAT_Hours>=0 and Ext_Mbr_Writ_Notif_TAT_Hours<=72 then 'Y'
	when planname in ('FL','MS') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and Receiptdate_tat >= '2020-01-01' and (Ext_Mbr_Writ_Notif_TAT_Hours<0 or Ext_Mbr_Writ_Notif_TAT_Hours>72) then 'N'
 	when rpt in ('AI','PA','ML') and planname ='MS' and acuity_tat <>'Standard' and Ext_Mbr_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'
	when planname = 'MS' and acuity_tat = 'Standard' and datepart(dw,receipt_date) in ('1','2','3','4') and Ext_Mbr_Writ_Notif_TAT_Days < 3 then 'Y'
	when planname = 'MS' and acuity_tat = 'Standard' and datepart(dw,receipt_date) in ('5','6','7') and Ext_Mbr_Writ_Notif_TAT_Days < 4 then 'Y'
--WA   
--6/28/2018: WA change urgent TAT allowance from 72h to 120h if addtl info req w/in 24h 
	when rpt in ('AI','PA','ML') and planname='WA' and info='Y' and (info_hh <= 0 or info_dd <= 0) then ''
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and info='Y' and ext<>'Y' and info_hh >= 0 and info_hh <= 24 and Ext_Mbr_Writ_Notif_TAT_Hours >= 0 and Ext_Mbr_Writ_Notif_TAT_Hours <= 120 then 'Y'
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and info='Y' and ext='Y' and info_hh >= 0 and info_hh <= 24 and Ext_Mbr_Writ_Notif_TAT_Days >= 0 and Ext_Mbr_Writ_Notif_TAT_Days <= 19 then 'Y'
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Hours between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and ext='Y' and ((Ext_Mbr_Writ_Notif_TAT_Days is not null and Ext_Mbr_Writ_Notif_TAT_Days+ext_dd <= ext_dd+14) or (Ext_Mbr_Writ_Notif_TAT_Days is null and ext_dd <= 14)) then 'Y'	  	  
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and info='Y' and ext='' and info_dd >= 0 and info_dd <= 5 and Ext_Mbr_Writ_Notif_TAT_Days >= 0 and Ext_Mbr_Writ_Notif_TAT_Days <= 28 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and info='Y' and ext='Y' and info_dd >= 0 and info_dd <= 5 and Ext_Mbr_Writ_Notif_TAT_Days <=28  then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and ext='' and Ext_Mbr_Writ_Notif_TAT_Days >= 0 and Ext_Mbr_Writ_Notif_TAT_Days <= 5 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and ext='Y' and ((Ext_Mbr_Writ_Notif_TAT_Days is not null and Ext_Mbr_Writ_Notif_TAT_Days+ext_dd <= ext_dd+14) or (Ext_Mbr_Writ_Notif_TAT_Days is null and ext_dd <= 14)) then 'Y'	  
--Standard 
	when rpt in ('AI','PA','ML') and planname in ('MI','NM','SC','UT','WI','ID') and acuity_tat='Standard' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 14 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Days >= 0 and Ext_Mbr_Writ_Notif_TAT_Days <= 10 then 'Y'
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and (Ext_Mbr_Writ_Notif_TAT_Days < 0 or Ext_Mbr_Writ_Notif_TAT_Days > 10) then 'N'
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and lobname<>'MarketPlace' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 14 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and lobname='MarketPlace' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 7 then 'Y'
	when rpt in ('AI','PA','ML') and planname='PR' and acuity_tat='Standard' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='CA' and acuity_tat='Standard' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 5 then 'Y'  
  	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 4 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Standard' and Receiptdate_tat <= '2018-01-01' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 10 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='TX' and acuity_tat='Standard' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 3 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='NY' and acuity_tat='Standard' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 3 then 'Y'
--Urgent 
	when rpt in ('AI','PA','ML') and (planname in ('MI','UT','CA','NM','SC','ID') or (planname='OH'and Receiptdate_tat<'2018-01-01')) and acuity_tat='Urgent' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Urgent' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Hours between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 2 and receipt_date >= '2018-12-01' then 'Y'  
	when rpt in ('PA','ML') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 3 and receipt_date < '2018-12-01' then 'Y'  
	when rpt in ('AI') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Hours between 0 and 48 and receipt_date < '2018-12-01' then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Urgent' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Hours between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Urgent' and Receiptdate_tat <= '2018-01-01' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='TX' and acuity_tat='Urgent' and Receiptdate_tat>= '2019-01-01' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='WI' and acuity_tat='Urgent' and Receiptdate_tat>= '2019-01-01' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 3 then 'Y'  
	when rpt in ('AI','PA','ML') and planname in ('TX','WI') and acuity_tat='Urgent' and Receiptdate_tat< '2019-01-01' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 3 then 'Y'  
	when rpt in ('AI','PA') and planname='PR' and acuity_tat='Urgent' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='NY' and acuity_tat='Urgent' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 1 then 'Y'
--Standard & Urgent Extension 
	when rpt in ('AI','PA','ML') and planname ='OH' and acuity_tat='Urgent' and ext='Y' and Ext_Mbr_Writ_Notif_TAT_Days is not null and Ext_Mbr_Writ_Notif_TAT_Days <= 16 then 'Y'
	when rpt in ('AI','PA','ML') and planname ='OH' and acuity_tat='Standard' and ext='Y' and Ext_Mbr_Writ_Notif_TAT_Days is not null and Ext_Mbr_Writ_Notif_TAT_Days <= 24 then 'Y'
	when rpt in ('AI','PA','ML') and planname ='MI' and ext='Y' and Ext_Mbr_Writ_Notif_TAT_Days is not null and Ext_Mbr_Writ_Notif_TAT_Days <= 17 then 'Y'
	when rpt in ('AI','PA','ML') and planname in ('CA','NM','PR','SC','UT','WI','ID') and ext='Y' and ((Ext_Mbr_Writ_Notif_TAT_Days is not null and Ext_Mbr_Writ_Notif_TAT_Days+ext_dd <= ext_dd+14) or (Ext_Mbr_Writ_Notif_TAT_Days is null and ext_dd <= 14)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and Receiptdate_tat >= '2018-01-01' and Ext_Mbr_Writ_Notif_TAT_Days<=8 then 'Y'
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and Receiptdate_tat <= '2018-01-01' and Ext_Mbr_Writ_Notif_TAT_Days<=14 then 'Y'
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and ((Ext_Mbr_Writ_Notif_TAT_Days is not null and Ext_Mbr_Writ_Notif_TAT_Days+ext_dd <= ext_dd+10) or (Ext_Mbr_Writ_Notif_TAT_Days is null and ext_dd <= 10)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='TX' and ext='Y' and ((Ext_Mbr_Writ_Notif_TAT_Days is not null and Ext_Mbr_Writ_Notif_TAT_Days+ext_dd <= ext_dd+3) or (Ext_Mbr_Writ_Notif_TAT_Days is null and ext_dd <= 3)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='NY' and ext<>'Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 14 then 'Y'
	when rpt in ('PA','ML') and planname='FL' and acuity_tat='Urgent' and ext='Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 5 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI') and planname='FL' and acuity_tat='Urgent' and ext='Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 4 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext='Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 14 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext='Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 11 and receipt_date >= '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Urgent' and ext='Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 3 and receipt_date >= '2018-12-01' then 'Y'
	--IP 
	when rpt='IP' and lobname='MarketPlace' and ReceiptDate_tat > '2019-12-31' and Extension_Date is not null and ext_notif_dd in ('0','1') and Ext_Mbr_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'
	when rpt='IP' and lobname='MarketPlace' and ReceiptDate_tat > '2019-12-31' and (Extension_Date is null or ext_notif_dd not in ('0','1')) and Ext_Mbr_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'
	when rpt='IP' and planname = 'MI' and Ext_Mbr_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'	
	when rpt='IP' and planname = 'PR' and datepart(dw,receiptdate_tat) in ('2','3','4','5','6') and Ext_Mbr_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'	
	when rpt='IP' and planname = 'PR' and datepart(dw,receiptdate_tat) in ('1','7') and Ext_Mbr_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'	
	when rpt='IP' and (planname in ('NY','OH','SC') or (planname = 'FL' and ReceiptDate_tat <= '2018-07-13')) and ext='' and Ext_Mbr_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'	
	when rpt='IP' and (planname in ('NY','OH','SC') or (planname = 'FL' and ReceiptDate_tat <= '2018-07-13')) and ext='Y' and Ext_Mbr_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'	
	when rpt='IP' and (planname in ('CA') or (planname in ('UT','FL') and Receiptdate_tat > '2018-07-13' and authorizationid not like 'm%')) and Extension_Date is not null and ext_notif_dd in ('0','1') and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 3 then 'Y'	--5/11/2018: add extension attribute tat logic to meet ncqa requirements
	when rpt='IP' and (planname in ('CA') or (planname in ('UT','FL') and Receiptdate_tat > '2018-07-13' and authorizationid not like 'm%')) and (Extension_Date is null or ext_notif_dd > 2 or ext_notif_dd < 0) and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 1 then 'Y'	
	when rpt='IP' and planname in ('CA','UT','WA','WI','NM','IL','TX','ID') and ext='' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 1 then 'Y'	
	when rpt='IP' and planname in ('CA','UT','WA','WI','NM','IL','TX','ID') and ext='Y' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 3 then 'Y'
	when rpt='IP' and planname='MS' and Ext_Mbr_Writ_Notif_TAT_Days between 0 and 1 then 'Y'	
	when Ext_Mbr_Writ_Notif_TAT_Days is not null or Ext_Mbr_Writ_Notif_TAT_Hours is not null then 'N'
  	else Timely_Ext_Mbr_Writ_Notif end 
, Timely_Ext_Prov_Writ_Notif =  case
 --MS temporary
   	when planname = 'MS' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and Ext_Prov_Writ_Notif_TAT_Days>=0 and Ext_Prov_Writ_Notif_TAT_Days<=14 then 'Y'
	when planname = 'MS' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and (Ext_Prov_Writ_Notif_TAT_Days<0 or Ext_Prov_Writ_Notif_TAT_Days>14) then 'N'
	when planname = 'FL' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and Ext_Prov_Writ_Notif_TAT_Days>=0 and Ext_Prov_Writ_Notif_TAT_Days<=15 then 'Y'
	when planname = 'FL' and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Standard' and Receiptdate_tat >= '2020-01-01' and (Ext_Prov_Writ_Notif_TAT_Days<0 or Ext_Prov_Writ_Notif_TAT_Days>15) then 'N'
	when planname in ('FL','MS') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and Receiptdate_tat >= '2020-01-01' and Ext_Prov_Writ_Notif_TAT_Hours>=0 and Ext_Prov_Writ_Notif_TAT_Hours<=72 then 'Y'
	when planname in ('FL','MS') and lobname='Marketplace' and rpt in ('AI','PA','ML','EV') and acuity_tat = 'Urgent' and Receiptdate_tat >= '2020-01-01' and (Ext_Prov_Writ_Notif_TAT_Hours<0 or Ext_Prov_Writ_Notif_TAT_Hours>72) then 'N'
 	when rpt in ('AI','PA','ML') and planname ='MS' and acuity_tat <>'Standard' and Ext_Prov_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'
	when planname = 'MS' and acuity_tat = 'Standard' and datepart(dw,receipt_date) in ('1','2','3','4') and Ext_Prov_Writ_Notif_TAT_Days < 3 then 'Y'
	when planname = 'MS' and acuity_tat = 'Standard' and datepart(dw,receipt_date) in ('5','6','7') and Ext_Prov_Writ_Notif_TAT_Days < 4 then 'Y'
--WA   
--6/28/2018: WA change urgent TAT allowance from 72h to 120h if addtl info req w/in 24h 
	when rpt in ('AI','PA','ML') and planname='WA' and info='Y' and (info_hh <= 0 or info_dd <= 0) then ''
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and info='Y' and ext<>'Y' and info_hh >= 0 and info_hh <= 24 and Ext_Prov_Writ_Notif_TAT_Hours >= 0 and Ext_Prov_Writ_Notif_TAT_Hours <= 120 then 'Y'
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and info='Y' and ext='Y' and info_hh >= 0 and info_hh <= 24 and Ext_Prov_Writ_Notif_TAT_Days >= 0 and Ext_Prov_Writ_Notif_TAT_Days <= 19 then 'Y'
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Hours between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Urgent' and ext='Y' and ((Ext_Prov_Writ_Notif_TAT_Days is not null and Ext_Prov_Writ_Notif_TAT_Days+ext_dd <= ext_dd+14) or (Ext_Prov_Writ_Notif_TAT_Days is null and ext_dd <= 14)) then 'Y'	  	  
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and info='Y' and ext='' and info_dd >= 0 and info_dd <= 5 and Ext_Prov_Writ_Notif_TAT_Days >= 0 and Ext_Prov_Writ_Notif_TAT_Days <= 28 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and info='Y' and ext='Y' and info_dd >= 0 and info_dd <= 5 and Ext_Prov_Writ_Notif_TAT_Days <=28  then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and ext='' and Ext_Prov_Writ_Notif_TAT_Days >= 0 and Ext_Prov_Writ_Notif_TAT_Days <= 5 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='WA' and acuity_tat='Standard' and ext='Y' and ((Ext_Prov_Writ_Notif_TAT_Days is not null and Ext_Prov_Writ_Notif_TAT_Days+ext_dd <= ext_dd+14) or (Ext_Prov_Writ_Notif_TAT_Days is null and ext_dd <= 14)) then 'Y'	  
--Standard 
	when rpt in ('AI','PA','ML') and planname in ('MI','NM','SC','UT','WI','ID') and acuity_tat='Standard' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 14 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Days >= 0 and Ext_Prov_Writ_Notif_TAT_Days <= 10 then 'Y'
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and (Ext_Prov_Writ_Notif_TAT_Days < 0 or Ext_Prov_Writ_Notif_TAT_Days > 10) then 'N'
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and lobname<>'MarketPlace' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 14 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Standard' and lobname='MarketPlace' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 7 then 'Y'
	when rpt in ('AI','PA','ML') and planname='PR' and acuity_tat='Standard' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='CA' and acuity_tat='Standard' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 5 then 'Y'  
  	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Standard' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 4 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Standard' and Receiptdate_tat <= '2018-01-01' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 10 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='TX' and acuity_tat='Standard' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 3 then 'Y' 
	when rpt in ('AI','PA','ML') and planname='NY' and acuity_tat='Standard' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 3 then 'Y'
--Urgent 
	when rpt in ('AI','PA','ML') and (planname in ('MI','UT','CA','NM','SC','ID') or (planname='OH'and Receiptdate_tat<'2018-01-01')) and acuity_tat='Urgent' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='OH' and acuity_tat='Urgent' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Hours between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 2 and receipt_date >= '2018-12-01' then 'Y'  
	when rpt in ('PA','ML') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 3 and receipt_date < '2018-12-01' then 'Y'  
	when rpt in ('AI') and planname='FL' and acuity_tat='Urgent' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Hours between 0 and 48 and receipt_date < '2018-12-01' then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Urgent' and Receiptdate_tat >= '2018-01-01' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Hours between 0 and 48 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='IL' and acuity_tat='Urgent' and Receiptdate_tat <= '2018-01-01' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='TX' and acuity_tat='Urgent' and Receiptdate_tat>= '2019-01-01' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='WI' and acuity_tat='Urgent' and Receiptdate_tat>= '2019-01-01' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 3 then 'Y'  
	when rpt in ('AI','PA','ML') and planname in ('TX','WI') and acuity_tat='Urgent' and Receiptdate_tat< '2019-01-01' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 3 then 'Y'  
	when rpt in ('AI','PA') and planname='PR' and acuity_tat='Urgent' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'  
	when rpt in ('AI','PA','ML') and planname='NY' and acuity_tat='Urgent' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 1 then 'Y'
--Standard & Urgent Extension 
	when rpt in ('AI','PA','ML') and planname ='OH' and acuity_tat='Urgent' and ext='Y' and Ext_Prov_Writ_Notif_TAT_Days is not null and Ext_Prov_Writ_Notif_TAT_Days <= 16 then 'Y'
	when rpt in ('AI','PA','ML') and planname ='OH' and acuity_tat='Standard' and ext='Y' and Ext_Prov_Writ_Notif_TAT_Days is not null and Ext_Prov_Writ_Notif_TAT_Days <= 24 then 'Y'
	when rpt in ('AI','PA','ML') and planname ='MI' and ext='Y' and Ext_Prov_Writ_Notif_TAT_Days is not null and Ext_Prov_Writ_Notif_TAT_Days <= 17 then 'Y'
	when rpt in ('AI','PA','ML') and planname in ('CA','NM','PR','SC','UT','WI','ID') and ext='Y' and ((Ext_Prov_Writ_Notif_TAT_Days is not null and Ext_Prov_Writ_Notif_TAT_Days+ext_dd <= ext_dd+14) or (Ext_Prov_Writ_Notif_TAT_Days is null and ext_dd <= 14)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and Receiptdate_tat >= '2018-01-01' and Ext_Prov_Writ_Notif_TAT_Days<=8 then 'Y'
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and Receiptdate_tat <= '2018-01-01' and Ext_Prov_Writ_Notif_TAT_Days<=14 then 'Y'
	when rpt in ('AI','PA','ML') and planname='IL' and ext='Y' and ((Ext_Prov_Writ_Notif_TAT_Days is not null and Ext_Prov_Writ_Notif_TAT_Days+ext_dd <= ext_dd+10) or (Ext_Prov_Writ_Notif_TAT_Days is null and ext_dd <= 10)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='TX' and ext='Y' and ((Ext_Prov_Writ_Notif_TAT_Days is not null and Ext_Prov_Writ_Notif_TAT_Days+ext_dd <= ext_dd+3) or (Ext_Prov_Writ_Notif_TAT_Days is null and ext_dd <= 3)) then 'Y'	  
	when rpt in ('AI','PA','ML') and planname='NY' and ext<>'Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 14 then 'Y'
	when rpt in ('PA','ML') and planname='FL' and acuity_tat='Urgent' and ext='Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 5 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI') and planname='FL' and acuity_tat='Urgent' and ext='Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 4 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext='Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 14 and receipt_date < '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Standard' and ext='Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 11 and receipt_date >= '2018-12-01' then 'Y'
	when rpt in ('AI','PA','ML') and planname='FL' and acuity_tat='Urgent' and ext='Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 3 and receipt_date >= '2018-12-01' then 'Y'
	--IP 
	when rpt='IP' and lobname='MarketPlace' and ReceiptDate_tat > '2019-12-31' and (Info_Datetime is null or info_hh > 24 or info_hh < 0) and Ext_Prov_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'
	when rpt='IP' and lobname='MarketPlace' and ReceiptDate_tat > '2019-12-31' and Info_Datetime is not null and info_hh <=24 and Ext_Prov_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'
	when rpt='IP' and planname = 'MI' and Ext_Prov_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'	
	when rpt='IP' and planname = 'PR' and datepart(dw,receiptdate_tat) in ('2','3','4','5','6') and Ext_Prov_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'	
	when rpt='IP' and planname = 'PR' and datepart(dw,receiptdate_tat) in ('1','7') and Ext_Prov_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'	
	when rpt='IP' and (planname in ('NY','OH','SC') or (planname = 'FL' and ReceiptDate_tat <= '2018-07-13')) and ext='' and Ext_Prov_Writ_Notif_TAT_Hours between 0 and 24 then 'Y'	
	when rpt='IP' and (planname in ('NY','OH','SC') or (planname = 'FL' and ReceiptDate_tat <= '2018-07-13')) and ext='Y' and Ext_Prov_Writ_Notif_TAT_Hours between 0 and 72 then 'Y'	
	when rpt='IP' and (planname in ('CA') or (planname in ('UT','FL') and Receiptdate_tat > '2018-07-13' and authorizationid not like 'm%')) and Extension_Date is not null and ext_notif_dd in ('0','1') and Ext_Prov_Writ_Notif_TAT_Days between 0 and 3 then 'Y'	--5/11/2018: add extension attribute tat logic to meet ncqa requirements
	when rpt='IP' and (planname in ('CA') or (planname in ('UT','FL') and Receiptdate_tat > '2018-07-13' and authorizationid not like 'm%')) and (Extension_Date is null or ext_notif_dd > 2 or ext_notif_dd < 0) and Ext_Prov_Writ_Notif_TAT_Days between 0 and 1 then 'Y'	
	when rpt='IP' and planname in ('CA','UT','WA','WI','NM','IL','TX','ID') and ext='' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 1 then 'Y'	
	when rpt='IP' and planname in ('CA','UT','WA','WI','NM','IL','TX','ID') and ext='Y' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 3 then 'Y'
	when rpt='IP' and planname='MS' and Ext_Prov_Writ_Notif_TAT_Days between 0 and 1 then 'Y'	
	when Ext_Prov_Writ_Notif_TAT_Days is not null or Ext_Prov_Writ_Notif_TAT_Hours is not null then 'N'
  	else Timely_Ext_Prov_Writ_Notif end 
where /*planname in ('CA','FL','UT') and */ (Mbr_Notif_TAT_Days is not null or Mbr_Notif_TAT_Hours	is not null or Prov_Notif_TAT_Days	is not null or Mbr_Writ_Notif_TAT_Days is not null or
Prov_Writ_Notif_TAT_Days is not null or Ext_Mbr_Writ_Notif_TAT_Days is not null or Ext_Prov_Writ_Notif_TAT_Days is not null)

--non-compliant info time null
update dbo.AuthTAT_timeframe
set compliant_fin = case when Info_Datetime < Receiptdate_tat then '' when rpt = 'ML' and acuity = 'Emergency' then '' else compliant_fin end

--identify TAT day & hour based on case type
update dbo.AuthTAT_timeframe 
set tat_hour= case 
when (receipt_datetime is null or decision_datetime is null) and tat_dd is null and tat_hh is null then ''
when planname = 'PR' then 'Y'
when rpt in ('IP') and lobname = 'marketplace' and receiptdate_tat > '2019-12-31' then 'Y'  
--Urgent
when planname not in ('NY','WA','WI') and acuity_tat = 'Urgent' and ext<>'Y' then 'Y'
when planname = 'WI' and acuity_tat = 'Urgent' and lobname = 'Marketplace' then 'Y'
when planname = ('NY') and acuity_tat = 'Urgent' and lobname = 'Medicaid EP' and Concurrent_Review='N' then 'Y'
when planname in ('MI','OH','SC') and rpt = 'IP' then 'Y' 
when rpt in ('AI','PA','ML') and acuity_tat = 'Urgent' and receiptdate_tat >= '2019-01-01' and ext <> 'Y' and planname = 'TX' then 'Y'
when rpt in ('AI') and acuity_tat = 'Urgent' and ext <> 'Y' and planname = 'FL' and lobname = 'Marketplace' then 'Y'	
when rpt in ('IP') and planname = 'NY' and lobname = 'Marketplace' then 'Y'
when rpt in ('IP') and planname ='FL' and ReceiptDate_tat < '2018-07-13' then 'Y'
else tat_hour end 

update dbo.AuthTAT_timeframe
set tat_day=case when (receipt_datetime is null or decision_datetime is null) and tat_dd is null and tat_hh is null then ''
when tat_hour = 'NA' then 'Y'  else tat_day end 	

--no receipt_date or no decision_date
update dbo.AuthTAT_timeframe
set compliant_fin=case when (receipt_datetime is null or decision_datetime is null) and TAT_hour = 'Y' then ''
when (Receipt_Date is null or decision_date is null) and TAT_day = 'Y' then ''
when tat_day = '' and tat_hour = '' then ''
when receiptdate = '12/31/2078' or receiptdate is null then '' 
when tat_dd <0 or tat_hh<0 then ''
else compliant_fin end

--final compliant table S 
if object_id('tempdb..#AuthTAT_compliant') is not null drop table #AuthTAT_compliant 
;with comp as
(select distinct rpt,dbname,planname,proccat category, shortcat,auth_eff,auth_term
	,lob,lobname,memid,referralid,authorizationid,a.userid,isnull(rtrim(ltrim(b.loginid)),'')loginid
	,isnull(rtrim(ltrim(b.firstname))+' '+rtrim(ltrim(b.lastname)),'')username
	,referraldate,receiptdate,receiptdate_tat,acuity_tat acuity
	,acuity acuity_ori,authhstatus,authtype,Receipt_DateTime,Decision_DateTime,Receipt_Date,Receipt_Time,Decision_Date,Decision_Time
	,atrtyp,Retro_Review,extension, extension_date
	,info_days, Info_Datetime,info_dd,info_hh,info,ext
	,tat_dd,convert(varchar, cast(tat_hh as money)) tat_hh
	,ltr_dd,convert(varchar, cast(ltr_hh as money)) ltr_hh,compliant_fin,tat_day,tat_hour
	,case when compliant_fin='Y' then 1 else 0 end cnt_comp
	,case when compliant_fin in ('Y','N') then 1 else 0 end cnt_auths
	,a.createid, isnull(rtrim(ltrim(c.lastname))+', '+rtrim(ltrim(c.firstname)),'') Create_By
	,Appeal, Appeal_Outcome, Appeal_Date,Med_Director, Denial_Reason, Appeal_ID
	, Info_RQ1, Info_RQ2, null MS_Info_1_Received_TAT, Info_RC1, Info_RC2	,null MS_Info_2_Received_TAT
	,Mbr_Notif_Date,Mbr_Notif_Time,Mbr_Notif_TAT_Days,Mbr_Notif_TAT_Hours,Prov_Notif_Date,Prov_Notif_Time,Prov_Notif_TAT_Days,Prov_Notif_TAT_Hours
	,Mbr_Writ_Notif_Date,Mbr_Writ_Notif_Time,Mbr_Writ_Notif_TAT_Days,Mbr_Writ_Notif_TAT_Hours
	,Prov_Writ_Notif_Date,Prov_Writ_Notif_Time,Prov_Writ_Notif_TAT_Days,Prov_Writ_Notif_TAT_Hours
	,Ext_Mbr_Writ_Notif_Date,Ext_Mbr_Writ_Notif_Time,Ext_Mbr_Writ_Notif_TAT_Days,Ext_Mbr_Writ_Notif_TAT_Hours
	,Ext_Prov_Writ_Notif_Date,Ext_Prov_Writ_Notif_Time,Ext_Prov_Writ_Notif_TAT_Days,Ext_Prov_Writ_Notif_TAT_Hours
	,Timely_Mbr_Notif,Timely_Prov_Notif,Timely_Mbr_Writ_Notif,Timely_Prov_Writ_Notif,Timely_Ext_Mbr_Writ_Notif,Timely_Ext_Prov_Writ_Notif
	, Letter_Approval_Date,  Letter_Denial_Date,  Notification_Date,Timely_Letter, Part_denial, Pend_lines
	,Weekend,Continued_Stay_Approval,Continued_Stay_Denial,Discharge_Review,eviCore,Concurrent_Review
	from dbo.AuthTAT_timeframe a (nolock)
	left join stage.dbo.QUser b on a.userid=b.userid 
	left join stage.dbo.QUser c on a.createid=c.loginid
	where a.atrtyp<>'RR' 
UNION
	select distinct rpt,dbname,planname,proccat category
	, shortcat,auth_eff,auth_term
	,lob,lobname,memid,referralid,authorizationid,a.userid,isnull(rtrim(ltrim(b.loginid)),'')loginid
	,isnull(rtrim(ltrim(b.firstname))+' '+rtrim(ltrim(b.lastname)),'')username
	,referraldate,receiptdate,receiptdate_tat,acuity_tat acuity
	,acuity acuity_ori,authhstatus,authtype,Receipt_DateTime,Decision_DateTime,Receipt_Date,Receipt_Time,Decision_Date,Decision_Time
	,atrtyp,Retro_Review,extension, extension_date
	,null info_days,null info_datetime,null info_dd,null info_hh,''info,''ext, null tat_dd, null tat_hh
	,null ltr_dd, null ltr_hh, null compliant_fin,'NA'tat_day,'NA'tat_hour,null cnt_comp, null cnt_auths
	,a.createid, isnull(rtrim(ltrim(c.lastname))+', '+rtrim(ltrim(c.firstname)),'') Create_By
	,Appeal, Appeal_Outcome, Appeal_Date,Med_Director, Denial_Reason, Appeal_ID
	, Info_RQ1, Info_RQ2, null MS_Info_1_Received_TAT, Info_RC1, Info_RC2, null MS_Info_2_Received_TAT
	,null Mbr_Notif_Date,null Mbr_Notif_Time,null Mbr_Notif_TAT_Days,null Mbr_Notif_TAT_Hours,null Prov_Notif_Date,null Prov_Notif_Time,null Prov_Notif_TAT_Days,null Prov_Notif_TAT_Hours
	,null Mbr_Writ_Notif_Date,null Mbr_Writ_Notif_Time,null Mbr_Writ_Notif_TAT_Days,null Mbr_Writ_Notif_TAT_Hours
	,null Prov_Writ_Notif_Date,null Prov_Writ_Notif_Time,null Prov_Writ_Notif_TAT_Days,null Prov_Writ_Notif_TAT_Hours
	,null Ext_Mbr_Writ_Notif_Date,null Ext_Mbr_Writ_Notif_Time,null Ext_Mbr_Writ_Notif_TAT_Days,null Ext_Mbr_Writ_Notif_TAT_Hours
	,null Ext_Prov_Writ_Notif_Date,null Ext_Prov_Writ_Notif_Time,null Ext_Prov_Writ_Notif_TAT_Days,null Ext_Prov_Writ_Notif_TAT_Hours
	,'' Timely_Mbr_Notif,'' Timely_Prov_Notif,'' Timely_Mbr_Writ_Notif,'' Timely_Prov_Writ_Notif, '' Timely_Ext_Mbr_Writ_Notif,'' Timely_Ext_Prov_Writ_Notif
	,null Letter_Approval_Date, null Letter_Denial_Date, null Notification_Date,'' Timely_Letter, Part_denial, Pend_lines
	,null Weekend,null Continued_Stay_Approval,null Continued_Stay_Denial,null Discharge_Review,eviCore,Concurrent_Review
	from dbo.AuthTAT_attr_rcpdec a (nolock)
	left join stage.dbo.QUser b on a.userid=b.userid
	left join stage.dbo.QUser c on a.createid=c.loginid
	where a.w_acuity='Y' and a.atrtyp<>'RR'   --include wrong acuity in detail rpt
UNION
	select distinct a.rpt,a.dbname,a.planname,a.proccat category
	, shortcat,auth_eff,auth_term
	,a.lob,a.lobname,a.memid,a.referralid,a.authorizationid,a.userid,isnull(rtrim(ltrim(b.loginid)),'')loginid
	,isnull(rtrim(ltrim(b.firstname))+' '+rtrim(ltrim(b.lastname)),'')username
	,a.referraldate,a.receiptdate,a.receiptdate_tat,'RetroReview' acuity
	,a.acuity acuity_ori,a.authhstatus,a.authtype,a.Receipt_DateTime,a.Decision_DateTime,Receipt_Date,Receipt_Time,Decision_Date,Decision_Time
	,a.atrtyp,a.Retro_Review,a.extension, extension_date
	,info_days,Info_Datetime
	,null info_dd,null info_hh,''info,''ext
	,c.tat_dd,null tat_hh
	,null ltr_dd, null ltr_hh
	,case when c.tat_dd between 0 and 30 then 'Y' when c.tat_dd>30 then 'N' else '' end compliant_fin
	,'Y'tat_day,'NA' tat_hour
	,case when c.tat_dd between 0 and 30 then 1 else 0 end cnt_comp
	,case when c.tat_dd >=0 then 1 else 0 end cnt_auths
	,a.createid, isnull(rtrim(ltrim(d.lastname))+', '+rtrim(ltrim(d.firstname)),'') Create_By
	,Appeal, Appeal_Outcome, Appeal_Date,Med_Director, Denial_Reason, Appeal_ID
	, Info_RQ1, Info_RQ2, null MS_Info_1_Received_TAT, Info_RC1, Info_RC2	,null MS_Info_2_Received_TAT
	,null Mbr_Notif_Date,null Mbr_Notif_Time,null Mbr_Notif_TAT_Days,null Mbr_Notif_TAT_Hours,null Prov_Notif_Date,null Prov_Notif_Time,null Prov_Notif_TAT_Days,null Prov_Notif_TAT_Hours
	,null Mbr_Writ_Notif_Date,null Mbr_Writ_Notif_Time,null Mbr_Writ_Notif_TAT_Days,null Mbr_Writ_Notif_TAT_Hours
	,null Prov_Writ_Notif_Date,null Prov_Writ_Notif_Time,null Prov_Writ_Notif_TAT_Days,null Prov_Writ_Notif_TAT_Hours
	,null Ext_Mbr_Writ_Notif_Date,null Ext_Mbr_Writ_Notif_Time,null Ext_Mbr_Writ_Notif_TAT_Days,null Ext_Mbr_Writ_Notif_TAT_Hours
	,null Ext_Prov_Writ_Notif_Date,null Ext_Prov_Writ_Notif_Time,null Ext_Prov_Writ_Notif_TAT_Days,null Ext_Prov_Writ_Notif_TAT_Hours
	,'' Timely_Mbr_Notif,'' Timely_Prov_Notif,'' Timely_Mbr_Writ_Notif,'' Timely_Prov_Writ_Notif, '' Timely_Ext_Mbr_Writ_Notif,'' Timely_Ext_Prov_Writ_Notif
	,null Letter_Approval_Date, null Letter_Denial_Date, null Notification_Date,'' Timely_Letter, Part_denial, Pend_lines
	,null Weekend,null Continued_Stay_Approval,null Continued_Stay_Denial,null Discharge_Review,eviCore,Concurrent_Review
	from dbo.AuthTAT_attr_rcpdec a (nolock)
	left join stage.dbo.QUser b on a.userid=b.userid
	left join stage.dbo.QUser d on a.createid=d.loginid
	inner join (select distinct planname,memid,referralid,authorizationid
				,case when Retro_Review is not null then datediff(dd,Receiptdate_tat,cast(Retro_Review as datetime)) else null end tat_dd, Retro_Review RR
				from AuthTAT_attr_rcpdec where atrtyp='RR')c on a.planname=c.planname and a.memid=c.memid and a.referralid=c.referralid and a.authorizationid=c.authorizationid
	where a.atrtyp = 'RR'
)	--retro review only	
select rpt,a.dbname,planname,category
,shortcat
,lob,lobname,memid,a.referralid,a.authorizationid,a.userid,a.loginid,username,referraldate,receiptdate,receiptdate_tat,acuity,acuity_ori,authhstatus
, Denial_Reason,Appeal_ID,Appeal, Appeal_Outcome, Appeal_Date,Med_Director,auth_eff,auth_term
,authtype,Receipt_DateTime,Decision_DateTime,Receipt_Date,Receipt_Time,Decision_Date,Decision_Time
,atrtyp,Retro_Review,extension, extension_date
,info_days,Info_Datetime,info_dd,info_hh,info,ext,tat_dd,tat_hh,ltr_dd,ltr_hh,compliant_fin,tat_day,tat_hour,cnt_comp,cnt_auths,createid, Create_By
, Info_RQ1, Info_RQ2,MS_Info_1_Received_TAT, Info_RC1, Info_RC2	,MS_Info_2_Received_TAT
,Mbr_Notif_Date,Mbr_Notif_Time,Mbr_Notif_TAT_Days,Mbr_Notif_TAT_Hours,Prov_Notif_Date,Prov_Notif_Time,Prov_Notif_TAT_Days,Prov_Notif_TAT_Hours
,Mbr_Writ_Notif_Date,Mbr_Writ_Notif_Time,Mbr_Writ_Notif_TAT_Days,Mbr_Writ_Notif_TAT_Hours
,Prov_Writ_Notif_Date,Prov_Writ_Notif_Time,Prov_Writ_Notif_TAT_Days,Prov_Writ_Notif_TAT_Hours
,Ext_Mbr_Writ_Notif_Date,Ext_Mbr_Writ_Notif_Time,Ext_Mbr_Writ_Notif_TAT_Days,Ext_Mbr_Writ_Notif_TAT_Hours
,Ext_Prov_Writ_Notif_Date,Ext_Prov_Writ_Notif_Time,Ext_Prov_Writ_Notif_TAT_Days,Ext_Prov_Writ_Notif_TAT_Hours
,Timely_Mbr_Notif,Timely_Prov_Notif,Timely_Mbr_Writ_Notif,Timely_Prov_Writ_Notif,Timely_Ext_Mbr_Writ_Notif,Timely_Ext_Prov_Writ_Notif
, Timely_Letter,Letter_Approval_date,Letter_Denial_Date,Notification_Date, Part_denial, Pend_lines
, Weekend, Continued_Stay_Approval, Continued_Stay_Denial, Discharge_Review,eviCore,Concurrent_Review
into #AuthTAT_compliant 
from comp a  (nolock)

if object_id('dbo.AuthTAT_compliant') is not null drop table dbo.AuthTAT_compliant
select rpt, dbname, planname, category, shortcat, lob, lobname, memid, referralid, authorizationid, userid, loginid, username, referraldate, receiptdate, receiptdate_tat, acuity, acuity_ori, authhstatus, denial_reason
,auth_eff,auth_term, appeal_id, appeal, appeal_outcome, appeal_date,Med_Director, authtype, receipt_datetime, decision_datetime,Receipt_Date,Receipt_Time,Decision_Date,Decision_Time
,atrtyp, retro_review, extension,extension_date, info_days,info_datetime, info_dd, info_hh, info, ext, tat_dd, tat_hh, cast(tat_hh as varchar) tat_hhv
,Letter_Approval_date,Letter_Denial_Date,Notification_Date,ltr_dd, ltr_hh, Timely_Letter, Part_denial, Pend_lines
,Info_RQ1, Info_RQ2,MS_Info_1_Received_TAT, Info_RC1, Info_RC2	,MS_Info_2_Received_TAT
,Mbr_Notif_Date,Mbr_Notif_Time,Mbr_Notif_TAT_Days,Mbr_Notif_TAT_Hours,Prov_Notif_Date,Prov_Notif_Time,Prov_Notif_TAT_Days,Prov_Notif_TAT_Hours
,Mbr_Writ_Notif_Date,Mbr_Writ_Notif_Time,Mbr_Writ_Notif_TAT_Days,Mbr_Writ_Notif_TAT_Hours
,Prov_Writ_Notif_Date,Prov_Writ_Notif_Time,Prov_Writ_Notif_TAT_Days,Prov_Writ_Notif_TAT_Hours
,Ext_Mbr_Writ_Notif_Date,Ext_Mbr_Writ_Notif_Time,Ext_Mbr_Writ_Notif_TAT_Days,Ext_Mbr_Writ_Notif_TAT_Hours
,Ext_Prov_Writ_Notif_Date,Ext_Prov_Writ_Notif_Time,Ext_Prov_Writ_Notif_TAT_Days,Ext_Prov_Writ_Notif_TAT_Hours
,Timely_Mbr_Notif,Timely_Prov_Notif,Timely_Mbr_Writ_Notif,Timely_Prov_Writ_Notif,Timely_Ext_Mbr_Writ_Notif,Timely_Ext_Prov_Writ_Notif
,Weekend,Continued_Stay_Approval,Continued_Stay_Denial,Discharge_Review,eviCore,Concurrent_Review
,compliant_fin, tat_day, tat_hour, cnt_comp, cnt_auths, createid, create_by
into dbo.AuthTAT_Compliant 
from #AuthTAT_Compliant (nolock)

--blank out username not in corp for ai rpt
;with emp as 
(select distinct rtrim(ltrim([first name]))+' '+rtrim(ltrim([last name])) corp from reports.dbo.molina_employee  (nolock) 
	where [legal entity name] like '%Inc.' and [termination date] is null)
update dbo.AuthTAT_compliant set username='' from dbo.AuthTAT_compliant a left join emp b on a.username=b.corp collate database_default where b.corp is null and a.rpt='ai'
--	
if object_id('dbo.AuthTAT_compliant_raw') is not null drop table dbo.AuthTAT_compliant_raw select * into dbo.AuthTAT_compliant_raw from dbo.AuthTAT_compliant (nolock)

update dbo.AuthTAT_compliant set tat_day = '', tat_hour = '', tat_dd = null , tat_hh = null from dbo.AuthTAT_compliant where compliant_fin = '' and (tat_day <> '' or tat_hour <> '')
update dbo.AuthTAT_Compliant set Timely_Mbr_Notif = '' where Mbr_Notif_TAT_Days <0 or Mbr_Notif_TAT_Hours <0
update dbo.AuthTAT_Compliant set Timely_Prov_Notif = '' where Prov_Notif_TAT_Days <0 or Prov_Notif_TAT_Hours <0
update dbo.AuthTAT_Compliant set Timely_Mbr_Writ_Notif = '' where Mbr_Writ_Notif_TAT_Days <0 or Mbr_Writ_Notif_TAT_Hours <0
update dbo.AuthTAT_Compliant set Timely_Prov_Writ_Notif = '' where Prov_Writ_Notif_TAT_Days <0 or Prov_Writ_Notif_TAT_Hours <0
update dbo.AuthTAT_Compliant set Timely_Ext_Mbr_Writ_Notif = '' where Ext_Mbr_Writ_Notif_TAT_Days <0 or Ext_Mbr_Writ_Notif_TAT_Hours <0
update dbo.AuthTAT_Compliant set Timely_Ext_Prov_Writ_Notif = '' where Ext_Prov_Writ_Notif_TAT_Days <0 or Ext_Prov_Writ_Notif_TAT_Hours <0
update dbo.AuthTAT_Compliant set Appeal_Date = case when Appeal_date in ('2078-12-31','1900-01-01') then ' ' else convert(varchar(10),Appeal_date,121) end
update dbo.AuthTAT_Compliant set Weekend = '' where Weekend = 'N'
update dbo.AuthTAT_Compliant set Continued_Stay_Approval = '' where Continued_Stay_Approval = 'N'
update dbo.AuthTAT_Compliant set Continued_Stay_Denial = '' where Continued_Stay_Denial = 'N'
update dbo.AuthTAT_Compliant set Discharge_Review = '' where Discharge_Review = 'N'
update dbo.AuthTAT_Compliant set Concurrent_Review = '' where Concurrent_Review = 'N'
--==========================================================++++++==========================================================--
--==========================================================++++++==========================================================--

--SSRS dataset for AuthTAT_Summary
if object_id('dbo.AuthTAT_comp_final') is not null drop table dbo.AuthTAT_comp_final   
create table dbo.AuthTAT_comp_final 
   (rpt varchar(2) not null,
	dbname varchar(2) not null, 
	planname varchar(2) not null, 
	authtype varchar(15) not null, 	
	category varchar(50) not null, 
	shortcat varchar(20) not null, 
	lobname varchar(60) not null, 
	lob varchar(60) not null, 
	memid varchar(15) not null, 
	referralid varchar(15) not null, 
	authorizationid varchar(30) not null,
	loginid varchar(30) not null,
	username varchar(60) not null,
	ref_date smalldatetime not null, 
	referraldate varchar(30) not null,
	ref_receiptdate varchar(10) not null, 	
	receiptdate_tat smalldatetime not null, 
	auth_eff varchar(30) not null,
	auth_term varchar(30) not null,
	acuity_ori varchar(12) not null,	
	acuity varchar(12) not null,
	authhstatus varchar(15) not null,
	Denial_Reason varchar(100) not null,
	Med_Director varchar(100) not null,
	Pend_Lines varchar(1) not null,
	Part_Denial varchar(1) not null,
	eviCore varchar(8) not null,
	Appeal_ID varchar(100) not null,
	Appeal varchar(2) not null,
	Appeal_Outcome varchar(10) not null,
	Appeal_Date varchar(10) not null,
	receiptdate datetime null,	 
	receipt_date date null,
	receipt_time time null,
	decision_datetime datetime null,	 	
	decision_date date null,	 	
	decision_time time null,	 		
	finalreceipt varchar(30) not null,
	finalreceiptdate varchar(10) not null,
	finalreceipttime varchar(15) not null,
	finaldate varchar(30) not null,	
	finaldecisiondate varchar(10) not null,	
	finaldecisiontime varchar(15) not null,	
	MS_Info_1_Requested varchar(10) null,
	MS_Info_1_Received varchar(10) null,
	MS_Info_1_Received_TAT varchar(2) null,
	MS_Compliant_Info_1_Received varchar(1) null,
	MS_Info_2_Requested varchar(10) null,
	MS_Info_2_Received varchar(10) null,
	MS_Info_2_Received_TAT varchar(2) null,
	MS_Compliant_Info_2_Received varchar(1) null,
	Mbr_Notif_Date varchar(10) not null,
	Mbr_Notif_Time varchar(15) not null,
	Mbr_Notif_TAT_Days varchar(10) null, 
	Mbr_Notif_TAT_Hours varchar(10) null, 
	Timely_Mbr_Notif varchar(2) not null,
	Prov_Notif_Date varchar(10) not null,
	Prov_Notif_Time varchar(15) not null,
	Prov_Notif_TAT_Days varchar(10) null, 
	Prov_Notif_TAT_Hours varchar(10) null, 
	Timely_Prov_Notif varchar(2) not null,
	Mbr_Writ_Notif_Date varchar(10) not null,
	Mbr_Writ_Notif_Time varchar(15) not null,
	Mbr_Writ_Notif_TAT_Days varchar(10) null, 
	Mbr_Writ_Notif_TAT_Hours varchar(10) null, 
	Timely_Mbr_Writ_Notif varchar(2) not null,
	Prov_Writ_Notif_Date varchar(10) not null,
	Prov_Writ_Notif_Time varchar(15) not null,
	Prov_Writ_Notif_TAT_Days varchar(10) null, 
	Prov_Writ_Notif_TAT_Hours varchar(10) null, 
	Timely_Prov_Writ_Notif varchar(2) not null,
	Ext_Mbr_Writ_Notif_Date varchar(10) not null,
	Ext_Mbr_Writ_Notif_Time varchar(15) not null,
	Ext_Mbr_Writ_Notif_TAT_Days varchar(10) null, 
	Ext_Mbr_Writ_Notif_TAT_Hours varchar(10) null, 
	Timely_Ext_Mbr_Writ_Notif varchar(2) not null,
	Ext_Prov_Writ_Notif_Date varchar(10) not null,
	Ext_Prov_Writ_Notif_Time varchar(15) not null,
	Ext_Prov_Writ_Notif_TAT_Days varchar(10) null, 
	Ext_Prov_Writ_Notif_TAT_Hours varchar(10) null, 
	Timely_Ext_Prov_Writ_Notif varchar(2) not null,
	Weekend varchar(2) not null,
	Concurrent_Continued_Review varchar(2) not null,
	Continued_Stay_Approval varchar(2) not null,
	Continued_Stay_Denial varchar(2) not null,
	Discharge_Review varchar(2) not null,
	retroreview varchar(35) null,
	atrtyp varchar(2) null,	
	extension_date varchar(10) null,	
	extension varchar(10) null,	
	ext varchar(1) not null, 					
	info_days varchar(30) null, 
	info_dd varchar(10) null, 
	info varchar(1) not null,	
	ltr_dd varchar(10) null, 		
	ltr_hh varchar(10) null,
	letter_approval_date varchar(10) null,
	letter_denial_date varchar(10) null,
	notification_date varchar(10) null,
	Timely_Letter varchar(2) null,
	TAT_dd varchar(10) null, 		
	TAT_hh varchar(10) null, 
	TAT_hhf int null, 
	TAT_day varchar(2) not null, 		
	TAT_hour varchar(2) not null, 		
	compliant_final varchar(15) not null, 
	cnt_comp_final int null,
	cnt_auths int null,	
	createdate datetime not null,
	createid varchar(40) not null,
	Create_By varchar(60) not null)

if exists (select * from sys.indexes where name = 'AuthTAT_cat_plan_lobname_lob_acuity_refdt' and object_id = object_id('AuthTAT_comp_final'))
drop index AuthTAT_comp_final.AuthTAT_cat_plan_lobname_lob_acuity_refdt

insert dbo.AuthTAT_comp_final
select rpt
,isnull(dbname,'') dbname
,isnull(planname,'') planname
,isnull(authtype,'') authtype
,isnull(category,'') category
,isnull(left(shortcat,20),'') shortcat
,isnull(lobname,'') lobname
,isnull(lob,'') lob
,isnull(memid,'') memid
,isnull(referralid,'') referralid
,isnull(authorizationid,'') authorizationid
,isnull(loginid,'') loginid
,isnull(username,'') username
,isnull(referraldate,'') ref_date
,case when referraldate is null then '' else convert(varchar(10),referraldate,121)+' '+convert(varchar(15),referraldate,114) end referraldate
,case when receiptdate is null then '' else convert(varchar(10),receiptdate,121) end ref_receiptdate
,isnull(receiptdate_tat,'') receiptdate_tat
,case when auth_eff is null then '' else convert(varchar(10),auth_eff,121)+' '+convert(varchar(15),auth_eff,114) end auth_eff
,case when auth_term is null then '' else convert(varchar(10),auth_term,121)+' '+convert(varchar(15),auth_term,114) end auth_term
,isnull(acuity_ori,'') acuity_ori
,isnull(acuity,'') acuity
,isnull(authhstatus,'') authhstatus
,isnull(Denial_Reason,'NA')Denial_Reason
,isnull(Med_Director,'NA')Med_Director
,Pend_Lines = isnull(pend_lines,' ')
,Part_Denial = isnull(part_denial,' ')
,eviCore = isnull(eviCore,' ')
,left(ltrim(rtrim(isnull(Appeal_ID,''))),50) Appeal_ID
,Appeal = case when appeal = 'N' then ' ' else Appeal end, Appeal_Outcome
,Appeal_Date = case when appeal_date = '1900-01-01 00:00:00' then ' ' else left(convert(varchar(10),Appeal_date,121),10) end
,Receipt_DateTime ReceiptDate,Receipt_Date,Receipt_Time,Decision_DateTime,Decision_Date,Decision_Time
,case when Receipt_DateTime is null then '' else convert(varchar(10),Receipt_DateTime,121)+' '+convert(varchar(15),Receipt_DateTime,114) end finalreceipt
,case when Receipt_Date is null then '' else convert(varchar(10),Receipt_Date,121) end finalreceiptdate
,case when Receipt_Time is null then '' else convert(varchar(15),Receipt_Time,114) end finalreceipttime
,case when Decision_DateTime is null then '' else convert(varchar(10),Decision_DateTime,121)+' '+convert(varchar(15),Decision_DateTime,114) end finaldate
,case when Decision_Date is null then '' else convert(varchar(10),Decision_Date,121) end finaldecisiondate
,case when Decision_Time is null then '' else convert(varchar(15),Decision_Time,114) end finaldecisiontime
,MS_Info_1_Requested = case when Info_RQ1 is null then '' else convert(varchar(10),Info_RQ1,121) end 
,MS_Info_1_Received = case when Info_RC1 is null then '' else convert(varchar(10),Info_RC1,121) end 
,MS_Info_1_Received_TAT = ''
,MS_Compliant_Info_1_Received = ''
,MS_Info_2_Requested = case when Info_RQ2 is null then '' else convert(varchar(10),Info_RQ2,121) end 
,MS_Info_2_Received = case when Info_RC2 is null then '' else convert(varchar(10),Info_RC2,121) end 
,MS_Info_2_Received_TAT = ''
,MS_Compliant_Info_2_Received = ''
,case when Mbr_Notif_Date is null then '' else convert(varchar(10),Mbr_Notif_Date,121) end 
,case when Mbr_Notif_Time is null then '' else convert(varchar(15),Mbr_Notif_Time,114) end
,Mbr_Notif_TAT_Days
,Mbr_Notif_TAT_Hours
,Timely_Mbr_Notif = case when Timely_Mbr_Notif = 'NA' or Timely_Mbr_Notif is null then ' ' else Timely_Mbr_Notif end
,case when Prov_Notif_Date is null then '' else convert(varchar(10),Prov_Notif_Date,121) end 
,case when Prov_Notif_Time is null then '' else convert(varchar(15),Prov_Notif_Time,114) end 
,Prov_Notif_TAT_Days
,Prov_Notif_TAT_Hours
,Timely_Prov_Notif = case when Timely_Prov_Notif = 'NA' or Timely_Prov_Notif is null then ' ' else Timely_Prov_Notif end
,case when Mbr_Writ_Notif_Date is null then '' else convert(varchar(10),Mbr_Writ_Notif_Date,121) end 
,case when Mbr_Writ_Notif_Time is null then '' else convert(varchar(15),Mbr_Writ_Notif_Time,114) end 
,Mbr_Writ_Notif_TAT_Days
,Mbr_Writ_Notif_TAT_Hours
,Timely_Mbr_Writ_Notif = case when Timely_Mbr_Writ_Notif = 'NA' or Timely_Mbr_Writ_Notif is null then ' ' else Timely_Mbr_Writ_Notif end
,case when Prov_Writ_Notif_Date is null then '' else convert(varchar(10),Prov_Writ_Notif_Date,121) end 
,case when Prov_Writ_Notif_Time is null then '' else convert(varchar(15),Prov_Writ_Notif_Time,114) end 
,Prov_Writ_Notif_TAT_Days
,Prov_Writ_Notif_TAT_Hours
,Timely_Prov_Writ_Notif = case when Timely_Prov_Writ_Notif = 'NA' or Timely_Prov_Writ_Notif is null then ' ' else Timely_Prov_Writ_Notif end
,case when Ext_Mbr_Writ_Notif_Date is null then '' else convert(varchar(10),Ext_Mbr_Writ_Notif_Date,121) end 
,case when Ext_Mbr_Writ_Notif_Time is null then '' else convert(varchar(15),Ext_Mbr_Writ_Notif_Time,114) end 
,Ext_Mbr_Writ_Notif_TAT_Days
,Ext_Mbr_Writ_Notif_TAT_Hours
,Timely_Ext_Mbr_Writ_Notif = case when Timely_Ext_Mbr_Writ_Notif = 'NA' or Timely_Ext_Mbr_Writ_Notif is null then ' ' else Timely_Ext_Mbr_Writ_Notif end
,case when Ext_Prov_Writ_Notif_Date is null then '' else convert(varchar(10),Ext_Prov_Writ_Notif_Date,121) end 
,case when Ext_Prov_Writ_Notif_Time is null then '' else convert(varchar(15),Ext_Prov_Writ_Notif_Time,114) end 
,Ext_Prov_Writ_Notif_TAT_Days
,Ext_Prov_Writ_Notif_TAT_Hours
,Timely_Ext_Prov_Writ_Notif = case when Timely_Ext_Prov_Writ_Notif = 'NA' or Timely_Ext_Prov_Writ_Notif is null then ' ' else Timely_Ext_Prov_Writ_Notif end
,isnull(rtrim(Weekend),'') Weekend
,isnull(rtrim(Concurrent_Review),'N') Concurrent_Continued_Review
,isnull(rtrim(Continued_Stay_Approval),'N') Continued_Stay_Approval
,isnull(rtrim(Continued_Stay_Denial),'N') Continued_Stay_Denial
,isnull(rtrim(Discharge_Review),'N') Discharge_Review
,case when Retro_Review is null then '' else convert(varchar(10),Retro_Review,121) end retroreview
,atrtyp
,case when Extension_Date is null then '' else convert(varchar(10),Extension_Date,121) end 
,Extension
,ext
,convert(varchar(30),case when info_days is not null and info_days > '1900-01-01' then convert(varchar(10),info_days,121) else '' end) info_days
,info_dd
,info
,ltr_dd
,ltr_hh
,letter_approval_date = case when letter_approval_date is null then '' else convert(varchar(10),letter_approval_date,121) end 
,letter_denial_date = case when letter_denial_date is null then '' else convert(varchar(10),letter_denial_date,121) end 
,notification_date = case when notification_date is null then '' else convert(varchar(10),notification_date,121) end 
,Timely_Letter = case when Timely_Letter = 'NA' or Timely_Letter is null then ' ' else Timely_Letter end
,tat_dd
,tat_hhv
,round(tat_hh,0)
, TAT_day
,TAT_hour
,isnull(rtrim(compliant_fin),'') compliant_final
,cnt_comp cnt_comp_final
,cnt_auths
,getdate() createdate
,isnull(createid,'') createid
,isnull(Create_By,'') Create_By
from dbo.AuthTAT_compliant (nolock)
order by category,planname,lobname,lob,acuity,referraldate

update dbo.AuthTAT_comp_final set rpt = 'EV' where eviCore = 'Y'
update dbo.AuthTAT_comp_final set cnt_auths = 1 where eviCore = 'Y'
update dbo.AuthTAT_comp_final set eviCore = case when eviCore = 'Y' then 'evC' when rpt = 'AI' then 'AI' else '' end
update dbo.AuthTAT_comp_final set dbname = planname 

--combine AI & PA to create AIPA report
insert dbo.AuthTAT_comp_final	
select 'xa',dbname,planname,authtype,category,shortcat,lobname,lob,memid,referralid,authorizationid,loginid,username,ref_date,referraldate,ref_receiptdate,receiptdate_tat
,auth_eff, auth_term,acuity_ori,acuity,authhstatus
,denial_reason,Med_Director,Pend_Lines,Part_Denial,eviCore 
,appeal_id,appeal,appeal_outcome,appeal_date
,ReceiptDate,Receipt_Date,Receipt_Time,Decision_Datetime,Decision_Date,Decision_Time,FinalReceipt,FinalReceiptDate,FinalReceiptTime,FinalDate,FinalDecisionDate,FinalDecisionTime
,MS_Info_1_Requested,MS_Info_1_Received,MS_Info_1_Received_TAT,	MS_Compliant_Info_1_Received,MS_Info_2_Requested,MS_Info_2_Received,MS_Info_2_Received_TAT,	MS_Compliant_Info_2_Received
,Mbr_Notif_Date,Mbr_Notif_Time,Mbr_Notif_TAT_Days,Mbr_Notif_TAT_Hours,Timely_Mbr_Notif,Prov_Notif_Date,Prov_Notif_Time,Prov_Notif_TAT_Days,Prov_Notif_TAT_Hours,Timely_Prov_Notif
,Mbr_Writ_Notif_Date,Mbr_Writ_Notif_Time,Mbr_Writ_Notif_TAT_Days,Mbr_Writ_Notif_TAT_Hours,Timely_Mbr_Writ_Notif
,Prov_Writ_Notif_Date,Prov_Writ_Notif_Time,Prov_Writ_Notif_TAT_Days,Prov_Writ_Notif_TAT_Hours,Timely_Prov_Writ_Notif
,Ext_Mbr_Writ_Notif_Date,Ext_Mbr_Writ_Notif_Time,Ext_Mbr_Writ_Notif_TAT_Days,Ext_Mbr_Writ_Notif_TAT_Hours,Timely_Ext_Mbr_Writ_Notif
,Ext_Prov_Writ_Notif_Date,Ext_Prov_Writ_Notif_Time,Ext_Prov_Writ_Notif_TAT_Days,Ext_Prov_Writ_Notif_TAT_Hours,Timely_Ext_Prov_Writ_Notif
,Weekend,Concurrent_Continued_Review,Continued_Stay_Approval,Continued_Stay_Denial,Discharge_Review
,retroreview,atrtyp,extension_date,extension,ext
,info_days,info_dd,info,Letter_Approval_date,Letter_Denial_Date,Notification_Date,ltr_dd, ltr_hh, Timely_Letter
,tat_dd,tat_hh,tat_hhf,TAT_day,TAT_hour,compliant_final,cnt_comp_final,cnt_auths,createdate,createid,Create_By
from dbo.AuthTAT_comp_final (nolock) where rpt in ('AI','PA','EV')
---------
update dbo.AuthTAT_comp_final set Mbr_Notif_TAT_Days = '' where tat_hour = 'Y' or Mbr_Notif_TAT_Days is null
update dbo.AuthTAT_comp_final set Mbr_Notif_TAT_Hours = '' where tat_day = 'Y' or Mbr_Notif_TAT_Hours is null
---------
update dbo.AuthTAT_comp_final set Prov_Notif_TAT_Days = '' where tat_hour = 'Y' or Prov_Notif_TAT_Days is null
update dbo.AuthTAT_comp_final set Prov_Notif_TAT_Hours = '' where tat_day = 'Y' or Prov_Notif_TAT_Hours is null
---------
update dbo.AuthTAT_comp_final set Mbr_Writ_Notif_TAT_Days = '' where tat_hour = 'Y' or Mbr_Writ_Notif_TAT_Days is null
update dbo.AuthTAT_comp_final set Mbr_Writ_Notif_TAT_Hours = '' where tat_day = 'Y' or Mbr_Writ_Notif_TAT_Hours is null
---------
update dbo.AuthTAT_comp_final set Prov_Writ_Notif_TAT_Days = '' where tat_hour = 'Y' or Prov_Writ_Notif_TAT_Days is null
update dbo.AuthTAT_comp_final set Prov_Writ_Notif_TAT_Hours = '' where tat_day = 'Y' or Prov_Writ_Notif_TAT_Hours is null
---------
update dbo.AuthTAT_comp_final set Ext_Mbr_Writ_Notif_TAT_Days = '' where tat_hour = 'Y' or Ext_Mbr_Writ_Notif_TAT_Days is null
update dbo.AuthTAT_comp_final set Ext_Mbr_Writ_Notif_TAT_Hours = '' where tat_day = 'Y' or Ext_Mbr_Writ_Notif_TAT_Hours is null
---------
update dbo.AuthTAT_comp_final set Ext_Prov_Writ_Notif_TAT_Days = '' where tat_hour = 'Y' or Ext_Prov_Writ_Notif_TAT_Days is null
update dbo.AuthTAT_comp_final set Ext_Prov_Writ_Notif_TAT_Hours = '' where tat_day = 'Y' or Ext_Prov_Writ_Notif_TAT_Hours is null

create index AuthTAT_cat_plan_lobname_lob_acuity_refdt   on AuthTAT_comp_final(category,planname,lobname,lob,acuity,referraldate) 

--============================
--SSRS dataset for AuthTAT_Summary
if object_id('dbo.AuthTAT_comp_final2') is not null drop table dbo.AuthTAT_comp_final2
create table dbo.AuthTAT_comp_final2 
	(rpt varchar(2) not null,
	ord int not null,
	atrtyp varchar(2) not null,		
	planname varchar(2) not null, 
	authtype varchar(15) not null, 	
	category varchar(50) not null, 
	shortcat varchar(20) not null, 	
	lobname varchar(60) not null, 
	lob varchar(60) not null, 
	authhstatus varchar(15) not null,
	referralid varchar(15) not null, 
	authorizationid varchar(30) not null,	
	receiptdate_tat smalldatetime not null, 
	acuity varchar(12) not null, 
	cnt_comp_final int not null,
	cnt_auths int not null,
	TAT_dd int not null, 				
	TAT_hh bigint not null, 			
	createdate datetime not null)

--insert logic for blank compliance = blank TAT
insert dbo.AuthTAT_comp_final2
select rpt
,case when category in ('278 - INPATIENT','278 - OUTPATIENT') then 2 else 1 end ord
,atrtyp,planname,authtype,category,shortcat,lobname,lob,authhstatus
,referralid,authorizationid,receiptdate_tat,acuity
,cnt_comp_final,cnt_auths, isnull(TAT_dd,'')TAT_dd, isnull(TAT_hhf,11)TAT_hh, createdate 
from dbo.AuthTAT_comp_final (nolock)

--insert sheiladb.dbo.AuthTAT_comp_final2
if object_id('sheiladb.dbo.AuthTAT_Detail_AI') is not null drop table sheiladb.dbo.AuthTAT_Detail_AI
select rpt,dbname,planname,authtype,category,shortcat,lobname,lob,memid,referralid,authorizationid,loginid,username,ref_date,referraldate,ref_receiptdate,receiptdate_tat
,auth_eff,auth_term,acuity_ori,acuity,authhstatus
,denial_reason,Med_Director,Pend_Lines,Part_Denial,eviCore
,appeal_id,appeal,appeal_outcome,appeal_date
,ReceiptDate,Receipt_Date,Receipt_Time,Decision_Datetime,Decision_Date,Decision_Time,FinalReceipt,FinalReceiptDate,FinalReceiptTime,FinalDate,FinalDecisionDate,FinalDecisionTime
,MS_Info_1_Requested,MS_Info_1_Received,MS_Info_1_Received_TAT,	MS_Compliant_Info_1_Received,MS_Info_2_Requested,MS_Info_2_Received,MS_Info_2_Received_TAT,	MS_Compliant_Info_2_Received
,Mbr_Notif_Date,Mbr_Notif_Time,Mbr_Notif_TAT_Days,Mbr_Notif_TAT_Hours,Timely_Mbr_Notif,Prov_Notif_Date,Prov_Notif_Time,Prov_Notif_TAT_Days,Prov_Notif_TAT_Hours,Timely_Prov_Notif
,Mbr_Writ_Notif_Date,Mbr_Writ_Notif_Time,Mbr_Writ_Notif_TAT_Days,Mbr_Writ_Notif_TAT_Hours,Timely_Mbr_Writ_Notif
,Prov_Writ_Notif_Date,Prov_Writ_Notif_Time,Prov_Writ_Notif_TAT_Days,Prov_Writ_Notif_TAT_Hours,Timely_Prov_Writ_Notif
,Ext_Mbr_Writ_Notif_Date,Ext_Mbr_Writ_Notif_Time,Ext_Mbr_Writ_Notif_TAT_Days,Ext_Mbr_Writ_Notif_TAT_Hours,Timely_Ext_Mbr_Writ_Notif
,Ext_Prov_Writ_Notif_Date,Ext_Prov_Writ_Notif_Time,Ext_Prov_Writ_Notif_TAT_Days,Ext_Prov_Writ_Notif_TAT_Hours,Timely_Ext_Prov_Writ_Notif
,Weekend,Concurrent_Continued_Review,Continued_Stay_Approval,Continued_Stay_Denial,Discharge_Review
,retroreview,atrtyp,extension_date,extension,ext
,info_days,info_dd,info,Letter_Approval_date,Letter_Denial_Date,Notification_Date,ltr_dd, ltr_hh, Timely_Letter
,tat_dd,tat_hh,TAT_day,TAT_hour,compliant_final,cnt_comp_final,cnt_auths,createdate,createid,Create_By
into sheiladb.dbo.AuthTAT_Detail_AI from dbo.AuthTAT_comp_final (nolock) where rpt='AI' and atrtyp<>'RR'
if object_id('sheiladb.dbo.AuthTAT_Summary_AI') is not null drop table sheiladb.dbo.AuthTAT_Summary_AI
select * into sheiladb.dbo.AuthTAT_Summary_AI from dbo.AuthTAT_comp_final2 (nolock) where rpt='AI' and atrtyp<>'RR'                    
if object_id('sheiladb.dbo.AuthTAT_Detail_IP') is not null drop table sheiladb.dbo.AuthTAT_Detail_IP
select rpt,dbname,planname,authtype,category,shortcat,lobname,lob,memid,referralid,authorizationid,loginid,username,ref_date,referraldate,ref_receiptdate,receiptdate_tat
,auth_eff,auth_term,acuity_ori,acuity,authhstatus
,denial_reason,Med_Director,Pend_Lines,Part_Denial,eviCore
,appeal_id,appeal,appeal_outcome,appeal_date
,ReceiptDate,Receipt_Date,Receipt_Time,Decision_Datetime,Decision_Date,Decision_Time,FinalReceipt,FinalReceiptDate,FinalReceiptTime,FinalDate,FinalDecisionDate,FinalDecisionTime
,MS_Info_1_Requested,MS_Info_1_Received,MS_Info_1_Received_TAT,	MS_Compliant_Info_1_Received,MS_Info_2_Requested,MS_Info_2_Received,MS_Info_2_Received_TAT,	MS_Compliant_Info_2_Received
,Mbr_Notif_Date,Mbr_Notif_Time,Mbr_Notif_TAT_Days,Mbr_Notif_TAT_Hours,Timely_Mbr_Notif,Prov_Notif_Date,Prov_Notif_Time,Prov_Notif_TAT_Days,Prov_Notif_TAT_Hours,Timely_Prov_Notif
,Mbr_Writ_Notif_Date,Mbr_Writ_Notif_Time,Mbr_Writ_Notif_TAT_Days,Mbr_Writ_Notif_TAT_Hours,Timely_Mbr_Writ_Notif
,Prov_Writ_Notif_Date,Prov_Writ_Notif_Time,Prov_Writ_Notif_TAT_Days,Prov_Writ_Notif_TAT_Hours,Timely_Prov_Writ_Notif
,Ext_Mbr_Writ_Notif_Date,Ext_Mbr_Writ_Notif_Time,Ext_Mbr_Writ_Notif_TAT_Days,Ext_Mbr_Writ_Notif_TAT_Hours,Timely_Ext_Mbr_Writ_Notif
,Ext_Prov_Writ_Notif_Date,Ext_Prov_Writ_Notif_Time,Ext_Prov_Writ_Notif_TAT_Days,Ext_Prov_Writ_Notif_TAT_Hours,Timely_Ext_Prov_Writ_Notif
,Weekend,Concurrent_Continued_Review,Continued_Stay_Approval,Continued_Stay_Denial,Discharge_Review
,retroreview,atrtyp,extension_date,extension,ext
,info_days,info_dd,info,Letter_Approval_date,Letter_Denial_Date,Notification_Date,ltr_dd, ltr_hh, Timely_Letter
,tat_dd,tat_hh,TAT_day,TAT_hour,compliant_final,cnt_comp_final,cnt_auths,createdate,createid,Create_By
into sheiladb.dbo.AuthTAT_Detail_IP from dbo.AuthTAT_comp_final (nolock) where rpt='IP' and atrtyp<>'RR'
if object_id('sheiladb.dbo.AuthTAT_Summary_IP') is not null drop table sheiladb.dbo.AuthTAT_Summary_IP
select * into sheiladb.dbo.AuthTAT_Summary_IP from dbo.AuthTAT_comp_final2 (nolock) where rpt='IP' and atrtyp<>'RR'  
if object_id('sheiladb.dbo.AuthTAT_Detail_PA') is not null drop table sheiladb.dbo.AuthTAT_Detail_PA
select rpt,dbname,planname,authtype,category,shortcat,lobname,lob,memid,referralid,authorizationid,loginid,username,ref_date,referraldate,ref_receiptdate,receiptdate_tat
,auth_eff,auth_term,acuity_ori,acuity,authhstatus
,denial_reason,Med_Director,Pend_Lines,Part_Denial,eviCore
,appeal_id,appeal,appeal_outcome,appeal_date
,ReceiptDate,Receipt_Date,Receipt_Time,Decision_Datetime,Decision_Date,Decision_Time,FinalReceipt,FinalReceiptDate,FinalReceiptTime,FinalDate,FinalDecisionDate,FinalDecisionTime
,MS_Info_1_Requested,MS_Info_1_Received,MS_Info_1_Received_TAT,	MS_Compliant_Info_1_Received,MS_Info_2_Requested,MS_Info_2_Received,MS_Info_2_Received_TAT,	MS_Compliant_Info_2_Received
,Mbr_Notif_Date,Mbr_Notif_Time,Mbr_Notif_TAT_Days,Mbr_Notif_TAT_Hours,Timely_Mbr_Notif,Prov_Notif_Date,Prov_Notif_Time,Prov_Notif_TAT_Days,Prov_Notif_TAT_Hours,Timely_Prov_Notif
,Mbr_Writ_Notif_Date,Mbr_Writ_Notif_Time,Mbr_Writ_Notif_TAT_Days,Mbr_Writ_Notif_TAT_Hours,Timely_Mbr_Writ_Notif
,Prov_Writ_Notif_Date,Prov_Writ_Notif_Time,Prov_Writ_Notif_TAT_Days,Prov_Writ_Notif_TAT_Hours,Timely_Prov_Writ_Notif
,Ext_Mbr_Writ_Notif_Date,Ext_Mbr_Writ_Notif_Time,Ext_Mbr_Writ_Notif_TAT_Days,Ext_Mbr_Writ_Notif_TAT_Hours,Timely_Ext_Mbr_Writ_Notif
,Ext_Prov_Writ_Notif_Date,Ext_Prov_Writ_Notif_Time,Ext_Prov_Writ_Notif_TAT_Days,Ext_Prov_Writ_Notif_TAT_Hours,Timely_Ext_Prov_Writ_Notif
,Weekend,Concurrent_Continued_Review,Continued_Stay_Approval,Continued_Stay_Denial,Discharge_Review
,retroreview,atrtyp,extension_date,extension,ext
,info_days,info_dd,info,Letter_Approval_date,Letter_Denial_Date,Notification_Date,ltr_dd, ltr_hh, Timely_Letter
,tat_dd,tat_hh,TAT_day,TAT_hour,compliant_final,cnt_comp_final,cnt_auths,createdate,createid,Create_By
into sheiladb.dbo.AuthTAT_Detail_PA  from dbo.AuthTAT_comp_final (nolock) where rpt='PA' and atrtyp<>'RR'
if object_id('sheiladb.dbo.AuthTAT_Summary_PA') is not null drop table sheiladb.dbo.AuthTAT_Summary_PA
select * into sheiladb.dbo.AuthTAT_Summary_PA from dbo.AuthTAT_comp_final2 (nolock) where rpt='PA' and atrtyp<>'RR'                    
if object_id('sheiladb.dbo.AuthTAT_Detail_XA') is not null drop table sheiladb.dbo.AuthTAT_Detail_XA
select rpt,dbname,planname,authtype,category,shortcat,lobname,lob,memid,referralid,authorizationid,loginid,username,ref_date,referraldate,ref_receiptdate,receiptdate_tat
,auth_eff,auth_term,acuity_ori,acuity,authhstatus
,denial_reason,Med_Director,Pend_Lines,Part_Denial,eviCore
,appeal_id,appeal,appeal_outcome,appeal_date
,ReceiptDate,Receipt_Date,Receipt_Time,Decision_Datetime,Decision_Date,Decision_Time,FinalReceipt,FinalReceiptDate,FinalReceiptTime,FinalDate,FinalDecisionDate,FinalDecisionTime
,MS_Info_1_Requested,MS_Info_1_Received,MS_Info_1_Received_TAT,	MS_Compliant_Info_1_Received,MS_Info_2_Requested,MS_Info_2_Received,MS_Info_2_Received_TAT,	MS_Compliant_Info_2_Received
,Mbr_Notif_Date,Mbr_Notif_Time,Mbr_Notif_TAT_Days,Mbr_Notif_TAT_Hours,Timely_Mbr_Notif,Prov_Notif_Date,Prov_Notif_Time,Prov_Notif_TAT_Days,Prov_Notif_TAT_Hours,Timely_Prov_Notif
,Mbr_Writ_Notif_Date,Mbr_Writ_Notif_Time,Mbr_Writ_Notif_TAT_Days,Mbr_Writ_Notif_TAT_Hours,Timely_Mbr_Writ_Notif
,Prov_Writ_Notif_Date,Prov_Writ_Notif_Time,Prov_Writ_Notif_TAT_Days,Prov_Writ_Notif_TAT_Hours,Timely_Prov_Writ_Notif
,Ext_Mbr_Writ_Notif_Date,Ext_Mbr_Writ_Notif_Time,Ext_Mbr_Writ_Notif_TAT_Days,Ext_Mbr_Writ_Notif_TAT_Hours,Timely_Ext_Mbr_Writ_Notif
,Ext_Prov_Writ_Notif_Date,Ext_Prov_Writ_Notif_Time,Ext_Prov_Writ_Notif_TAT_Days,Ext_Prov_Writ_Notif_TAT_Hours,Timely_Ext_Prov_Writ_Notif
,Weekend,Concurrent_Continued_Review,Continued_Stay_Approval,Continued_Stay_Denial,Discharge_Review
,retroreview,atrtyp,extension_date,extension,ext
,info_days,info_dd,info,Letter_Approval_date,Letter_Denial_Date,Notification_Date,ltr_dd, ltr_hh, Timely_Letter
,tat_dd,tat_hh,TAT_day,TAT_hour,compliant_final,cnt_comp_final,cnt_auths,createdate,createid,Create_By
into sheiladb.dbo.AuthTAT_Detail_XA from dbo.AuthTAT_comp_final (nolock) where rpt='XA' and atrtyp<>'RR'
if object_id('sheiladb.dbo.AuthTAT_Summary_XA') is not null drop table sheiladb.dbo.AuthTAT_Summary_XA
select * into sheiladb.dbo.AuthTAT_Summary_XA from dbo.AuthTAT_comp_final2 (nolock) where rpt='XA' and atrtyp<>'RR'  
if object_id('sheiladb.dbo.AuthTAT_Detail_RR') is not null drop table sheiladb.dbo.AuthTAT_Detail_RR
select rpt,dbname,planname,authtype,category,shortcat,lobname,lob,memid,referralid,authorizationid,loginid,username,ref_date,referraldate,ref_receiptdate,receiptdate_tat
,auth_eff,auth_term,acuity_ori,acuity,authhstatus
,denial_reason,Med_Director,Pend_Lines,Part_Denial,eviCore
,appeal_id,appeal,appeal_outcome,appeal_date
,ReceiptDate,Receipt_Date,Receipt_Time,Decision_Datetime,Decision_Date,Decision_Time,FinalReceipt,FinalReceiptDate,FinalReceiptTime,FinalDate,FinalDecisionDate,FinalDecisionTime
,MS_Info_1_Requested,MS_Info_1_Received,MS_Info_1_Received_TAT,	MS_Compliant_Info_1_Received,MS_Info_2_Requested,MS_Info_2_Received,MS_Info_2_Received_TAT,	MS_Compliant_Info_2_Received
,Mbr_Notif_Date,Mbr_Notif_Time,Mbr_Notif_TAT_Days,Mbr_Notif_TAT_Hours,Timely_Mbr_Notif,Prov_Notif_Date,Prov_Notif_Time,Prov_Notif_TAT_Days,Prov_Notif_TAT_Hours,Timely_Prov_Notif
,Mbr_Writ_Notif_Date,Mbr_Writ_Notif_Time,Mbr_Writ_Notif_TAT_Days,Mbr_Writ_Notif_TAT_Hours,Timely_Mbr_Writ_Notif
,Prov_Writ_Notif_Date,Prov_Writ_Notif_Time,Prov_Writ_Notif_TAT_Days,Prov_Writ_Notif_TAT_Hours,Timely_Prov_Writ_Notif
,Ext_Mbr_Writ_Notif_Date,Ext_Mbr_Writ_Notif_Time,Ext_Mbr_Writ_Notif_TAT_Days,Ext_Mbr_Writ_Notif_TAT_Hours,Timely_Ext_Mbr_Writ_Notif
,Ext_Prov_Writ_Notif_Date,Ext_Prov_Writ_Notif_Time,Ext_Prov_Writ_Notif_TAT_Days,Ext_Prov_Writ_Notif_TAT_Hours,Timely_Ext_Prov_Writ_Notif
,Weekend,Concurrent_Continued_Review,Continued_Stay_Approval,Continued_Stay_Denial,Discharge_Review
,retroreview,atrtyp,extension_date,extension,ext
,info_days,info_dd,info,Letter_Approval_date,Letter_Denial_Date,Notification_Date,ltr_dd, ltr_hh, Timely_Letter
,tat_dd,tat_hh,TAT_day,TAT_hour,compliant_final,cnt_comp_final,cnt_auths,createdate,createid,Create_By
into sheiladb.dbo.AuthTAT_Detail_RR from dbo.AuthTAT_comp_final (nolock) where atrtyp='RR' and rpt<>'XA'
if object_id('sheiladb.dbo.AuthTAT_Summary_RR') is not null drop table sheiladb.dbo.AuthTAT_Summary_RR
select 'RR'rpt,ord,atrtyp,planname,authtype,category,shortcat,lobname,lob,authhstatus,referralid,authorizationid,receiptdate_tat,acuity,cnt_comp_final,cnt_auths,TAT_dd,TAT_hh,createdate
into sheiladb.dbo.AuthTAT_Summary_RR from dbo.AuthTAT_comp_final2 (nolock) where atrtyp='RR' and rpt<>'XA'

if object_id('sheiladb.dbo.AuthTAT_Detail_ML') is not null drop table sheiladb.dbo.AuthTAT_Detail_ML
select rpt,dbname,planname,authtype,category,shortcat,lobname,lob,memid,referralid,authorizationid,loginid,username,ref_date,referraldate,ref_receiptdate,receiptdate_tat
,auth_eff,auth_term,acuity_ori,acuity,authhstatus
,denial_reason,Med_Director,Pend_Lines,Part_Denial,eviCore
,appeal_id,appeal,appeal_outcome,appeal_date
,ReceiptDate,Receipt_Date,Receipt_Time,Decision_Datetime,Decision_Date,Decision_Time,FinalReceipt,FinalReceiptDate,FinalReceiptTime,FinalDate,FinalDecisionDate,FinalDecisionTime
,MS_Info_1_Requested,MS_Info_1_Received,MS_Info_1_Received_TAT,	MS_Compliant_Info_1_Received,MS_Info_2_Requested,MS_Info_2_Received,MS_Info_2_Received_TAT,	MS_Compliant_Info_2_Received
,Mbr_Notif_Date,Mbr_Notif_Time,Mbr_Notif_TAT_Days,Mbr_Notif_TAT_Hours,Timely_Mbr_Notif,Prov_Notif_Date,Prov_Notif_Time,Prov_Notif_TAT_Days,Prov_Notif_TAT_Hours,Timely_Prov_Notif
,Mbr_Writ_Notif_Date,Mbr_Writ_Notif_Time,Mbr_Writ_Notif_TAT_Days,Mbr_Writ_Notif_TAT_Hours,Timely_Mbr_Writ_Notif
,Prov_Writ_Notif_Date,Prov_Writ_Notif_Time,Prov_Writ_Notif_TAT_Days,Prov_Writ_Notif_TAT_Hours,Timely_Prov_Writ_Notif
,Ext_Mbr_Writ_Notif_Date,Ext_Mbr_Writ_Notif_Time,Ext_Mbr_Writ_Notif_TAT_Days,Ext_Mbr_Writ_Notif_TAT_Hours,Timely_Ext_Mbr_Writ_Notif
,Ext_Prov_Writ_Notif_Date,Ext_Prov_Writ_Notif_Time,Ext_Prov_Writ_Notif_TAT_Days,Ext_Prov_Writ_Notif_TAT_Hours,Timely_Ext_Prov_Writ_Notif
,Weekend,Concurrent_Continued_Review,Continued_Stay_Approval,Continued_Stay_Denial,Discharge_Review
,retroreview,atrtyp,extension_date,extension,ext
,info_days,info_dd,info
,Letter_Approval_date,Letter_Denial_Date,Notification_Date,ltr_dd, ltr_hh, Timely_Letter
,tat_dd,tat_hh,TAT_day,TAT_hour,compliant_final,cnt_comp_final,cnt_auths,createdate,createid,Create_By
into sheiladb.dbo.AuthTAT_Detail_ML from dbo.AuthTAT_comp_final (nolock) where rpt='ML' and atrtyp<>'RR'
if object_id('sheiladb.dbo.AuthTAT_Summary_ML') is not null drop table sheiladb.dbo.AuthTAT_Summary_ML
select * into sheiladb.dbo.AuthTAT_Summary_ML from dbo.AuthTAT_comp_final2 (nolock) where rpt='ML' and atrtyp<>'RR' 

if object_id('sheiladb.dbo.AuthTAT_Detail_EV') is not null drop table sheiladb.dbo.AuthTAT_Detail_EV
select rpt,dbname,planname,authtype,category,shortcat,lobname,lob,memid,referralid,authorizationid,loginid,username,ref_date,referraldate,ref_receiptdate,receiptdate_tat
,auth_eff,auth_term,acuity_ori,acuity,authhstatus
,denial_reason,Med_Director,Pend_Lines,Part_Denial,eviCore
,appeal_id,appeal,appeal_outcome,appeal_date
,ReceiptDate,Receipt_Date,Receipt_Time,Decision_Datetime,Decision_Date,Decision_Time,FinalReceipt,FinalReceiptDate,FinalReceiptTime,FinalDate,FinalDecisionDate,FinalDecisionTime
,MS_Info_1_Requested,MS_Info_1_Received,MS_Info_1_Received_TAT,	MS_Compliant_Info_1_Received,MS_Info_2_Requested,MS_Info_2_Received,MS_Info_2_Received_TAT,	MS_Compliant_Info_2_Received
,Mbr_Notif_Date,Mbr_Notif_Time,Mbr_Notif_TAT_Days,Mbr_Notif_TAT_Hours,Timely_Mbr_Notif,Prov_Notif_Date,Prov_Notif_Time,Prov_Notif_TAT_Days,Prov_Notif_TAT_Hours,Timely_Prov_Notif
,Mbr_Writ_Notif_Date,Mbr_Writ_Notif_Time,Mbr_Writ_Notif_TAT_Days,Mbr_Writ_Notif_TAT_Hours,Timely_Mbr_Writ_Notif
,Prov_Writ_Notif_Date,Prov_Writ_Notif_Time,Prov_Writ_Notif_TAT_Days,Prov_Writ_Notif_TAT_Hours,Timely_Prov_Writ_Notif
,Ext_Mbr_Writ_Notif_Date,Ext_Mbr_Writ_Notif_Time,Ext_Mbr_Writ_Notif_TAT_Days,Ext_Mbr_Writ_Notif_TAT_Hours,Timely_Ext_Mbr_Writ_Notif
,Ext_Prov_Writ_Notif_Date,Ext_Prov_Writ_Notif_Time,Ext_Prov_Writ_Notif_TAT_Days,Ext_Prov_Writ_Notif_TAT_Hours,Timely_Ext_Prov_Writ_Notif
,Weekend,Concurrent_Continued_Review,Continued_Stay_Approval,Continued_Stay_Denial,Discharge_Review
,retroreview,atrtyp,extension_date,extension,ext
,info_days,info_dd,info,Letter_Approval_date,Letter_Denial_Date,Notification_Date,ltr_dd, ltr_hh, Timely_Letter
,tat_dd,tat_hh,TAT_day,TAT_hour,compliant_final,cnt_comp_final,cnt_auths,createdate,createid,Create_By
into sheiladb.dbo.AuthTAT_Detail_EV from dbo.AuthTAT_comp_final (nolock) where rpt='EV' and atrtyp<>'RR'
if object_id('sheiladb.dbo.AuthTAT_Summary_EV') is not null drop table sheiladb.dbo.AuthTAT_Summary_EV
select * into sheiladb.dbo.AuthTAT_Summary_EV from dbo.AuthTAT_comp_final2 (nolock) where rpt='EV' and atrtyp<>'RR' 

exec reports.dbo.proc_TruncateMyTable
insert reports.dbo.AuthTAT_comp_final
select * from dbo.AuthTAT_comp_final (nolock)
insert reports.dbo.AuthTAT_comp_final2
select * from dbo.AuthTAT_comp_final2 (nolock)

insert reports.dbo.AuthTAT_Detail_ML
select * from dbo.AuthTAT_Detail_ML (nolock)
insert reports.dbo.AuthTAT_Summary_ML 
select * from dbo.AuthTAT_Summary_ML (nolock)
insert reports.dbo.AuthTAT_Detail_AI 
select * from dbo.AuthTAT_Detail_AI (nolock)
insert reports.dbo.AuthTAT_Summary_AI 
select * from dbo.AuthTAT_Summary_AI (nolock)          
insert reports.dbo.AuthTAT_Detail_IP 
select * from dbo.AuthTAT_Detail_IP (nolock)
insert reports.dbo.AuthTAT_Summary_IP 
select * from dbo.AuthTAT_Summary_IP   (nolock)
insert reports.dbo.AuthTAT_Detail_PA 
select * from dbo.AuthTAT_Detail_PA  (nolock)
insert reports.dbo.AuthTAT_Summary_PA 
select * from dbo.AuthTAT_Summary_PA (nolock)           
insert reports.dbo.AuthTAT_Detail_XA 
select * from dbo.AuthTAT_Detail_XA  (nolock)
insert reports.dbo.AuthTAT_Summary_XA
select * from dbo.AuthTAT_Summary_XA (nolock)
insert reports.dbo.AuthTAT_Detail_EV
select * from dbo.AuthTAT_Detail_EV (nolock)
insert reports.dbo.AuthTAT_Summary_EV
select * from dbo.AuthTAT_Summary_EV (nolock)
insert reports.dbo.AuthTAT_Detail_RR
select * from dbo.AuthTAT_Detail_RR  (nolock)
insert reports.dbo.AuthTAT_Summary_RR
select 'RR'rpt,ord,atrtyp,planname,authtype,category,shortcat,lobname,lob,authhstatus,referralid
,authorizationid,receiptdate_tat,acuity,cnt_comp_final,cnt_auths,TAT_dd,TAT_hh,createdate
from dbo.AuthTAT_Summary_RR  (nolock)

/*
drop table reports.dbo.authtat_comp_final 
drop table reports.dbo.authtat_detail_AI 
drop table reports.dbo.authtat_detail_IP 
drop table reports.dbo.authtat_detail_ML 
drop table reports.dbo.authtat_detail_PA 
drop table reports.dbo.authtat_detail_RR 
drop table reports.dbo.authtat_detail_XA 

drop table reports.dbo.authtat_comp_final2
drop table reports.dbo.authtat_summary_AI 
drop table reports.dbo.authtat_summary_IP 
drop table reports.dbo.authtat_summary_ML 
drop table reports.dbo.authtat_summary_PA 
drop table reports.dbo.authtat_summary_RR 
drop table reports.dbo.authtat_summary_XA 

select * into reports.dbo.authtat_comp_final from sheiladb.dbo.authtat_comp_final
select * into reports.dbo.authtat_detail_AI from sheiladb.dbo.authtat_detail_AI
select * into reports.dbo.authtat_detail_IP from sheiladb.dbo.authtat_detail_IP
select * into reports.dbo.authtat_detail_ML from sheiladb.dbo.authtat_detail_ML
select * into reports.dbo.authtat_detail_PA from sheiladb.dbo.authtat_detail_PA
select * into reports.dbo.authtat_detail_RR from sheiladb.dbo.authtat_detail_RR
select * into reports.dbo.authtat_detail_XA from sheiladb.dbo.authtat_detail_XA

select * into reports.dbo.authtat_comp_final2 from sheiladb.dbo.authtat_comp_final2
select * into reports.dbo.authtat_summary_AI from sheiladb.dbo.authtat_summary_AI
select * into reports.dbo.authtat_summary_IP from sheiladb.dbo.authtat_summary_IP
select * into reports.dbo.authtat_summary_ML from sheiladb.dbo.authtat_summary_ML
select * into reports.dbo.authtat_summary_PA from sheiladb.dbo.authtat_summary_PA
select * into reports.dbo.authtat_summary_RR from sheiladb.dbo.authtat_summary_RR
select * into reports.dbo.authtat_summary_XA from sheiladb.dbo.authtat_summary_XA
*/


